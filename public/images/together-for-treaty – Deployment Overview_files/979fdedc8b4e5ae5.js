
!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="bb4103f8-e9c2-5074-9c56-cd9e14c1be89")}catch(e){}}();
(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,6356390,e=>{"use strict";e.s(["CreateResourceModal",()=>ew],6356390);var t=e.i(751170),n=e.i(4099374),a=e.i(6891161),i=e.i(8522580),r=e.i(8735244),o=e.i(5338940),l=e.i(9544652),s=e.i(8711152),c=e.i(3677672),d=e.i(3798983),u=e.i(9906957),g=e.i(5074599);e.i(2331088);var p=e.i(545169),h=e.i(6817234),m=e.i(9623675),x=e.i(9508212),j=e.i(1344973),y=e.i(57106),C=e.i(7151748),k=e.i(3870297),f=e.i(1717203),S=e.i(7557283),b=e.i(277234),P=e.i(4244280);async function M(e){let{integrationId:t,teamId:n,source:a,acceptedPolicies:i,metadata:r,billingPlanId:o,authorizationId:l}=e,s=new URLSearchParams;n&&s.append("teamId",n);let c=s.toString();return await (0,b.fetchAPI)(`${P.API_INTEGRATION_CONTROLLER_V2}/integration/${t}/marketplace/install${c?`?${c}`:""}`,{method:"POST",body:{acceptedPolicies:i,source:a??"marketplace",metadata:r,billingPlanId:o,authorizationId:l},throwOnHTTPError:!0})}var I=e.i(9186321),w=e.i(2512825),T=e.i(8352794),A=e.i(3788585),v=e.i(4030453),R=e.i(4004502);e.i(553769);var L=e.i(3758860),B=e.i(2557188),N=e.i(1914640),E=e.i(373291);function F(e){let{integration:i,product:r,cancelLabel:o,onBack:l,onNext:s,isLoading:c=!1,isTransitioning:d}=e,{hasMetadataErrors:u,isLoading:g,metadataState:j,areMetadataChanged:y}=(0,E.useStoreIntegrationFormContext)(),{plan:C,isBillingPlanSelectionValid:k}=(0,h.useMarketplaceBillingPlansContext)(),f=(0,n.useMemo)(()=>Object.keys(i.metadataSchema?.properties??{}).length>0,[i]);return(0,t.jsx)(m.ResourceModalWrapper,{SuccessAction:(0,t.jsx)(a.Modal.Action,{"data-testid":(0,R.tid)("create-integration-button","store-modal-continue"),disabled:u||!C||!k||c,loading:g||d,onClick:()=>{C&&s(j,C)},children:"Continue"}),cancelLabel:o,checkoutContentVariant:"default",from:"installation",integration:i,onBack:l,product:r,children:(0,t.jsxs)(x.Stack,{gap:5,children:[f?(0,t.jsx)(x.Stack,{className:"border-0 border-b border-solid border-gray-alpha-400 bg-background-200 p-6 px-0",children:(0,t.jsx)(p.ResourceMetadataFieldsWithErrorBoundary,{integrationId:i.id,isLoading:c,productId:"iap_none"})}):null,(0,t.jsx)(x.Stack,{paddingY:6,children:u?(0,t.jsx)(B.BillingPlanMetadataErrors,{integrationSlug:i.slug,isInstallationLevel:!0}):(0,t.jsx)(B.MarketplaceBillingPlanSelectorWithErrorBoundary,{areMetadataChanged:y,arePermissionsLoading:!1,hasLogDrainsSupport:i.products.some(e=>(0,L.isProtocolSupported)(e,"logDrain")),integrationId:i.id,integrationName:i.name,integrationSlug:i.slug,isInstallationLevel:!0,metadata:j,type:"new-installation"})})]})})}function O(e){let{integration:n,product:i,onBack:r,onNext:o,isTransitioning:l}=e,{isLoading:s,metadataState:c,formError:d}=(0,E.useStoreIntegrationFormContext)(),{plan:u}=(0,h.useMarketplaceBillingPlansContext)();return(0,t.jsx)(m.ResourceModalWrapper,{SuccessAction:(0,t.jsxs)(a.Modal.Action,{"data-testid":(0,R.tid)("create-integration-button","store-modal-create"),loading:s||l,onClick:o,children:["Create ",(0,g.getAccountTitleBySlug)({slug:i.slug})]}),cancelLabel:"Back",checkoutContentVariant:"no-padding",from:"installation",integration:n,onBack:r,product:i,children:(0,t.jsxs)(x.Stack,{gap:4,padding:6,children:[(0,t.jsx)(j.Text,{size:16,weight:500,children:"Your Selection"}),d.form?(0,t.jsx)(v.Error,{children:d.form}):null,(0,t.jsx)(N.ReadOnlyMetadataWithErrorBoundary,{integrationId:n.id,metadata:c,metadataErrors:d.metadata,productId:i.id,target:"create"}),(0,t.jsx)(N.ReadOnlyBillingPlan,{billingPlan:u})]})})}var D=e.i(9588822),_=e.i(8843717),U=e.i(1008179),z=e.i(6111613);function V(e){let{team:n,requireNew:a,paymentMethodState:i,onBack:r,onNext:o}=e;return(0,t.jsx)(z.PaymentMethodAction,{onBack:r,onNext:o,paymentMethodState:i,requireNew:a,team:n})}var W=e.i(2504781),$=e.i(762945),K=e.i(5761705),q=e.i(4987761);function Y(e){let{teamId:n,integration:i,authorizationId:r,onChangePaymentMethod:o,onBack:l,onNext:s,product:c,success:d,error:u,isTransitioning:g}=e,{authorization:p,error:h,handleUserActions:j}=(0,q.usePollAuthorization)(n,r),y=!!(h||u||p?.status==="failed"),C=p?.status==="requires_action";return(0,t.jsx)(m.ResourceModalWrapper,{SuccessAction:(0,t.jsx)(a.Modal.Action,{disabled:!d,loading:!y&&!d||g,onClick:()=>s(),children:d?"Done":"Processing"}),cancelLabel:"Back",checkoutContentVariant:"no-padding-no-bottom",disableCancel:!(y||C)||d,from:"resource",integration:i,onBack:l,product:c,children:(0,t.jsx)(x.Stack,{gap:4,padding:6,paddingBottom:0,children:(0,t.jsx)(H,{authorization:p,error:u||(h?"Unknown error":void 0),handleUserActions:j,integration:i,onChangePaymentMethod:o,success:d})})})}function H(e){let{authorization:n,error:a,success:i,integration:o,handleUserActions:l,onChangePaymentMethod:s}=e;return i?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(x.Stack,{align:"center",direction:"row",gap:2,children:[(0,t.jsx)(K.CheckCircle,{color:"green-900",size:16}),(0,t.jsxs)(j.Text,{color:"green-900","data-testid":(0,R.tid)("create-resource-modal","successfully-created"),weight:500,children:[o.name," Account Created Successfully"]})]}),(0,t.jsxs)(j.Text,{className:"text-gray-900",children:["Your"," ",(0,t.jsx)(j.Text,{as:"span",className:"text-gray-1000",children:o.name})," ","account has been created successfully."]})]}):n?.status==="requires_action"?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(x.Stack,{align:"center",direction:"row",gap:2,children:[(0,t.jsx)($.Warning,{color:"amber-900",size:16}),(0,t.jsx)(j.Text,{color:"amber-900",weight:500,children:"Authentication Needed"})]}),(0,t.jsx)(j.Text,{className:"text-gray-900",children:"Further action is needed. Please authenticate your payment method to continue."}),(0,t.jsx)(W.Button,{onClick:()=>{l()},children:"Authenticate"})]}):n?.status==="failed"?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(v.Error,{children:"Preauthorization Failed"}),(0,t.jsx)(j.Text,{className:"text-gray-900",children:"There was an error using your payment method. Please try again with a different payment method."}),(0,t.jsx)(W.Button,{onClick:()=>s(),children:"Change Payment Method"})]}):a?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(v.Error,{children:a}),(0,t.jsxs)(j.Text,{className:"text-gray-900",children:["There was an error creating your"," ",(0,t.jsx)(j.Text,{as:"span",className:"text-gray-1000",children:o.name})," ","account. Please try again later."]})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(x.Stack,{align:"center",direction:"row",gap:2,children:[(0,t.jsx)(r.Spinner,{size:16}),(0,t.jsx)(j.Text,{size:16,weight:500,children:"Processing"})]}),(0,t.jsxs)(j.Text,{className:"text-gray-900",children:["Hold tight, we're processing your order of"," ",(0,t.jsx)(j.Text,{as:"span",className:"text-gray-1000",children:o.name}),"."]})]})}var G=e.i(8794163);function X(e){let{product:n,cancelLabel:a,integration:r,isLoading:o,onSuccess:l,onBack:s,team:c,checkoutContentVariant:d}=e,u=c.enabledInvoiceItems?.vercelMarketplace?.enabled===!0,{can:g,isLoading:p}=(0,f.default)({teamId:c.id}),h=g(S.Action.Create,S.Resource.IntegrationConfiguration),C=(0,T.isResellerCustomer)(c);return u?h||p?(0,t.jsx)(Z,{isLoading:o,cancelLabel:a,integration:r,product:n,team:c,onBack:s,onSuccess:l}):(0,t.jsx)(m.ResourceModalWrapper,{SuccessAction:(0,t.jsx)(w.InstallButton,{account:c,canInstall:!1,hasPermission:!1,onClick:()=>{},children:"Continue"}),cancelLabel:a,checkoutContentVariant:d,from:"installation",integration:r,onBack:s,product:n,children:(0,t.jsx)(x.Stack,{gap:4,children:(0,t.jsxs)(i.Note,{type:"warning",children:["You need additional permissions to install integrations to"," ",c.name||"this"," account. Please contact your account administrator to request the necessary permissions."," ",(0,t.jsx)(y.Link,{external:!0,href:"https://vercel.com/docs/accounts/team-members-and-roles",target:"_blank",children:(0,t.jsx)(j.Text,{children:"Learn more"})})]})})}):(0,t.jsx)(m.ResourceModalWrapper,{SuccessAction:(0,t.jsx)(y.ButtonLink,{href:"/contact/sales",children:"Contact Sales"}),cancelLabel:a,checkoutContentVariant:d,from:"installation",integration:r,onBack:s,product:n,children:(0,t.jsx)(x.Stack,{gap:4,style:{minHeight:0},children:(0,t.jsx)(i.Note,{type:"warning",children:C?(0,t.jsx)(t.Fragment,{children:"The Vercel Marketplace is not yet available for your Enterprise account.Â You will get notified as soon as it becomes available."}):(0,t.jsx)(t.Fragment,{children:"Your Enterprise account is not yet available to use the Vercel Marketplace. To gain access, contact our team to discuss an account upgrade."})})})})}function J(e){let{team:a,integration:i,product:r,isLoading:o,cancelLabel:l,onBack:s,onSuccess:c}=e,[d,u]=(0,n.useState)("policies"),{onSubmit:g,metadataState:p,formError:x,isLoading:j}=(0,E.useStoreIntegrationFormContext)(),y=i.flags?.includes(I.LaunchDarklyIntegrationFlags.MarketplaceInstallationOnlyPlan),{plan:f}=(0,h.useMarketplaceBillingPlansContext)(),[S,b]=(0,n.useState)(!1),{data:P}=(0,_.useIntegrationPaymentMethodState)(),T=(0,U.useAwaitData)(P),[v,R]=(0,n.useState)(),{createAuthorization:L}=(0,q.useMarketplaceBillingAuthorizationApi)(),B=(0,q.useAwaitAuthorization)(),[N,D]=(0,n.useState)(null),[W,$]=(0,n.useTransition)(),[K,H]=(0,n.useState)(),{connectProjectAndReturnToV0:X}=(0,G.useV0Marketplace)()||{},J=e=>{if(K)return void c(K,f??void 0);let t=X?"v0":"marketplace";C.analytics.track(k.AnalyticsEvent.MARKETPLACE_INSTALLATION_CREATE_CLICKED,{integration:{id:i.id,slug:i.slug},source:t});let n=e.paymentMethodId??v;f&&u("provisioning"),g(async()=>{let e,r={},o=new Date().toISOString();if(i.eulaDocUri&&(r.eula=o),i.privacyDocUri&&(r.privacy=o),f){let t=await L(a.id,{integrationIdOrSlug:i.id,billingPlanId:f.id,metadata:p,integrationConfigurationId:void 0,paymentMethodId:n});if(D(t?.id??null),e=t?.id,t&&"succeeded"!==(await B(a.id,t.id)).status)return}let l=await M({integrationId:i.id,teamId:a.id,acceptedPolicies:r,metadata:p,billingPlanId:f?.id,authorizationId:e,source:t});H(l),n&&await (0,_.updateInstallationPaymentMethod)(a.id,l.id,n),c(l,f??void 0)})},Q=`Accept and ${y?"Continue":"Create"}`;switch(d){case"policies":return(0,t.jsx)(m.ResourceModalWrapper,{SuccessAction:(0,t.jsx)(w.InstallButton,{account:a,canInstall:!0,hasPermission:!0,loading:o||W||j,onClick:()=>{y?u("select-plan"):J({paymentMethodId:void 0})},children:Q}),cancelLabel:l,checkoutContentVariant:"default",from:"installation",integration:i,onBack:s,product:r,children:(0,t.jsx)(A.TermsAndConditions,{buttonCaption:Q,integrations:[i]})});case"select-plan":return(0,t.jsx)(F,{cancelLabel:"Back",integration:i,isLoading:o,isTransitioning:W,onBack:()=>u("policies"),onNext:function(){$(async()=>{if(f?.paymentMethodRequired){let e=await T;if((0,z.getIsPaymentMethodStepNeeded)(a,e,f))return void u("payment-method")}u("confirm-plan")})},product:r});case"confirm-plan":return(0,t.jsx)(O,{integration:i,isTransitioning:W,onBack:()=>u("select-plan"),onNext:function(){C.analytics.track(k.AnalyticsEvent.MARKETPLACE_INSTALLATION_PLAN_SELECTED,{integration:{id:i.id,slug:i.slug}}),J({paymentMethodId:v})},product:r});case"payment-method":return P?(0,t.jsx)(V,{onBack:()=>u("confirm-plan"),onNext:e=>{R(e),b(!1),u("confirm-plan")},paymentMethodState:P,requireNew:S,team:a}):null;case"provisioning":return(0,t.jsx)(Y,{authorizationId:N,error:x.form??void 0,integration:i,isTransitioning:W,onBack:()=>u("confirm-plan"),onChangePaymentMethod:()=>{b(!0),u("payment-method")},onNext:()=>{K&&f&&c(K,f)},product:r,success:!!K,teamId:a.id})}}let Q={type:"object",properties:{},additionalProperties:!1,required:[]},Z=(0,D.withStripe)(function(e){return(0,t.jsx)(h.MarketplaceInstallationBillingPlansProvider,{target:"create",children:(0,t.jsx)(p.ResourceFormProvider,{metadataSchema:e.integration.metadataSchema??Q,resourceTitle:"Account",target:"create",children:(0,t.jsx)(J,{...e})})})});var ee=e.i(455575),et=e.i(3679047),en=e.i(2992903),ea=e.i(588428),ei=e.i(9219571),er=e.i(9349058),eo=e.i(6984705),el=e.i(9722978),es=e.i(5328446),ec=e.i(1906681),ed=e.i(5684165),eu=e.i(6835270),eg=e.i(6143247);function ep(e){let{product:n,integration:a,installationId:i,cancelLabel:r,onBack:o,onNext:l,isLoading:s,isTransitioning:c,...d}=e;return(0,t.jsx)(eh,{cancelLabel:r,installationId:i,integration:a,isLoading:s,isTransitioning:c,onBack:o,onNext:l,product:n,...d})}function eh(e){let{product:i,integration:r,installationId:o,cancelLabel:l,onBack:s,onNext:c,isLoading:d,isTransitioning:u,...g}=e,C=r.flags?.includes(I.LaunchDarklyIntegrationFlags.MarketplaceInstallationOnlyPlan),{hasMetadataErrors:k,isLoading:f,metadataState:S,areMetadataChanged:b,target:P}=(0,E.useStoreIntegrationFormContext)(),{plan:M,isSelectedPlanValid:w,isBillingPlanPreselected:T}=(0,h.useMarketplaceBillingPlansContext)(),A=(0,n.useMemo)(()=>Object.keys(i.metadataSchema.properties).length>0,[i]),v=r.supportsInstallationBillingPlans??!1,{protocolSettings:N,protocolSettingsForm:F}=function(e){let[a,i]=(0,n.useState)(void 0);return{protocolSettingsForm:(0,n.useMemo)(()=>{if("protocols"in e&&e.protocols.experimentation?.edgeConfigSyncingSupport){let e=a?.experimentation?.edgeConfigSyncingEnabled??!1;return(0,t.jsx)(x.Stack,{gap:2,children:(0,t.jsx)(ed.IntegrationResourceFormControlWithDescription,{controlKey:"",description:(0,t.jsxs)(t.Fragment,{children:["Synchronizes integration data with Edge Config for ultra-low latency resolution. Additional costs may apply for Edge Config usage."," ",(0,t.jsx)(y.Link,{external:!0,href:"https://vercel.com/docs/integrations/marketplace-flows#experimentation-edge-config-syncing",variant:"highlight",children:"Learn more"})]}),children:(0,t.jsxs)(x.Stack,{align:"center",direction:"row",gap:3,children:[(0,t.jsx)(ec.Toggle,{checked:e,onChange:e=>{i(t=>({...t,experimentation:{...t?.experimentation,edgeConfigSyncingEnabled:e}}))},size:"large"}),(0,t.jsx)(j.Text,{color:"gray-900",weight:500,children:"Enable Edge Config Syncing"})]})})})}return null},[e,a,i]),protocolSettings:a}}(i),{data:O}=(0,es.default)(o),D=C||M&&w,_=(0,eu.useInstallMarketplaceProductDisplayMode)();return(0,t.jsx)(m.ResourceModalWrapper,{SuccessAction:(0,t.jsx)(a.Modal.Action,{"data-testid":(0,R.tid)("create-integration-button","store-modal-create"),disabled:k||!D||d,loading:f||u,onClick:()=>{let e=M??(v?O?.billingPlan:void 0);e&&c(S,e,N)},children:"create"===P?"Continue":"Save"}),cancelLabel:l,checkoutContentVariant:"no-padding",from:"resource",integration:r,onBack:s,product:i,children:(0,t.jsxs)(x.Stack,{gap:5,children:[A?(0,t.jsx)(x.Stack,{className:(0,eg.cn)("border-0 border-b border-solid border-gray-alpha-400 bg-background-200",{"p-6":"modal"===_,"pb-6":"inline"===_}),children:(0,t.jsx)(p.ResourceMetadataFieldsWithErrorBoundary,{integrationId:r.id,isLoading:d,productId:i.id})}):null,F?(0,t.jsx)(x.Stack,{className:(0,el.clsx)("border-0 border-b border-solid border-gray-alpha-400 bg-background-200 px-6",{"pb-6 pt-0":A,"py-6":!A},"inline"===_?" !px-0 pt-0":""),children:F}):null,T||C?null:(0,t.jsx)(x.Stack,{padding:6*("modal"===_),children:k?(0,t.jsx)(B.BillingPlanMetadataErrors,{integrationSlug:r.slug,isInstallationLevel:v}):(0,t.jsx)(B.MarketplaceBillingPlanSelectorWithErrorBoundary,{areMetadataChanged:b,arePermissionsLoading:d,hasLogDrainsSupport:(0,L.isProtocolSupported)(i,"logDrain"),installationId:o,integrationId:r.id,integrationName:r.name,integrationSlug:r.slug,isInstallationLevel:v,metadata:S,productId:i.id,...g})})]})})}var em=e.i(3500331),ex=e.i(3322724),ej=e.i(1595844);function ey(e){let{integration:r,installationBalance:o,product:l,onBack:s,onNext:c,source:d}=e,u=(0,g.getResourceNameLabelByProduct)(l),{name:p,setName:y,resourceNameError:f,characterCount:S,isAtLimit:b}=(0,ej.useResourceName)({product:l,defaultName:`${l.slug.toLowerCase()}-${(0,ej.generateRandomName)()}`}),P=r.flags?.includes(I.LaunchDarklyIntegrationFlags.MarketplaceInstallationOnlyPlan),{isLoading:M,formError:w,metadataState:T}=(0,E.useStoreIntegrationFormContext)(),{plan:A,defaultPlan:L,topUpForm:B,shouldAddTopUpFormStep:F}=(0,h.useMarketplaceBillingPlansContext)(),O=(0,n.useRef)(null),[D,_]=(0,n.useState)(!1),U=(0,ex.useIsMobile)();(0,n.useEffect)(()=>{U||setTimeout(()=>{O.current?.focus(),O.current?.select()},0)},[U]);let z=!!(L&&A?.id!==L.id),V=(0,eu.useInstallMarketplaceProductDisplayMode)();return(0,t.jsx)(m.ResourceModalWrapper,{SuccessAction:(0,t.jsx)(a.Modal.Action,{"data-testid":(0,R.tid)("create-resource-modal","confirm-create"),disabled:!p,loading:M,onClick:()=>{if(_(!0),f)return;let e={integration:{id:r.id,slug:r.slug},productSlug:l.slug},t=d?{...e,source:d}:e;C.analytics.track(k.AnalyticsEvent.MARKETPLACE_RESOURCE_PROVISION_CLICKED,t),c({resourceName:p})},children:(0,g.createResourceConfirmationStepLabel)(l)}),cancelLabel:"Back",checkoutContentVariant:"no-padding",from:"resource",integration:r,onBack:s,product:l,children:(0,t.jsxs)(x.Stack,{gap:5,children:[(0,t.jsxs)(x.Stack,{className:"inline"===V?"bg-background-200":"border-0 border-b border-solid border-gray-alpha-400 bg-background-200 p-6",gap:2.5,children:[(0,t.jsxs)(x.Stack,{gap:1,children:[(0,t.jsx)(em.Input,{"aria-label":`${u} Name`,disabled:M,error:D?f:void 0,label:`${u} Name (*)`,maxLength:ej.MAX_RESOURCE_NAME_LENGTH+1,minLength:ej.MIN_RESOURCE_NAME_LENGTH,onChange:e=>{y(e.currentTarget.value)},placeholder:`${u.toLowerCase().replaceAll(" ","-")}-name`,ref:O,value:p,width:"100%"}),(0,t.jsxs)(j.Text,{color:b?"red-900":"gray-900",size:12,style:{textAlign:"right"},children:[S,"/",ej.MAX_RESOURCE_NAME_LENGTH]})]}),(0,t.jsxs)(j.Text,{color:"gray-900",size:13,children:["This is how we call your ",u," in the Vercel dashboard and in ",r.name,"."]}),l.disableResourceRenaming&&(0,t.jsx)(i.Note,{fill:!0,type:"warning",children:"The name cannot be changed after the resource is created."})]}),(0,t.jsxs)(x.Stack,{gap:4,paddingX:6*("inline"!==V),paddingY:6,children:[(0,t.jsx)(j.Text,{size:16,weight:500,children:"Your Selection"}),z?(0,t.jsx)(i.Note,{fill:!0,type:"secondary",children:"You have selected to upgrade your plan. This upgrade will apply at the installation level."}):null,w.form?(0,t.jsx)(v.Error,{children:w.form}):null,(0,t.jsx)(N.ReadOnlyMetadataWithErrorBoundary,{integrationId:r.id,metadata:T,metadataErrors:w.metadata,productId:l.id,target:"create"}),F&&void 0!==B.getAmountToAdd()?(0,t.jsx)(t.Fragment,{children:(0,t.jsxs)(N.ReadOnlyPanel,{title:"Manage Funds",children:[(0,t.jsx)(N.ReadOnlyPanelRecord,{title:"Initial credit balance",children:(0,t.jsx)(j.Text,{children:B.formatCurrency(B.addFundsForm.getValues().amountToAdd)})}),B.rechargeSettingsForm.getValues().autoRecharge?(0,t.jsx)(t.Fragment,{children:(0,t.jsx)(N.ReadOnlyPanelRecord,{align:"center",title:"Auto recharge",titleWrap:!1,children:(0,t.jsxs)(j.Text,{color:"gray-900",align:"right",className:"text-balance",children:["add"," ",(0,t.jsx)(j.Text,{as:"span",children:B.formatCurrency(B.rechargeSettingsForm.getValues().topUpAmount)})," ","when balance falls below"," ",(0,t.jsx)(j.Text,{as:"span",children:B.formatCurrency(B.rechargeSettingsForm.getValues().topUpThreshold)}),", up to"," ",(0,t.jsx)(j.Text,{as:"span",children:B.formatCurrency(B.rechargeSettingsForm.getValues().periodSpendMaximum)})," ","per month"]})})}):null]})}):(0,t.jsx)(t.Fragment,{children:o?.currencyValueInCents!==void 0?(0,t.jsx)(N.ReadOnlyPanel,{title:(0,t.jsx)(j.Text,{weight:500,children:"Current balance"}),children:(0,t.jsx)(N.ReadOnlyPanelRecord,{title:"Current installation balance",children:(0,t.jsx)(j.Text,{children:B.formatCurrency((o.currencyValueInCents/100).toFixed(2))})})}):null}),P?null:(0,t.jsx)(N.ReadOnlyBillingPlan,{billingPlan:A})]})]})})}function eC(e){let{team:n,configuration:a,requireNew:i,paymentMethodState:r,onBack:o,onNext:l}=e;return(0,t.jsx)(z.PaymentMethodInstallationAction,{installationId:a.id,onBack:o,onNext:l,paymentMethodState:r,requireNew:i,team:n})}var ek=e.i(2083276);function ef(e){let{team:n,authorizationId:i,onChangePaymentMethod:r,onBack:o,onNext:l,integration:s,product:c,resourceName:d,success:u,isTransitioning:p}=e,{authorization:h,error:x,handleUserActions:j}=(0,q.usePollAuthorization)(n.id,i),{formError:y}=(0,E.useStoreIntegrationFormContext)(),C=!!(x||y.form||h?.status==="failed"),k=h?.status==="requires_action",f=(0,g.getResourceTitleByProduct)(c),S=(0,eu.useInstallMarketplaceProductDisplayMode)();return(0,t.jsx)(m.ResourceModalWrapper,{SuccessAction:(0,t.jsx)(a.Modal.Action,{disabled:!u,loading:!C&&!u||p,onClick:()=>l(),children:u?"Done":"Processing"}),cancelLabel:"Back",checkoutContentVariant:"no-padding-no-bottom",disableCancel:!(C||k)||u,from:"resource",integration:s,onBack:o,product:c,children:(0,t.jsx)("div",{className:(0,eg.cn)('"flex flex-col gap-4 "',"inline"===S?"p-0":"p-6"),children:(0,t.jsx)(eS,{authorization:h,error:y.form||(x?`There was an error creating your ${d||f}`:void 0),handleUserActions:j,integration:s,onChangePaymentMethod:r,product:c,resourceName:d,success:u})})})}function eS(e){let{product:n,resourceName:a,authorization:o,error:l,success:s,integration:c,handleUserActions:d,onChangePaymentMethod:u}=e,p=(0,g.getResourceTitleByProduct)(n);return s?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(x.Stack,{align:"center",direction:"row",gap:2,children:[(0,t.jsx)(K.CheckCircle,{color:"green-900",size:16}),(0,t.jsxs)(j.Text,{color:"green-900","data-testid":(0,R.tid)("create-resource-modal","successfully-created"),weight:500,children:[p," Created Successfully"]})]}),(0,t.jsxs)(j.Text,{className:"text-gray-900",children:["Your"," ",(0,t.jsxs)(j.Text,{as:"span",className:"text-gray-1000",children:[c.name," ",p]})," ","has been created successfully."]})]}):o?.status==="requires_action"?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(x.Stack,{align:"center",direction:"row",gap:2,children:[(0,t.jsx)($.Warning,{color:"amber-900",size:16}),(0,t.jsx)(j.Text,{color:"amber-900",weight:500,children:"Authentication Needed"})]}),(0,t.jsx)(j.Text,{className:"text-gray-900",children:"Further action is needed. Please authenticate your payment method to continue."}),(0,t.jsx)(W.Button,{onClick:()=>{d()},children:"Authenticate"})]}):o?.status==="failed"?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(v.Error,{children:"Preauthorization Failed"}),(0,t.jsx)(j.Text,{className:"text-gray-900",children:"There was an error using your payment method. Please try again with a different payment method."}),(0,t.jsx)(W.Button,{onClick:()=>u(),children:"Change Payment Method"})]}):l?(0,t.jsx)(t.Fragment,{children:(0,t.jsxs)(i.Note,{fill:!0,type:"error",children:[(0,ek.default)(l),". Please go back and check your settings before trying again."]})}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(x.Stack,{align:"center",direction:"row",gap:2,children:[(0,t.jsx)(r.Spinner,{size:16}),(0,t.jsx)(j.Text,{size:16,weight:500,children:"Processing"})]}),(0,t.jsxs)(j.Text,{className:"text-gray-900",children:["Hold tight, we're processing your order of"," ",(0,t.jsx)(j.Text,{as:"span",className:"text-gray-1000",children:a||p}),"."]})]})}var eb=e.i(7063289);function eP(e){let n=(0,h.useMarketplaceBillingPlansContext)();return(0,t.jsx)(t.Fragment,{children:(0,t.jsx)(m.ResourceModalWrapper,{SuccessAction:(0,t.jsx)(a.Modal.Action,{disabled:!1,loading:e.isTransitioning,onClick:async()=>{let t=await n.topUpForm.addFundsForm.trigger(),a=await n.topUpForm.rechargeSettingsForm.trigger();t&&a&&e.onNext()},children:"Continue"}),cancelLabel:"Back",checkoutContentVariant:"default",from:"top-up",integration:e.integration,onBack:()=>{e.onBack()},product:e.product,children:(0,t.jsx)(x.Stack,{className:"pb-6",gap:5,children:(0,t.jsx)("form",{children:(0,t.jsx)(eb.TopUpFormFields,{topUpForm:n.topUpForm,variant:"create"})})})})})}var eM=e.i(9871375);let eI=(0,D.withStripe)(function(e){let a,{arePermissionsLoading:i,isTransitioning:r,startTransition:o,team:l,integration:s,product:c,configuration:d,onBack:u,onIntegrationResourceCreate:g,cancelLabel:p,onStepChange:m}=e,x=(0,et.useSearchParams)(),j=x?.get("external-id")||void 0,{connectProjectAndReturnToV0:y}=(0,G.useV0Marketplace)()||{};a=(0,eM.useProjectCloneContext)().projectId?"deploy-button":y?"v0":"marketplace";let{onSubmit:f}=(0,E.useStoreIntegrationFormContext)(),[S,b]=(0,n.useState)("select-plan"),{value:P}=(0,ea.useLaunchDarklyTeamFeatureFlag)("marketplace-prepayment-livemode",l.slug),{createResource:M}=(0,er.useMutateResource)(),{data:I}=(0,ei.useMarketplaceBillingBalance)(d.id),[w,T]=(0,n.useState)(),[A,v]=(0,n.useState)(null),[R,L]=(0,n.useState)(!1),{data:B}=(0,_.useInstallationPaymentMethodState)(d.id),N=(0,U.useAwaitData)(B),{createAuthorization:F}=(0,q.useMarketplaceBillingAuthorizationApi)(),O=(0,q.useAwaitAuthorization)(),[D,V]=(0,n.useState)(null),[W,$]=(0,n.useState)(null),[K,Y]=(0,n.useState)(),H=(0,h.useMarketplaceBillingPlansContext)(),X=(0,n.useCallback)((e,t)=>{if(!e.paymentMethodRequired&&!t)return void b("confirm");o(async()=>{let t=await N;if((0,z.getIsPaymentMethodStepNeeded)(l,t,e))return void b("payment-method");b("confirm")})},[N,o,l]),J=(0,n.useCallback)(()=>{w&&X(w,!0)},[w,X]),Q=(0,n.useCallback)(()=>{b("confirm"),L(!1)},[]),Z=(0,n.useCallback)(()=>{L(!0),b("payment-method")},[]),el=(0,n.useCallback)(()=>{if(!W)throw Error("Not created");o(async()=>{if(y){ee.toasts.success(`Created ${W.name} successfully. Redirecting back to v0.`);try{(0,en.track)("v0/marketplace/integration-connected",{integrationId:s.id,productId:c.id}),await y({integrationId:s.id,productId:c.id,resourceId:W.id,productSlug:c.slug})}catch(t){let e="[object Error]"===Object.prototype.toString.call(t)?t.message:String(t);(0,en.track)("v0/marketplace/integration-connect-failed",{integrationId:s.id,productId:c.id,error:e}),ee.toasts.error("Failed to connect integration to v0.")}}else await g(W)})},[W,o,y,s.id,c.id,c.slug,g]);switch(S){case"select-plan":return(0,t.jsx)(ep,{cancelLabel:p,installationId:d.id,integration:s,isLoading:i,isTransitioning:r,onBack:()=>{m?.(),u()},onNext:(e,t,n)=>{m?.(),function(e,t,n){if(C.analytics.track(k.AnalyticsEvent.MARKETPLACE_PRODUCT_PLAN_SELECTED,{integration:{id:s.id,slug:s.slug},productSlug:c.slug,source:a}),T(t),Y(n),H.shouldAddTopUpFormStep&&("installation"!==t.scope||(I?.balance?.currencyValueInCents??0)===0)){let e=I?.balance?.currencyValueInCents;H.topUpForm.setup({type:"create",billingPlan:t,currentBalance:e?(e/100).toString():void 0}),b("top-up");return}X(t,!1)}(0,t,n)},product:c,type:"product"});case"payment-method":return B?(0,t.jsx)(eC,{configuration:d,onBack:()=>{m?.(),b("select-plan")},onNext:()=>{m?.(),Q()},paymentMethodState:B,requireNew:R,team:l}):null;case"confirm":return(0,t.jsx)(ey,{cancelLabel:p,installationBalance:I?.balance,integration:s,onBack:()=>{m?.(),b("select-plan")},onNext:e=>{m?.(),function(e){let{resourceName:t}=e;v(t),f(async e=>{let{metadata:n}=e;if(b("provisioning"),!w)throw Error("Billing plan is missing");let i=P&&"prepayment"===w.type?H.topUpForm.getAmountToAdd():void 0,r=await F(l.id,{integrationIdOrSlug:s.id,productId:c.id,integrationConfigurationId:d.id,billingPlanId:w.id,metadata:n,prepaymentAmountCents:i});if(V(r?.id??null),r&&"succeeded"!==(await O(l.id,r.id)).status)return;let o=await M({metadata:n,externalId:j,billingPlanId:w.id,name:t,integrationConfigurationId:d.id,integrationProductIdOrSlug:c.id,authorizationId:r?.id??void 0,protocolSettings:K,source:a});if(C.analytics.track(k.AnalyticsEvent.MARKETPLACE_RESOURCE_INSTALL_CLICKED,{integration:{id:s.id,slug:s.slug},productSlug:c.slug,source:a}),"prepayment"===w.type){if(!P){let e=H.topUpForm.getAmountToAdd();void 0!==e&&e>0&&await (0,eo.provisionPurchaseForResourceTestmode)({teamId:l.id,integrationConfigurationId:d.id,resourceId:o.id,billingPlanId:w.id,amountCents:e})}await H.topUpForm.requests.updateRechargeSettingsForResource({billingPlanId:w.id,resourceId:o.id,teamId:l.id,configurationId:d.id,metadata:n})}$(o)},{noTransition:!0,resourceName:t})}({resourceName:e.resourceName})},product:c,source:a});case"provisioning":return(0,t.jsx)(ef,{authorizationId:D,cancelLabel:p,configurationId:d.id,integration:s,isTransitioning:r,onBack:()=>{m?.(),b("confirm")},onChangePaymentMethod:Z,onNext:()=>{m?.(),el()},product:c,resourceName:A,success:!!W,team:l});case"top-up":return(0,t.jsx)(eP,{integration:s,isTransitioning:r,onBack:()=>{m?.(),b("select-plan")},onNext:()=>{m?.(),J()},product:c})}});function ew(e){let{onBack:a,onIntegrationResourceCreate:i,cancelLabel:r,product:l,integration:c,teamSlug:d,team:g,initialConfigurationStatus:p,neonIntegrationStatus:h,onStepChange:m}=e,{team:x}=(0,o.useTeam)(d),j=g??x,{pushToDetailPath:y}=(0,u.usePushToStorePath)(),{configurationStatus:C,onConfigurationInstalled:k}=(0,s.useConfigurationStatus)({initialConfigurationStatus:p}),{data:f}=(0,es.default)(!C.isLoading&&C.isInstalled?C.configuration.id:void 0),[S,b]=(0,n.useState)(!1);if((0,n.useEffect)(()=>{h.isLoading||b(!0)},[h.isLoading]),C.isLoading||!j||h.isLoading&&!S)return(0,t.jsx)(eA,{cancelLabel:r,integration:c,onBack:a,product:l});if(!C.isInstalled)return(0,t.jsx)(X,{cancelLabel:r,checkoutContentVariant:"default",integration:c,isLoading:!c,onBack:a,onSuccess:k,product:l,team:j});if(!f)return(0,t.jsx)(eA,{cancelLabel:r,integration:c,onBack:a,product:l});let P=c.supportsInstallationBillingPlans?f.billingPlan??C.configuration.billingPlan:void 0;return(0,t.jsx)(eT,{onStepChange:m,cancelLabel:r,configuration:f,installationBillingPlan:C.billingPlan??P,integration:c,onBack:a,onIntegrationResourceCreate:i,preselectedBillingPlan:C.billingPlan,product:l,team:j})}function eT(e){let{team:a,installationBillingPlan:r,preselectedBillingPlan:o,integration:s,product:u,configuration:x,onStepChange:j,onBack:y,onIntegrationResourceCreate:C,cancelLabel:k}=e,{canCreateResource:f,isLoading:S,isDeleteRequested:b}=(0,c.useInstallationPermissions)(x.id),[P,M]=(0,n.useTransition)();return b?(0,t.jsx)(m.ResourceModalWrapper,{SuccessAction:null,cancelLabel:k,checkoutContentVariant:"default",from:"resource",integration:s,onBack:y,product:u,children:(0,t.jsx)(i.Note,{type:"warning",children:`${(0,g.pendingDeletionLabel)("create",u,a.name)}`})}):S||f?(0,t.jsx)(p.ResourceFormProvider,{metadataSchema:u.metadataSchema,resourceTitle:d.storeTitle.integration,target:"create",children:(0,t.jsx)(h.MarketplaceInstallationBillingPlansProvider,{defaultPlan:o??r,isBillingPlanPreselected:!!o,target:"create",children:(0,t.jsx)(l.DisabledContext.Provider,{value:S||P,children:(0,t.jsx)(eI,{arePermissionsLoading:S,cancelLabel:k,configuration:x,integration:s,isTransitioning:P,onBack:y,onIntegrationResourceCreate:C,product:u,startTransition:M,team:a,onStepChange:j})})})}):(0,t.jsx)(m.ResourceModalWrapper,{SuccessAction:null,cancelLabel:k,checkoutContentVariant:"default",from:"resource",integration:s,onBack:y,product:u,children:(0,t.jsx)(i.Note,{type:"warning",children:`${(0,g.missingPermissionLabel)("create",u,a.name)}`})})}function eA(e){return(0,t.jsx)(m.ResourceModalWrapper,{SuccessAction:(0,t.jsx)(a.Modal.Action,{buttonType:"submit",disabled:!0,loading:!0,children:"Continue"}),from:"installation",checkoutContentVariant:"default",...e,children:(0,t.jsx)("div",{className:"flex size-full items-center justify-center py-16",children:(0,t.jsx)(r.Spinner,{})})})}},5628754,e=>{"use strict";e.s([]),e.i(5313122),e.i(9203481),e.i(680627),e.i(8026771),e.i(9691190)},15312,e=>{"use strict";e.s(["ResourceModalsProvider",()=>I],15312);var t=e.i(751170),n=e.i(7512194),a=e.i(9508212),i=e.i(6891161),r=e.i(8923565),o=e.i(4099374),l=e.i(7151748),s=e.i(3870297),c=e.i(9668517);e.i(6887680);var d=e.i(6810699),u=e.i(8711152);e.i(5628754);var g=e.i(680627),p=e.i(1017032),h=e.i(5074599),m=e.i(4981413),x=e.i(3758860),j=e.i(7849855),y=e.i(7137779),C=e.i(2483721),k=e.i(3183079),f=e.i(39509),S=e.i(6356390),b=e.i(3679047),P=e.i(3584802);function M(){let e=(0,c.useTeamSlug)(),{data:n}=(0,p.useConfigurations)({type:"marketplace",skipBillingData:!0}),{hasProject:M}=(0,j.useProjectSlug)(),{state:I,onClose:w,onBack:T,onAnimationDone:A,protocolType:v,onResourceUpdated:R,maybeGoToConnectProjectStep:L,goToCreateResourceStep:B,switchTab:N}=(0,k.useResourceModalsContext)(),{data:E}=(0,d.useResourceList)({protocolType:v}),F=(0,b.useRouter)(),O=`create-connect-${I.modalKey}`,[D,_]=(0,o.useState)(),U=(0,o.useRef)(null),z=(0,o.useCallback)(()=>{_(void 0),A()},[A]),V=(0,o.useCallback)(()=>{_(void 0),w()},[w]),W=(0,o.useCallback)(e=>{R({resource:e,isConnected:!1}),L(e)},[L,R]);switch(I.type){case f.ResourceModalsActionTypes.ModalClosed:return(0,t.jsx)(i.Modal.Modal,{active:I.active,allowOverflow:!0,onAnimationDone:z,onClickOutside:w,width:620,children:(0,t.jsx)("div",{})},O);case f.ResourceModalsActionTypes.BrowseProudctsOrSelectResources:return(0,t.jsx)(i.Modal.Modal,{active:I.active,allowOverflow:!0,onAnimationDone:z,onClickOutside:w,width:"browse-new"===I.tab?540:620,children:(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(i.Modal.Body,{className:"p-8",children:(0,t.jsxs)(a.Stack,{gap:6,ref:U,children:[(0,t.jsx)(a.Stack,{gap:2,children:(0,t.jsx)(i.Modal.Title,{center:!0,children:(0,h.browseProductsOrSelectResourcesModalTitle)(v)})}),(0,t.jsxs)(r.Switch,{name:"switch-new-existing-tab",children:[(0,t.jsx)(r.Switch.Control,{defaultChecked:"browse-new"===I.tab,label:"Create New",onChange:()=>{N("browse-new")},size:"large",value:"create",width:104}),(0,t.jsx)(r.Switch.Control,{defaultChecked:"browse-existing"===I.tab,disabled:E?.stores.length===0,label:"Select Existing",onChange:()=>{N("browse-existing")},size:"large",value:"connect",width:122})]}),"browse-new"===I.tab?(0,t.jsx)(m.BrowseProducts,{onClickProduct:e=>{_(e)},protocolType:v,selectedProduct:D}):null,"browse-existing"===I.tab?(0,t.jsx)(g.SelectResources,{hasCreateConnectButton:!1,onClickConnectStoreModal:e=>L(e),protocolType:v}):null]})}),(0,t.jsxs)(i.Modal.Actions,{children:[(0,t.jsx)(i.Modal.Action,{onClick:V,type:"secondary",children:"Cancel"}),"browse-new"===I.tab?(0,t.jsx)(i.Modal.Action,{disabled:!D,onClick:()=>{D&&("integration"===D.type?F.push((0,P.getIntegrationCheckoutUrl)({params:{teamSlug:e??"",integrationSlug:D.integration.slug},searchParams:{productSlug:D.product.slug,cancelUrl:`${window.location.pathname}${window.location.search}`}})):B(D))},children:"Continue"}):null]})]})},O);case f.ResourceModalsActionTypes.BrowseProducts:return(0,t.jsx)(i.Modal.Modal,{active:I.active,allowOverflow:!0,onAnimationDone:z,onClickOutside:w,width:540,children:(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(i.Modal.Body,{className:"p-8",children:(0,t.jsxs)(a.Stack,{gap:6,ref:U,children:[(0,t.jsx)(a.Stack,{gap:2,children:(0,t.jsx)(i.Modal.Title,{center:!0,children:(0,h.browseProductsModalTitle)(v)})}),(0,t.jsx)(m.BrowseProducts,{onClickProduct:e=>{_(e)},protocolType:v,selectedProduct:D})]})}),(0,t.jsxs)(i.Modal.Actions,{children:[(0,t.jsx)(i.Modal.Action,{onClick:V,type:"secondary",children:"Cancel"}),(0,t.jsx)(i.Modal.Action,{disabled:!D,onClick:()=>{D&&("integration"===D.type?(F.push((0,P.getIntegrationCheckoutUrl)({params:{teamSlug:e??"",integrationSlug:D.integration.slug},searchParams:{productSlug:D.product.slug,cancelUrl:`${window.location.pathname}${window.location.search}`}})),l.analytics.track(s.AnalyticsEvent.MARKETPLACE_PRODUCT_INSTALL_CLICKED,{source:"storage",integration:{id:D.integration.id,slug:D.integration.slug},productSlug:D.product.slug})):B(D))},children:"Continue"})]})]})},O);case f.ResourceModalsActionTypes.CreateResource:{if("integration"!==I.resourceWithProduct.type)return null;let a=I.resourceWithProduct.integration;return(0,t.jsx)(i.Modal.Modal,{active:I.active,allowOverflow:!0,onAnimationDone:z,onClickOutside:w,width:540,children:(0,t.jsx)(S.CreateResourceModal,{cancelLabel:I.backOrCancelLabel,initialConfigurationStatus:(0,u.getConfigurationStatusByIntegrationId)(n,a.id),integration:a,neonIntegrationStatus:{isNeonDisabled:!1,isLoading:!1},onBack:T,onIntegrationResourceCreate:W,product:(0,x.getProductWithSupportedProtocols)(I.resourceWithProduct.product),teamSlug:e??""})},O)}case f.ResourceModalsActionTypes.CreateEnvs:if(I.connection)return(0,t.jsx)(y.UpdateResourceConnectionModal,{active:I.active,connection:I.connection,onAnimationDone:z,onClickOutside:w,onConnectionCreated:()=>R({resource:I.resource,isConnected:!0}),resourceId:I.resource.id,store:I.resource},O);if(M)return(0,t.jsx)(i.Modal.Modal,{active:I.active,allowOverflow:!0,onAnimationDone:z,onClickOutside:w,width:540,children:(0,t.jsx)(y.ConnectResourceForCurrentProjectStep,{resource:I.resource})},O);return(0,t.jsx)(y.CreateResourceConnectionModal,{active:I.active,onAnimationDone:z,onClickOutside:w,onConnectionCreated:()=>R({resource:I.resource,isConnected:!0}),resourceId:I.resource.id,store:I.resource},O);case f.ResourceModalsActionTypes.DeleteEnvs:return(0,t.jsx)(C.DeleteStoreConnectionModal,{active:I.active,connections:I.connections,onAnimationDone:z,onClickOutside:w,resourceId:I.resourceId,resourceTitle:(0,h.getResourceTitleByResource)(I.resource)},O)}}function I(e){let{children:a,protocolType:i}=e;return(0,t.jsx)(n.ResourceModalsProviderBase,{Modal:(0,t.jsx)(M,{}),protocolType:i,children:a})}}]);

//# sourceMappingURL=930fb83d75796d7b.js.map
//# debugId=bb4103f8-e9c2-5074-9c56-cd9e14c1be89
