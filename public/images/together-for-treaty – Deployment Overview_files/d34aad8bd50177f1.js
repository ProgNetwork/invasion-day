
!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="754551aa-365a-5ae7-9e4b-4bf413b7f034")}catch(e){}}();
(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,5765731,e=>{"use strict";e.s(["useConnectableIntegrations",()=>a]);var t=e.i(2704354),r=e.i(9668517),i=e.i(9014736);function a(){let e=(0,r.useTeamSlug)();return(0,i.default)(e?(0,t.getMarketplaceIntegrationsApiUrl)({integrationType:"external",teamIdOrSlug:e}):null,e=>fetch(e).then(e=>e.json()))}},8584705,e=>{e.v({formEndpointVerify:"form-verify-endpoint-module__Tdpw0W__formEndpointVerify",inputCheckIcon:"form-verify-endpoint-module__Tdpw0W__inputCheckIcon",spinner:"form-verify-endpoint-module__Tdpw0W__spinner",verifyContent:"form-verify-endpoint-module__Tdpw0W__verifyContent"})},9165020,e=>{e.v({inputWrapper:"form-custom-secret-module__CNf-xW__inputWrapper"})},5675763,6054173,915e3,e=>{"use strict";e.s(["FormEnvironment",()=>o],5675763);var t=e.i(751170),r=e.i(3869281),i=e.i(9508212),a=e.i(4004502),s=e.i(5744676),n=e.i(2098824);function o(e){let{disabled:o,onEnvironmentsChanged:l,environments:c}=e;return(0,t.jsxs)(i.Stack,{gap:3,children:[(0,t.jsx)("div",{children:(0,t.jsx)(n.FormTitleDescription,{description:"Logs from the selected environments will be forwarded to your webhook. At least one must be selected.",title:"Environments"})}),(0,t.jsx)(i.Stack,{direction:"row",gap:6,children:s.DEFAULT_LOG_ENVIRONMENTS.map(e=>(0,t.jsx)(r.Checkbox,{checked:c.includes(e),"data-testid":(0,a.tid)("log-drain-environment",e),disabled:o,onChange:()=>{c.includes(e)?l(c.filter(t=>t!==e)):l([...c,e])},children:s.LOG_ENVIRONMENT_LABELS[e]},e))})]})}e.s(["CustomNameForm",()=>d],6054173);var l=e.i(3500331),c=e.i(9165020);function d(e){let{onCustomNameUpdated:r,title:a,description:s,name:o}=e;return(0,t.jsxs)(i.Stack,{gap:3,children:[(0,t.jsx)("div",{children:(0,t.jsx)(n.FormTitleDescription,{description:s,title:a})}),(0,t.jsx)("div",{className:c.default.inputWrapper,children:(0,t.jsx)(l.Input,{id:"custom-name",maxLength:300,onChange:e=>r(e.target.value.trim()),placeholder:"Defaults to the domain name of your log drain url",value:o,width:"100%"})})]})}e.s(["useLogDrainsData",()=>f,"useLogDrainsResources",()=>v],915e3);var u=e.i(2521731);e.i(6887680);var p=e.i(6810699);e.i(553769);var h=e.i(3758860),g=e.i(1017032),m=e.i(5765731),x=e.i(4325157);let j={"<100":0,"<500":1,">500":2,"<1000":3,">1000":4};function f(){let{data:e}=(0,g.useConfigurations)({skipBillingData:!0}),t=v(),r=function(e){let{logDrainsResources:t}=e,r=(0,x.useMarketplaceIntegrations)({protocolType:"logDrain"});return r.data?.flatMap(e=>e.products.filter(e=>(0,h.isProtocolSupported)(e,"logDrain")&&!t?.some(t=>t.product.id===e.id)).map(t=>({product:t,integration:e})))}({logDrainsResources:t}),i=(0,m.useConnectableIntegrations)(),a=Array.isArray(i.data)?i.data.filter(t=>!!(0,u.integrationSupportsLogDrains)(t)&&!e?.some(e=>"external"===e.installationType&&e.integrationId===t.id)).sort((e,t)=>j[e.installs]<j[t.installs]?1:-1):[];return{marketplaceConfigurations:e?.filter(e=>"marketplace"===e.installationType),logDrainsResources:t,availableProducts:r,logDrainExternalIntegrations:a}}function y(e,t){t&&t.forEach(t=>{(0,h.isProtocolSupported)(t.product,"logDrain")&&e.set(t.id,t)})}function v(){let{data:e}=(0,p.useResourceList)({protocolType:"observability"}),{data:t}=(0,p.useResourceList)({protocolType:"logDrain"}),r=new Map;return y(r,e?.stores),y(r,t?.stores),e&&t?Array.from(r.values()):void 0}},879779,e=>{e.v({buttonAdd:"form-custom-headers-module__9G3V9W__buttonAdd",customHeadersList:"form-custom-headers-module__9G3V9W__customHeadersList",customHeadersWrapper:"form-custom-headers-module__9G3V9W__customHeadersWrapper"})},4180282,829957,9819864,e=>{"use strict";e.s(["FormCustomHeaders",()=>f],4180282);var t=e.i(751170),r=e.i(4099374),i=e.i(6226725),a=e.i(2504781),s=e.i(3500331),n=e.i(9508212),o=e.i(1344973),l=e.i(1906681),c=e.i(2445303),d=e.i(879779);function u(e,t){return e.url?t.isVerified?0===e.sources.length?"At least one source is required":0===e.environments.length?"At least one environment is required":"secret"in e&&e.secret&&g(e.secret)?g(e.secret):e.projectIds&&0===e.projectIds.length?"At least one project is required":0===e.samplingRate?"Sampling rate must be greater than 0":null:"The Endpoint must be verified.":"An Endpoint is required!"}function p(e,t){return t.deliveryFormat!==e.deliveryFormat?"Delivery format cannot be changed":new URL(e.url).hostname!==new URL(t.url).hostname?"Domain cannot be changed":null}function h(e,t){let r=[];for(let i=e;i<t;i++)r.push(i);return r}e.s(["validateHeaderName",()=>x,"validateHeaderValue",()=>j,"validateLogDrainForm",()=>u,"validateUpdateLogDrain",()=>p],829957);let g=e=>e.length<30?`Secret needs to have at least 30 characters. The current length is ${e.length}.`:null;function m(e){return"[object String]"!==Object.prototype.toString.call(e)||0===e.length}let x=e=>{if(m(e))return!1;let t=[].concat(h(48,58)).concat(h(65,91)).concat(h(97,123)).concat([94,95,96,124,126]).concat([33,35,36,37,38,39,42,43,45,46]);return e.split("").map(e=>e.charCodeAt(0)).every(e=>t.includes(e))},j=e=>!m(e)&&e.split("").map(e=>e.charCodeAt(0)).every(e=>e>31&&e<=255&&127!==e||9===e);function f(e){let{headers:u,hasInitialCustomHeaders:p,onHeadersUpdated:h,showToggle:g=!0,placeholder:m}=e,[f,y]=(0,r.useState)(p);(0,r.useEffect)(()=>{y(p)},[p]);let[v,S]=(0,r.useState)({key:"",value:""}),k=Object.keys(u??{}),C=(0,r.useCallback)(()=>{let e=!f;y(e),h(e?u:void 0)},[f,u,h]),b=(0,r.useCallback)(()=>{let e={...u,[v.key]:v.value};S({key:"",value:""}),h(e)},[u,v,h]),T=(0,r.useCallback)(e=>{x(e.target.value)&&S({...v,key:e.target.value})},[v]),L=(0,r.useCallback)(e=>{j(e.target.value)&&S({...v,value:e.target.value})},[v]);return(0,t.jsxs)(n.Stack,{gap:3,children:[g?(0,t.jsxs)(n.Stack,{align:"center",direction:"row",gap:3,children:[(0,t.jsx)(l.Toggle,{checked:f,id:"custom-headers",onChange:C,size:"large"}),(0,t.jsx)(o.Text,{as:"label",color:"inherit",htmlFor:"custom-headers",children:"Custom Headers"})]}):null,f?(0,t.jsxs)(n.Stack,{className:d.default.customHeadersWrapper,gap:5,children:[(0,t.jsxs)(n.Stack,{direction:"row",gap:3,children:[(0,t.jsxs)(n.Stack,{flex:1,gap:2,children:[(0,t.jsx)(o.Text,{color:"gray-900",size:12,weight:600,children:"Header Key"}),(0,t.jsx)(s.Input,{id:"custom-header-key",onChange:T,placeholder:"x-header-key",value:v.key,width:"100%"})]}),(0,t.jsxs)(n.Stack,{flex:1,gap:2,children:[(0,t.jsx)(o.Text,{color:"gray-900",size:12,weight:600,children:"Header Value"}),(0,t.jsx)(s.Input,{id:"custom-header-value",onChange:L,placeholder:m??"custom value",value:v.value,width:"100%"})]}),(0,t.jsx)(a.Button,{className:d.default.buttonAdd,disabled:!v.key||!v.value||5===k.length,onClick:b,children:"Add"})]}),(0,t.jsxs)(n.Stack,{className:d.default.customHeadersList,gap:3,children:[0===k.length&&(0,t.jsx)(n.Stack,{align:"center",children:(0,t.jsx)(o.Text,{color:"gray-900",children:"Add up to 5 custom headers"})}),u?k.map(e=>(0,t.jsxs)(n.Stack,{direction:"row",gap:3,justify:"space-between",children:[(0,t.jsxs)(o.Text,{color:"gray-900",monospace:!0,children:[e,": ",u[e]]}),(0,t.jsx)(n.Stack,{align:"center",children:(0,t.jsx)(c.IconAction,{Icon:i.CrossCircle,onAction:()=>{let{[e]:t,...r}=u;h(r)}})})]},e)):null]})]}):null]})}e.s(["FormDeliveryFormat",()=>k],9819864);var y=e.i(1848296),v=e.i(5744676),S=e.i(2098824);function k(e){let{onDeliveryFormatChanged:r,deliveryFormat:i,disabled:a}=e;return(0,t.jsxs)(n.Stack,{gap:3,children:[(0,t.jsx)("div",{children:(0,t.jsx)(S.FormTitleDescription,{description:"Format log data should be delivered in.",title:"Delivery Format"})}),(0,t.jsx)(y.RadioGroup,{disabled:a,onChange:e=>{r&&r(e)},value:i,children:(0,t.jsxs)(n.Stack,{direction:"row",gap:6,children:[(0,t.jsx)(y.RadioGroup.Item,{value:v.DeliveryFormats.JSON,children:"JSON"}),(0,t.jsx)(y.RadioGroup.Item,{value:v.DeliveryFormats.NDJSON,children:"NDJSON"})]})})]})}},971617,e=>{e.v({projectSelectItem:"project-select-item-module__D1hM1a__projectSelectItem"})},2565125,e=>{"use strict";e.s(["ProjectSelector",()=>m,"ProjectTypes",()=>g],2565125);var t=e.i(751170),r=e.i(9508212),i=e.i(1848296),a=e.i(5255926),s=e.i(3917098),n=e.i(2098824),o=e.i(6226725),l=e.i(1344973),c=e.i(4004502),d=e.i(6048771),u=e.i(2445303),p=e.i(971617);function h(e){let{project:i,onRemove:a,disabled:s}=e;return(0,t.jsxs)("div",{className:p.default.projectSelectItem,"data-testid":(0,c.tid)("project-selected","item"),children:[(0,t.jsxs)(r.Stack,{align:{sm:"flex-start",lg:"center"},direction:{sm:"column",lg:"row"},gap:2,children:[(0,t.jsxs)(r.Stack,{align:"center",direction:"row",gap:2,children:[(0,t.jsx)(d.ProjectLogo,{deploymentId:i.latestDeployments?.[i.latestDeployments.length-1]?.id,framework:i.framework,project:i,size:20}),(0,t.jsx)(l.Text,{color:"gray-900",weight:600,children:i.name})]}),(0,t.jsx)(l.Text,{color:"gray-900",children:i.targets?.production?.alias?.[0]})]}),a&&!s?(0,t.jsx)(u.IconAction,{Icon:o.CrossCircle,onAction:()=>a(i.id)}):null]},i.id)}var g=function(e){return e.ALL="all",e.SOME="some",e}({});function m(e){let{projects:a,projectType:o,onProjectTypeUpdated:l,onProjectsUpdated:c,title:d,description:u,disabled:p,isLoading:g,loadingCount:m}=e;return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(r.Stack,{gap:3,children:[(0,t.jsx)("div",{children:(0,t.jsx)(n.FormTitleDescription,{description:u,title:d})}),(0,t.jsx)(i.RadioGroup,{disabled:p,onChange:e=>l(e),value:o,children:(0,t.jsxs)(r.Stack,{direction:"row",gap:6,children:[(0,t.jsx)(i.RadioGroup.Item,{value:"all",children:"All Team Projects"}),(0,t.jsx)(i.RadioGroup.Item,{value:"some",children:"Specific Projects"})]})})]}),"some"===o&&(0,t.jsxs)(r.Stack,{gap:3,children:[(0,t.jsx)(s.ProjectSelect,{disabled:p,hasLogo:!0,onSelect:e=>{c([...a,e])},selected:a,verifyIntegrationsPermissions:!1}),g?(0,t.jsx)(x,{count:m}):a.length?(0,t.jsx)("div",{children:a.map(e=>(0,t.jsx)(h,{disabled:p,onRemove:e=>c(a.filter(t=>t.id!==e)),project:e},e.id))}):null]})]})}function x(e){let{count:i=2}=e;return 0===i?null:(0,t.jsx)(t.Fragment,{children:(0,t.jsx)("div",{className:"",children:Array.from({length:i}).map((e,i)=>(0,t.jsxs)(r.Stack,{direction:"row",gap:3,justify:"space-between",className:"p-4 first:border-t border-t-0 border-l border-r border-b border-gray-alpha-400",children:[(0,t.jsxs)(r.Stack,{direction:"row",gap:3,children:[(0,t.jsx)(a.Skeleton,{width:20,height:20,boxHeight:20,rounded:!0}),(0,t.jsx)(a.Skeleton,{width:180,height:14}),(0,t.jsx)(a.Skeleton,{width:120,height:12})]}),(0,t.jsx)(a.Skeleton,{width:20,height:20,rounded:!0})]},i))})})}},1703516,e=>{e.v({codeWrapper:"add-logdrain-modal-module__kqGeqW__codeWrapper",modalMain:"add-logdrain-modal-module__kqGeqW__modalMain",modalTitle:"add-logdrain-modal-module__kqGeqW__modalTitle",secret:"add-logdrain-modal-module__kqGeqW__secret",secretWarn:"add-logdrain-modal-module__kqGeqW__secretWarn",secretWarnText:"add-logdrain-modal-module__kqGeqW__secretWarnText",secretWrapper:"add-logdrain-modal-module__kqGeqW__secretWrapper"})},1717983,e=>{"use strict";e.s(["CreateLogDrainModal",()=>ex],1717983);var t=e.i(751170),r=e.i(9508212),i=e.i(1344973),a=e.i(6891161),s=e.i(5499338),n=e.i(248550),o=e.i(4099374),l=e.i(5338940),c=e.i(7218483);e.i(5463680);var d=e.i(6356390);e.i(553769);var u=e.i(3758860),p=e.i(5074599);e.i(8703064);var h=e.i(6798946),g=e.i(4065455),m=e.i(8711152),x=e.i(1017032);e.i(7037808);var j=e.i(7137779),f=e.i(8824424);e.i(3182268);var y=e.i(7849855),v=e.i(6060673),S=e.i(3573347),k=e.i(2504781),C=e.i(7137884),b=e.i(455575),T=e.i(57106),L=e.i(4004502),_=e.i(1119178),w=e.i(5744676),D=e.i(9668517),A=e.i(6292193),I=e.i(2565125),N=e.i(762945),R=e.i(1201436),F=e.i(2560270),V=e.i(7807066),M=e.i(7808943),E=e.i(545405),P=e.i(2844165);function W(){return(0,t.jsxs)("div",{children:[(0,t.jsxs)(i.Text,{as:"span",color:"gray-900",children:["Learn more about"," "]}),(0,t.jsx)(T.Link,{external:!0,href:"/docs/log-drains/log-drains-reference#secure-log-drains",type:"secondary",children:"Securing Log Drains"})]})}var O=e.i(2445303),H=e.i(1703516);function B(e){let{logDrain:s,onClose:n}=e,l=(0,b.useToasts)(),[c,d]=(0,o.useState)(!1),u=(0,o.useCallback)(()=>{(0,E.copyToClipboard)(s?.secret??""),l.message("Log Drain secret copied to clipboard.")},[l,s?.secret]);return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(a.Modal.Body,{children:[(0,t.jsx)(a.Modal.Header,{children:(0,t.jsx)(i.Text,{align:"center",as:"h1",className:H.default.modalTitle,size:24,children:"Log Drain Created"})}),(0,t.jsxs)(r.Stack,{gap:6,children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(i.Text,{monospace:!0,weight:500,children:"Make sure to secure all Log Drains requests"}),(0,t.jsxs)(i.Text,{children:["Confirm authenticity by comparing the"," ",(0,t.jsx)(M.default,{children:"x-vercel-signature"})," request header to a dynamically generated SHA based on:"]})]}),(0,t.jsxs)(r.Stack,{align:"center",className:H.default.secretWrapper,direction:"row",gap:1,justify:"space-between",children:[(0,t.jsxs)(r.Stack,{direction:"row",children:[(0,t.jsx)(i.Text,{children:"Secret:"}),(0,t.jsx)(i.Text,{className:H.default.secret,color:"pink-900","data-testid":(0,L.tid)("webhooks","secret"),children:s?.secret})]}),(0,t.jsx)(O.IconAction,{Icon:R.Copy,onAction:u})]}),(0,t.jsxs)(r.Stack,{align:"center",className:H.default.secretWarn,direction:"row",gap:3,children:[(0,t.jsx)(N.Warning,{}),(0,t.jsx)(i.Text,{className:H.default.secretWarnText,children:"This secret will not be shown again"})]}),(0,t.jsxs)(r.Stack,{direction:"row",gap:2,children:[(0,t.jsx)(O.IconAction,{Icon:c?F.ChevronDown:V.ChevronRight,onAction:()=>d(!c),size:20}),(0,t.jsx)(i.Text,{color:"gray-900",lineHeight:20,weight:600,children:"How to verify request headers"})]}),c?(0,t.jsx)("div",{className:H.default.codeWrapper,children:(0,t.jsx)(P.CodeHighlight,{highlightedLinesNumbers:void 0,language:"javascript",children:`const crypto = require('crypto');

async function verifySignature(req) {
  const signature = crypto
    .createHmac('sha1', process.env.LOG_DRAIN_SECRET)
    .update(JSON.stringify(req.body))
    .digest('hex');
  return signature === req.headers['x-vercel-signature'];
}`})}):null,(0,t.jsx)(W,{})]})]}),(0,t.jsx)(a.Modal.Actions,{children:(0,t.jsx)(a.Modal.Action,{fullWidth:!0,onClick:n,children:"Done"})})]})}var q=e.i(6848986),U=e.i(8761240),G=e.i(5756088),z=e.i(3500331),J=e.i(8735244),$=e.i(7917902),Y=e.i(6597743),K=e.i(277234),Q=e.i(4244280),X=e.i(1717203),Z=e.i(7557283),ee=e.i(2098824),et=e.i(8584705),er=e.i(4180282);function ei(e){var a;let{title:s="Endpoint",placeholder:n,description:o,endpoint:c,onUrlChanged:d,secret:u}=e,{team:p}=(0,$.useAccount)(),h=p?.id?(a=p.id,(0,q.createHash)("sha1").update(a).digest("hex")):null,{trigger:g,isMutating:m,error:x}=((e,t)=>{let{endpoint:r,secret:i}=e,{isReady:a,team:s}=(0,l.useTeam)(),{can:n,isLoading:o}=(0,X.default)(),c=(0,b.useToasts)(),d=n(Z.Action.Read,Z.Resource.EndpointVerification),u=(0,Y.default)(()=>{if(!a||o||!d||!s?.id||!r.url)return null;let e=new URLSearchParams;return e.set("skip[]","logs-domains"),s.id&&e.set("teamId",s.id),`${Q.API_VERIFY_ENDPOINT}?${e.toString()} `},async e=>{if(r.url&&!(e=>{try{return new URL(e),!0}catch(e){return!1}})(r.url))return c.error("Invalid URL. Please provide a valid URL to verify."),{...r,isVerified:!1,xVercelVerify:u.data?.xVercelVerify??""};try{let t=await (0,K.fetchAPI)(e,{method:"POST",body:JSON.stringify({url:r.url,headers:r.headers,secret:i}),throwOnHTTPError:!0});return{...r,xVercelVerify:t.xVercelVerify,isVerified:!0}}catch(e){if(!e.xVercelVerify)throw e;return r.url&&c.error("URL verification failed. Please make sure to respond with a 200 status code and the provided header to verify ownership of the URL."),{...r,xVercelVerify:e.xVercelVerify,isVerified:!1}}},t);return u})({endpoint:c,secret:u},{onSuccess:e=>{e.isVerified&&e.url===c.url&&d({url:c.url,headers:c.headers,isVerified:e.isVerified,hasCustomHeaders:c.hasCustomHeaders})}});return(0,t.jsxs)(r.Stack,{gap:3,children:[(0,t.jsx)("div",{children:(0,t.jsx)(ee.FormTitleDescription,{as:"label",description:o,htmlFor:"endpoint-url",title:s})}),(0,t.jsx)(z.Input,{disabled:m,explicitId:"endpoint-url",id:"endpoint-url",maxLength:300,onChange:e=>d({...c,url:e.target.value,isVerified:!1}),placeholder:n,suffix:c.isVerified?(0,t.jsx)(U.CheckCircleFill,{color:"green-700"}):null,suffixStyling:!1,value:c.url,width:"100%"}),!c.isVerified&&h&&c.url||x?(0,t.jsxs)(r.Stack,{align:"center",className:et.default.formEndpointVerify,direction:{sm:"column",md:"row",lg:"row"},gap:3,justify:"space-between",children:[(0,t.jsxs)(r.Stack,{align:"center",direction:"row",gap:3,children:[(0,t.jsx)(G.LockClosed,{className:"shrink-0",size:24}),x||!h?(0,t.jsx)("div",{children:"Unable to generate the verification code"}):(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:et.default.verifyContent,children:["Verify URL ownership by responding with status code"," ",(0,t.jsx)(i.Text,{as:"span",color:"pink-900",monospace:!0,children:"`200`"}),"and the following header:"," "]}),(0,t.jsxs)("div",{className:et.default.verifyContent,children:["`<x-vercel-verify: ",(0,t.jsx)(i.Text,{as:"span",color:"pink-900",monospace:!0,children:h}),">`"]})]})]}),m||x?(0,t.jsx)(r.Stack,{className:et.default.spinner,justify:"center",children:(0,t.jsx)(J.Spinner,{})}):(0,t.jsx)(k.Button,{onClick:(0,_.promiseToCallback)(()=>g()),typeName:"submit",children:"Verify"})]}):null,(0,t.jsx)(er.FormCustomHeaders,{hasInitialCustomHeaders:c.hasCustomHeaders,headers:c.headers,onHeadersUpdated:e=>d({...c,headers:e,isVerified:!1,hasCustomHeaders:!0})})]})}var ea=e.i(829957),es=e.i(9819864),en=e.i(783806),eo=e.i(5675763),el=e.i(9165020);function ec(e){let{onCustomSecretUpdated:i,title:a,description:s,secret:n}=e;return(0,t.jsxs)(r.Stack,{gap:3,children:[(0,t.jsx)("div",{children:(0,t.jsx)(ee.FormTitleDescription,{description:s,title:a})}),(0,t.jsx)("div",{className:el.default.inputWrapper,children:(0,t.jsx)(z.Input,{id:"custom-secret",maxLength:300,onChange:e=>i(e.target.value.trim()),placeholder:"e.g. at_least_32_characters_long_secret_password",value:n??"",width:"100%"})})]})}var ed=e.i(8346890),eu=e.i(6054173);function ep(e){let{onBack:s,onCreated:n}=e,l=(0,b.useToasts)(),[c,d]=(0,o.useState)(!1),u=(0,D.useTeamSlug)(),{createLogDrain:p,testLogDrain:h,permissions:g}=(0,S.useLogDrainsOperations)({teamSlug:u??null}),[m,x]=(0,o.useState)({url:"",isVerified:!1,hasCustomHeaders:!1}),[j,f]=(0,o.useState)(w.DeliveryFormats.JSON),[y,v]=(0,o.useState)([]),[L,N]=(0,o.useState)(I.ProjectTypes.ALL),[R,F]=(0,o.useState)([]),[V,M]=(0,o.useState)(null),[E,P]=(0,o.useState)(void 0),[W,O]=(0,o.useState)(void 0),[H,q]=(0,o.useState)(w.DEFAULT_LOG_ENVIRONMENTS),[U,G]=(0,o.useState)([100]),z=y.length>0&&m.url,J=async()=>{try{await h({sources:y,deliveryFormat:j,url:m.url,headers:m.headers,secret:E}),l.success({key:"test-log-drain",text:"Test log drain sent successfully"})}catch(e){l.error({key:"test-log-drain-error",text:`Test log drain failed: ${e.message}`})}},$=(0,o.useMemo)(()=>({sources:y,deliveryFormat:j,name:W,url:m.url,projectIds:L===I.ProjectTypes.ALL?void 0:R.map(e=>e.id),headers:m.headers,secret:E&&0!==E.length?E:void 0,environments:H,samplingRate:100===U[0]?void 0:U[0]/100}),[y,j,m,L,R,E,W,H,U]),Y=(0,o.useCallback)(()=>{let e=(0,ea.validateLogDrainForm)($,m);if(e)return void l.error({key:"log_drain_api_error",text:e});d(!0)},[m,$,l]),K=(0,o.useCallback)(async()=>{let e=(0,ea.validateLogDrainForm)($,m);if(e)return void l.error({key:"log_drain_api_error",text:e});try{let e=await p($);M(e),v([]),f(w.DeliveryFormats.JSON),x({url:"",isVerified:!1,hasCustomHeaders:!1}),N(I.ProjectTypes.ALL),F([]),q(w.DEFAULT_LOG_ENVIRONMENTS),G([100])}catch(e){l.error(e?.message??"An error occurred while creating the Log Drain")}finally{d(!1)}},[$,l,p,m]),Q=g.isLoading||!g.create;return(0,t.jsxs)(t.Fragment,{children:[V||c?null:(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(a.Modal.Body,{children:[(0,t.jsxs)(r.Stack,{gap:2,children:[(0,t.jsx)(a.Modal.Title,{center:!0,children:"Add a Log Drain"}),(0,t.jsx)(a.Modal.Subtitle,{children:(0,t.jsx)(i.Text,{align:"center",color:"gray-900",children:Q?"You need additional permissions to manage Log Drains.":(0,t.jsxs)("span",{children:["Learn more about"," ",(0,t.jsx)(T.Link,{external:!0,href:"/docs/log-drains/log-drains-reference",type:"highlight",children:"Log Drains"})]})})})]}),(0,t.jsxs)(C.FieldsetContent,{disabled:Q,noPadding:!0,children:[(0,t.jsxs)(r.Stack,{gap:6,children:[(0,t.jsx)(I.ProjectSelector,{description:"Choose which projects should send logs to the specified endpoint.",disabled:Q,onProjectTypeUpdated:N,onProjectsUpdated:F,projectType:L,projects:R,title:"Projects"}),(0,t.jsx)(en.FormLogSources,{disabled:Q,onSourcesChanged:v,selectedSourceValues:y,sources:w.LogSourcesWithDescription}),(0,t.jsx)(es.FormDeliveryFormat,{deliveryFormat:j,disabled:Q,onDeliveryFormatChanged:f}),(0,t.jsx)(ec,{description:"Set custom secret (Optional).",onCustomSecretUpdated:P,secret:E,title:"Custom Secret"}),(0,t.jsx)(eu.CustomNameForm,{description:"Set custom name (Optional).",name:W,onCustomNameUpdated:O,title:"Custom Name"}),(0,t.jsx)(eo.FormEnvironment,{disabled:Q,environments:H,onEnvironmentsChanged:q}),(0,t.jsx)("form",{children:(0,t.jsx)(ed.FormSamplingRate,{disabled:Q,onSamplingRateChanged:G,samplingRate:U})}),(0,t.jsx)(ei,{description:(0,t.jsxs)(i.Text,{as:"span",children:["Logs will be forwarded as ",(0,t.jsx)(A.InlineCode,{children:"POST"})," ","request to this URL."]}),endpoint:m,onUrlChanged:x,placeholder:"https://my-app.com/log-drain",secret:E,title:"Endpoint"})]}),(0,t.jsx)(r.Stack,{align:"center",className:"mt-4",direction:"row",gap:3,justify:"end",children:(0,t.jsx)(k.Button,{disabled:!z||Q,onClick:(0,_.promiseToCallback)(J),size:"small",type:"secondary",typeName:"submit",children:"Test Log Drain"})})]})]}),(0,t.jsxs)(a.Modal.Actions,{children:[(0,t.jsx)(a.Modal.Action,{onClick:s,type:"secondary",children:"Back"}),(0,t.jsx)(a.Modal.Action,{disabled:!m.isVerified,onClick:Y,children:"Add Log Drain"})]})]}),V?(0,t.jsx)(B,{logDrain:V,onClose:()=>{M(null),n()}}):null,c?(0,t.jsx)(eh,{onClose:()=>d(!1),onConfirm:(0,_.promiseToCallback)(K)}):null]})}function eh(e){let{onConfirm:s,onClose:n}=e,[l,c]=(0,o.useState)(!1);return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(a.Modal.Body,{children:[(0,t.jsx)(a.Modal.Header,{children:(0,t.jsx)(i.Text,{align:"left",as:"h1",size:24,children:"Add a Log Drain"})}),(0,t.jsx)(r.Stack,{gap:6,children:(0,t.jsxs)(i.Text,{children:["Once a Log Drain is added, any volume generated by the Log Drain will be counted as usage and charged at"," ",(0,t.jsxs)(i.Text,{as:"span",weight:600,children:["$0.50"," "]}),"per"," ",(0,t.jsxs)(i.Text,{as:"span",weight:600,children:["1GB"," "]}),". A minimum of"," ",(0,t.jsxs)(i.Text,{as:"span",weight:600,children:["$0.50"," "]})," ","is charged as soon as any usage occurs from your active Log Drains."," ",(0,t.jsx)(T.Link,{external:!0,href:"/docs/log-drains#usage-and-pricing",variant:"highlight",children:"Learn more"})]})})]}),(0,t.jsxs)(a.Modal.Actions,{children:[(0,t.jsx)(a.Modal.Action,{onClick:n,type:"secondary",children:"Back"}),(0,t.jsx)(a.Modal.Action,{"data-testid":(0,L.tid)("log-drains","add-log-drain-confirmation"),loading:l,onClick:()=>{c(!0),s()},children:"Confirm and Add Log Drain"})]})]})}function eg(e,t){if("step"in t)return"select"===t.step?{step:"select"}:{...e,step:t.step};switch(t.type){case"integration":case"product":case"resource":return{...e,type:t.type,value:t.value};case"self-served":return{...e,type:t.type};default:return e}}let em="Add Log Drain";function ex(e){let{active:r,availableList:i,onClose:s,projectSlug:n,teamSlug:c,onExternalIntegrationInstalled:d,showCustomEndpoint:u=!0}=e,{team:p}=(0,l.useTeam)(),{mutate:h}=(0,S.useLogDrains)({projectSlug:n,teamSlug:c}),[m,j]=(0,o.useReducer)(eg,{step:"select"}),{data:f}=(0,x.useConfigurations)({type:"marketplace",skipBillingData:!0});return"create"===m.step&&"integration"===m.type?(0,t.jsx)(g.InstallExternalIntegrationModal,{account:p,integration:m.value,onAnimationDone:()=>{j({step:"select"}),s()},onSuccessfulInstall:d?e=>{d(e),j({step:"select"}),s()}:void 0,teamSlugOrPublic:{teamSlug:c}}):(0,t.jsx)(a.Modal.Modal,{active:r,onClickOutside:()=>{j({step:"select"}),s()},children:"select"===m.step?(0,t.jsx)(t.Fragment,{children:(0,t.jsx)(ej,{availableList:i,onClose:s,onSelectLogDrainType:e=>j(e),selectedLogDrainType:m,teamSlug:c,showCustomEndpoint:u})}):(0,t.jsx)(ef,{marketplaceConfigurations:f,onBack:()=>j({step:"select"}),onCreated:e=>{e?j(e):(j({step:"select"}),h(),s())},selectedLogDrainType:m,teamSlug:c})})}function ej(e){let{availableList:i,selectedLogDrainType:s,onClose:o,onSelectLogDrainType:l,teamSlug:c,showCustomEndpoint:d=!0}=e,{logDrainsResources:u,availableProducts:p,logDrainExternalIntegrations:g}=i,{permissions:m}=(0,S.useLogDrainsOperations)({teamSlug:c});return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(a.Modal.Body,{children:(0,t.jsxs)(r.Stack,{gap:6,children:[(0,t.jsx)(r.Stack,{gap:2,children:(0,t.jsx)(a.Modal.Title,{center:!0,children:em})}),(0,t.jsxs)(r.Stack,{gap:2,children:[u?.length||p?.length?(0,t.jsxs)(t.Fragment,{children:[u?.map(e=>(0,t.jsx)(ev,{isDisabled:!m.resource.update,isSelected:eS(s)&&"resource"===s.type&&s.value.id===e.id,onSelect:()=>{l({value:e,type:"resource"})},resource:e,tooltip:{isEnabled:!m.resource.update,text:"You do not have permission to create a log drain for this product."}},e.id)),p?.map(e=>{let{product:r,integration:i}=e;return(0,t.jsx)(h.CreateResourceCard,{description:r.shortDescription,icon:{url:r.iconUrl},isDisabled:!m.resource.create,isSelected:eS(s)&&"product"===s.type&&s.value.product.id===r.id,name:r.name,onClick:()=>{l({value:{product:r,integration:i},type:"product"})},showCreateButton:!1,tooltip:{isEnabled:!m.resource.create,text:"You do not have permission to create a log drain for this product."}},r.id)}),d&&(0,t.jsx)(ey,{text:"or"})]}):null,d&&(0,t.jsx)(h.CreateResourceCard,{Icon:(0,t.jsx)(r.Stack,{padding:2,children:(0,t.jsx)(n.Logs,{size:20})}),description:"Forward logs to a custom endpoint.",isDisabled:!m.create,isSelected:eS(s)&&"self-served"===s.type,name:"Custom Log Drain",onClick:()=>{l({type:"self-served"})},showCreateButton:!1,tooltip:{isEnabled:!m.create,text:"You do not have permission to create log-drains."}}),(0,t.jsx)(ey,{text:"or Existing Account"}),g?.map(e=>(0,t.jsx)(h.CreateResourceCard,{description:e.shortDescription,icon:{url:e.icon},isDisabled:!m.integration.create,isSelected:eS(s)&&"integration"===s.type&&s.value.id===e.id,name:e.name,onClick:()=>{l({type:"integration",value:e})},showCreateButton:!1,tooltip:{isEnabled:!m.create,text:"You do not have permission to install this integration."}},e.id))]})]})}),(0,t.jsxs)(a.Modal.Actions,{children:[(0,t.jsx)(a.Modal.Action,{onClick:()=>{eS(s)?l({step:"select"}):o()},type:"secondary",children:"Cancel"}),(0,t.jsx)(a.Modal.Action,{buttonType:"button",disabled:!eS(s),onClick:()=>{eS(s)&&l({step:"create"})},type:"secondary",children:"Continue"})]})]})}function ef(e){let{selectedLogDrainType:r,onCreated:i,onBack:a,teamSlug:s,marketplaceConfigurations:n}=e,{projectSlug:l,hasProject:c}=(0,y.useProjectSlug)(),{data:h}=(0,v.useProject)(l),[g,x]=(0,o.useState)(null),S=(c?h:g)??null;switch(r.type){case"self-served":return(0,t.jsx)(ep,{onBack:a,onCreated:i});case"integration":default:return null;case"product":{let{integration:e,product:o}=r.value;return(0,t.jsx)(d.CreateResourceModal,{cancelLabel:"Back",initialConfigurationStatus:(0,m.getConfigurationStatusByIntegrationId)(n,e.id),integration:e,neonIntegrationStatus:{isNeonDisabled:!1,isLoading:!1},onBack:a,onIntegrationResourceCreate:e=>{i({type:"resource",value:e})},product:(0,u.getProductWithSupportedProtocols)(o),teamSlug:s})}case"resource":{let e=r.value;return(0,t.jsx)(j.CreateResourceConnectionModalStep,{ProjectSelector:l?void 0:(0,t.jsx)(f.ResourceProjectSelector,{account:s,allowSelectConnectedProjects:(0,u.isProtocolSupported)(e.product,"logDrain"),connectedProjectIds:e.projectsMetadata.map(e=>e.projectId),onProjectSelected:e=>{x(e)},resourceTitle:(0,p.getResourceTitleByResource)(e),selectedProject:S}),backOrCancelLabel:"Back",logDrainEnabled:!0,onBack:a,onClickOutside:a,onConnectionCreated:i,project:c?h:S,resourceId:e.id,store:e,title:c?`${em} to ${S?.name}`:em})}}}function ey(e){let{text:a}=e;return(0,t.jsx)(r.Stack,{align:"center",direction:"row",justify:"center",padding:2,children:(0,t.jsx)(i.Text,{color:"gray-800",size:12,children:a})})}function ev(e){let{resource:r,isSelected:a,onSelect:n,isDisabled:o,tooltip:l}=e,d=(0,c.useAgo)(r.createdAt,{formatYearsWeeksMonths:!0});return(0,t.jsx)(h.CreateResourceCard,{Badge:(0,t.jsx)(s.Badge,{size:"sm",children:"Installed"}),RightAction:(0,t.jsxs)(i.Text,{color:"gray-900",children:[(0,t.jsx)("span",{className:"geist-hide-on-mobile",children:"Created "}),d]}),description:r.product.name,icon:{url:r.product.iconUrl},isDisabled:o,isSelected:a,name:r.name,onClick:n,showCreateButton:!1,tooltip:l})}function eS(e){return"type"in e}}]);

//# sourceMappingURL=84a0a0185274440c.js.map
//# debugId=754551aa-365a-5ae7-9e4b-4bf413b7f034
