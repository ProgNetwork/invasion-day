
!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="1ed87052-2c75-538f-9170-93e5fc18699d")}catch(e){}}();
(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,9365163,4904548,e=>{"use strict";e.s(["useInstantRollbackModal",()=>eo,"useRollbackTooltip",()=>ea],9365163);var t=e.i(751170),n=e.i(4099374),l=e.i(5338940),i=e.i(1717203),r=e.i(7557283),a=e.i(4670733),o=e.i(588428),s=e.i(4396019),d=e.i(762945),c=e.i(7749291),u=e.i(9508212),m=e.i(8735244),h=e.i(1344973),p=e.i(2504781),g=e.i(6891161),x=e.i(455575),f=e.i(8522580),y=e.i(8761240),j=e.i(5756088),b=e.i(9386557),v=e.i(4004502),k=e.i(8042625),T=e.i(277234),A=e.i(4244280),S=e.i(5140444),C=e.i(9830371),R=e.i(5802506),D=e.i(6641571);e.i(9623499);var w=e.i(5576066),I=e.i(406579),P=e.i(5229375);e.i(1477032);var L=e.i(9668517);let M="[teamSlug]";var N=e.i(6060673),E=e.i(930810),O=e.i(7952834),_=e.i(1173672),B=e.i(8227242),$=e.i(5123268),F=e.i(9745887);e.s(["default",()=>K],4904548);var z=e.i(5499338),H=e.i(5468328),U=e.i(9719784);function W(e){let{hidden:n,showIcon:l=!0,linkProps:i,defaultRoute:r}=e;return(0,t.jsx)(t.Fragment,{children:n.map(e=>(0,t.jsx)("div",{children:(0,t.jsx)(U.default,{defaultRoute:r,icon:l,title:e,truncate:!0,url:e,...i})},e))})}function G(e){let{hidden:n,linkProps:l}=e;return(0,t.jsx)(H.Tooltip,{text:(0,t.jsx)(W,{hidden:n,linkProps:l}),children:(0,t.jsx)(z.Badge,{size:"sm",variant:"gray-subtle",children:`+${n.length}`})})}let K=function(e){let{className:n,defaultRoute:l,domains:i,firstOnly:r,showIcon:a=!0,style:o,linkProps:s}=e;if(!i)return(0,t.jsx)(h.Text,{as:"span",className:n,color:"gray-900",style:o,weight:400,children:"-"});let{visible:d,hidden:c}=i.reduce((e,t)=>(0===e.visible.length||!r&&1===e.visible.length&&e.visible[0].length<=20?e.visible.push(t):e.hidden.push(t),e),{visible:[],hidden:[]});return(0,t.jsx)(h.Text,{as:"span",className:n,weight:500,children:(0,t.jsxs)(u.Stack,{align:"center",direction:"row",gap:2,style:{display:"flex",maxWidth:"100%",alignItems:"stretch",...o},children:[d.map((e,n)=>{let i=n===d.length-1;return(0,t.jsx)(U.default,{defaultRoute:l,icon:a,style:{marginRight:i?void 0:"var(--geist-gap-half)",minWidth:0},truncate:!0,url:e,...s},e)}),c.length?(0,t.jsx)(G,{hidden:c,linkProps:s}):null]})})};var V=e.i(8651268),Y=e.i(2547843);function J(){return(0,t.jsx)(g.Modal.Header,{children:(0,t.jsx)(g.Modal.Title,{center:!0,children:"Instant Rollback"})})}function q(e){let{setStage:n}=e;return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(g.Modal.Body,{children:[(0,t.jsx)(J,{}),(0,t.jsx)(h.Text,{as:"p",style:{marginBottom:"24px"},children:"Error: You must select a deployment to roll back."})]}),(0,t.jsx)(g.Modal.Actions,{children:(0,t.jsx)(g.Modal.Action,{fullWidth:!0,onClick:()=>{n("initial")},type:"secondary",children:"Back"})})]})}function X(){return(0,t.jsx)("div",{children:(0,t.jsx)(f.Note,{className:"bg-yellow-50 border-yellow-300 border text-amber-700",fill:!0,label:!1,type:"warning",variant:"contrast",children:(0,t.jsxs)(u.Stack,{align:"center",direction:"row",gap:4,style:{padding:4},children:[(0,t.jsx)(d.Warning,{style:{flexShrink:0}}),(0,t.jsxs)(u.Stack,{align:"start",children:[(0,t.jsx)(h.Text,{as:"p",color:"inherit",children:"Make sure the domains listed above are correct."}),(0,t.jsx)(h.Text,{as:"p",color:"inherit",children:"This deployment has custom aliases not included in the project's domain settings."})]})]})})})}function Q(e){let{hasFloatingAliases:i,onCancel:r,previousDeployment:s,productionAliases:d,productionDeployment:m,project:x,rollbackCandidates:y,setStage:b,selectedDeployment:k,setSelectedDeployment:T,deploymentSwr:A,rollbackReason:S,setRollbackReason:C}=e,R=function(e){let t=(0,L.useTeamSlug)();return(0,n.useMemo)(()=>e.includes(M)?e.replace(`/${M}`,t?`/${t}`:""):e,[t,e])}("/[teamSlug]"),[D,I]=(0,n.useState)(!1),{team:P}=(0,l.useTeam)(),N=!P||P.billing?.plan==="hobby",{value:O}=(0,a.useInstantRollbackHobbyRestrictionFlag)(),{value:_}=(0,o.useInstantRollbackHobbyRestrictionTeamFlag)();return y.length&&s&&k?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(g.Modal.Body,{children:[(0,t.jsx)(J,{}),(0,t.jsxs)(u.Stack,{gap:4,children:[(0,t.jsxs)(u.Stack,{gap:2,children:[(0,t.jsxs)(h.Text,{as:"p",size:16,children:["Rolling back"," ",(0,t.jsx)(K,{domains:d,firstOnly:!0,style:{display:"inline-flex",fontWeight:"500"}})]}),i?(0,t.jsx)(X,{}):null,(0,t.jsx)("div",{children:(0,t.jsx)(F.DeploymentCardSmall,{deployment:m,isProductionDeployment:!0,selectedDeployment:k,setSelectedDeployment:T})})]}),(0,t.jsxs)(u.Stack,{gap:2,children:[(0,t.jsx)(h.Text,{as:"p",size:16,children:"To the following deployment:"}),D?(0,t.jsx)("div",{children:(0,t.jsx)(E.ChooseDeploymentList,{deployments:y,previousDeployment:s,productionDeployment:m,rolledBackDeploymentId:x?.lastAliasRequest?.type==="rollback"?x.lastAliasRequest.fromDeploymentId:void 0,selectedDeployment:k,setSelectedDeployment:T,swr:A})}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{children:(0,t.jsx)(F.DeploymentCardSmall,{deployment:k,isForm:D,isPreviousDeployment:k.uid===s.uid,selectedDeployment:k,setSelectedDeployment:T})}),(O||_)&&N?(0,t.jsx)(u.Stack,{style:{marginTop:"24px"},children:(0,t.jsx)(f.Note,{className:"bg-blue-50 border border-blue-500 text-blue-600",fill:!0,label:!1,size:"small",variant:"contrast",children:(0,t.jsxs)(u.Stack,{align:"center",direction:"row",gap:4,style:{padding:8},children:[(0,t.jsx)(j.LockClosed,{style:{transform:"translateX(1px)"}}),(0,t.jsxs)(u.Stack,{align:"start",direction:"column",children:[(0,t.jsx)(h.Text,{as:"p",color:"inherit",weight:500,children:"Looking for an earlier deployment?"}),(0,t.jsxs)("div",{children:[(0,t.jsx)(w.Link,{className:"inline-flex items-center justify-center gap-1 text-current no-underline",href:"/"===R?"/dashboard?createTeam=instant-rollback":`${R}?upgradeTeam=instant-rollback`,target:"_blank",children:(0,t.jsx)(h.Text,{as:"span",color:"inherit",children:"Upgrade to Pro"})}),(0,t.jsx)(c.ExternalSmall,{className:"ml-1"}),(0,t.jsx)(h.Text,{as:"span",color:"inherit",style:{whiteSpace:"nowrap"},children:"to roll back to an earlier deployment"})]})]})]})})}):(0,t.jsx)(p.Button,{onClick:()=>{I(!0)},type:"secondary",width:"100%",size:"small",children:"Choose another deployment"})]})]}),(0,t.jsxs)(u.Stack,{gap:2,children:[(0,t.jsx)(u.Stack,{as:"label",gap:1,htmlFor:"rollback-reason",children:(0,t.jsx)(h.Text,{as:"span",size:16,children:"Share a reason for this rollback:"})}),(0,t.jsx)(E.RollbackDescriptionTextarea,{value:S,onChange:C,id:"rollback-reason"})]})]})]}),(0,t.jsxs)(g.Modal.Actions,{children:[(0,t.jsx)(g.Modal.Action,{onClick:r,type:"secondary",children:"Cancel"}),(0,t.jsx)(g.Modal.Action,{"data-testid":(0,v.tid)("deployment","rollback-modal","continue-button"),disabled:S.length>=E.REASON_MAX_CHARACTER_LENGTH,onClick:()=>{b("selected")},children:"Continue"})]})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(g.Modal.Body,{children:[(0,t.jsx)(J,{}),(0,t.jsx)(h.Text,{as:"p",children:"This project does not have any valid deployments to roll back to."})]}),(0,t.jsx)(g.Modal.Actions,{children:(0,t.jsx)(g.Modal.Action,{onClick:r,type:"secondary",children:"Cancel"})})]})}function Z(e){let{selectedDeployment:n,setStage:l,requestRollback:i,project:r,rollbackReason:a,rollbackCandidates:o}=e,{user:s}=(0,S.useUser)();if(!n)return(0,t.jsx)(q,{setStage:l});let d=a.length>=E.REASON_MAX_CHARACTER_LENGTH,m=(0,E.getMostRecentlyPromotedDeployment)(o);return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(g.Modal.Body,{children:[(0,t.jsx)(J,{}),(0,t.jsxs)(u.Stack,{gap:2,children:[(0,t.jsxs)(u.Stack,{gap:2,children:[(0,t.jsx)(h.Text,{size:16,children:"Rolling back to:"}),(0,t.jsx)(F.DeploymentCardSmall,{deployment:n,isPreviousDeployment:n.uid===m?.uid,selectedDeployment:n,setSelectedDeployment:()=>null})]}),a.trim()&&(0,t.jsx)(u.Stack,{gap:4,children:(0,t.jsx)(E.RollbackDescriptionCard,{rollbackDescription:{description:a.trim(),userId:s?.uid??"",username:s?.username??"",deploymentId:n.uid,projectId:r?.id??"",createdAt:new Date().getTime()},project:r,preview:!0})}),(0,t.jsxs)(D.UL,{className:"mb-0",children:[(0,t.jsx)(D.LI,{children:"Instant Rollback assigns domains to a previous deployment. All Environment Variables from the original build will remain. Cron jobs will be reverted to the state of the previous deployment."}),(0,t.jsxs)(D.LI,{children:[(0,t.jsxs)(w.Link,{className:"inline-flex items-center text-[var(--geist-success)] no-underline",href:`https://${n.url}`,target:"_blank",children:["View the selected deployment ",(0,t.jsx)(c.ExternalSmall,{className:"ml-1"})]})," ","before rolling back—external APIs, databases, and CMS platforms may not behave as expected."]}),(0,t.jsx)(D.LI,{children:"You can update the rollback reason from the project overview."})]}),(r?.autoAssignCustomDomains??!0)||r?.lastAliasRequest?.type==="rollback"?(0,t.jsx)(f.Note,{fill:!0,type:"secondary",children:(0,t.jsx)(u.Stack,{align:"center",direction:"row",gap:4,children:(0,t.jsx)(u.Stack,{align:"start",children:(0,t.jsx)(h.Text,{as:"p",color:"inherit",children:"After rolling back, production deployments will not be automatically promoted until the rollback is removed."})})})}):null]})]}),(0,t.jsxs)(g.Modal.Actions,{children:[(0,t.jsx)(g.Modal.Action,{onClick:()=>{l("initial")},type:"secondary",children:"Back"}),(0,t.jsx)(g.Modal.Action,{"data-testid":(0,v.tid)("deployment","rollback-modal","rollback-button"),disabled:d,onClick:()=>{i(n.uid),l("processing")},children:"Confirm Rollback"})]})]})}function ee(e){let{jobStatus:l,rollbackDeploymentId:i,rollbackCandidates:r,selectedDeployment:a,setStage:o,onCancel:s,statusSwr:d,requestRollback:c,rollbackReason:x}=e,{user:f}=(0,S.useUser)();if((0,n.useEffect)(()=>{i===a?.uid&&("failed"===l?o("error"):"succeeded"===l&&o("done"))},[i,l,a,o]),!a)return(0,t.jsx)(q,{setStage:o});let j=(0,E.getMostRecentlyPromotedDeployment)(r);return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(g.Modal.Body,{children:[(0,t.jsx)(J,{}),(0,t.jsxs)(u.Stack,{gap:2,children:[(0,t.jsxs)(u.Stack,{gap:2,children:[(0,t.jsx)(h.Text,{children:"Assigning production domains:"}),(0,t.jsx)(F.DeploymentCardSmall,{deployment:a,isPreviousDeployment:a.uid===j?.uid,selectedDeployment:a,setSelectedDeployment:()=>null})]}),""!==x?(0,t.jsxs)("div",{className:"rounded bg-background-200 px-4 py-3 shadow-border",children:[(0,t.jsxs)(h.Text,{color:"gray-900",children:["“",(0,t.jsx)(B.LinkParser,{text:x.trim()}),"”"]}),(0,t.jsxs)("div",{className:"flex gap-1 pt-1",children:[(0,t.jsx)(h.Text,{children:"Rolled back by"}),f?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(V.PrincipalAvatar,{size:20,principalId:f.uid,principal:{type:"user",uid:f.uid,username:f.username}}),(0,t.jsxs)(h.Text,{weight:500,children:["@",f.username]})]}):null]})]}):null,(0,t.jsxs)(D.UL,{className:"mx-4 my-0 list-none pt-2",children:[d.aliases.map(e=>{let n="loading";return"completed"===e.status?n="success":"failed"===e.status&&(n="error"),(0,t.jsx)(D.LI,{children:(0,t.jsxs)("div",{style:{height:"24px",display:"flex"},children:["loading"===n&&(0,t.jsx)(m.Spinner,{size:24}),"error"===n&&(0,t.jsx)(b.WarningFill,{color:"amber-800",size:24}),"success"===n&&(0,t.jsx)(y.CheckCircleFill,{color:"blue-700",size:24}),(0,t.jsx)(h.Text,{as:"span",style:{lineHeight:"24px",paddingLeft:"7px"},children:e.alias})]})},e.alias)}),!d.isReachingEnd&&d.initialDataLoaded?(0,t.jsx)(D.LI,{children:(0,t.jsx)(p.Button,{loading:d.isLoadingMore,onClick:()=>{d.loadMore()},style:{marginTop:24},type:"secondary",width:"100%",children:"Show More"})}):null]})]})]}),(0,t.jsx)(g.Modal.Actions,{children:(0,t.jsx)(g.Modal.Action,{"data-testid":(0,v.tid)("deployment","rollback-modal","finish-button"),fullWidth:!0,loading:"failed"!==l&&"succeeded"!==l,onClick:()=>{"failed"===l?c(a.uid):"succeeded"===l&&(o("initial"),s())},children:"failed"===l?"Retry":"Done"})})]})}function et(e){let{active:i,initialSelectedDeployment:r,onCancel:a,productionBranch:o,productionDeployment:s,projectId:d,rollbackCandidates:c,swr:u,rollbackDescription:m}=e,{mutate:h}=(0,C.useSWRConfig)(),[p,f]=(0,n.useState)("initial"),[y,j]=(0,n.useState)(""),{isReady:b,team:S}=(0,l.useTeam)(),D=(0,x.useToasts)(),w=(0,n.useMemo)(()=>{let e=c.filter(e=>e.uid!==s.id);return(0,E.getMostRecentlyPromotedDeployment)(e)},[c,s]),[L,M]=(0,n.useState)(null);null===L&&M(r||w||null);let F=(0,n.useCallback)(f,[f]),z=(0,n.useCallback)(M,[M]),[,{aliases:H}]=(0,P.useAliasesInfinite)({rollbackDeploymentId:s.id}),{data:U}=(0,N.useProject)(d,B.INSTANT_ROLLBACK_PROJECT_API_PARAMS),{lastAliasRequest:W,hasFloatingAliases:G}=U||{lastAliasRequest:void 0,hasFloatingAliases:!1},{toDeploymentId:K,jobStatus:V}=W||{toDeploymentId:null,jobStatus:null},[,J]=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:20,{isReady:r,team:a}=(0,l.useTeam)(),o=(0,I.default)((t,n)=>{if(!r)return null;let l={teamId:a?.id,limit:i};return t?n?.next?`${(0,A.API_PROJECTS_ROLLBACK_ALIAS_STATUS)(e)}${(0,k.encode)({...l,until:n.next})}`:null:`${(0,A.API_PROJECTS_ROLLBACK_ALIAS_STATUS)(e)}${(0,k.encode)(l)}`},e=>(0,T.fetchAPI)(e,{throwOnHTTPError:!0}),{refreshInterval:t}),s=(0,n.useMemo)(()=>o.data?[].concat(...o.data.filter(Boolean).map(e=>e.aliases.slice(0,i))):[],[o.data,i]),d=!!o.data,c=d&&0===s.length,u=d&&o.data&&o.size>o.data.length,m=d&&o.data&&o.data[o.data.length-1]?.aliases.length<i;return[o,{aliases:s,initialDataLoaded:d,isEmpty:c,loadMore:()=>o.setSize(e=>e+1),isLoadingMore:u,isReachingEnd:m,mutate:o.mutate}]}(d,2e3),q=(0,n.useMemo)(()=>s,[i]),X=()=>{f("initial"),M(r||w||null),a()},et=(0,n.useCallback)(async e=>{if(!b)return;let t=`${(0,A.API_DEPLOYMENT_ROLLBACK)(d,e)}${(0,k.encode)({teamId:S?.id,description:y.trim()})}`;try{await (0,T.fetchAPI)(t,{throwOnHTTPError:!0,method:"POST",body:{}}),S&&(void 0!==U&&(h((0,O.getProjectKey)(U.name,{...B.INSTANT_ROLLBACK_PROJECT_API_PARAMS,teamId:S.slug})),h((0,O.getProjectKey)(U.name,{...$.DEPLOYMENTS_PROJECT_API_PARAMS,teamId:S.slug}))),await h((0,_.getProjectProductionDeploymentKey)({projectIdOrName:d,teamId:S.slug})),h((0,Y.getRollingReleaseEndpoint)(S.slug,d)))}catch(e){D.error({text:"Something went wrong - please try requesting an Instant Rollback again",key:"rollback-deployment"}),(0,R.captureError)(e)}},[b,d,D,y,h,S,U]),en={rollbackDeploymentId:K,hasFloatingAliases:!!G,jobStatus:V,onCancel:X,previousDeployment:w,productionBranch:o,productionDeployment:q,productionAliases:H.map(e=>{let{alias:t}=e;return t}),project:U,rollbackCandidates:c,setStage:F,selectedDeployment:L,setSelectedDeployment:z,deploymentSwr:u,statusSwr:J,requestRollback:et,rollbackWarningText:"New deployments will not be automatically assigned production domains until this rollback is removed.",rollbackReason:y,setRollbackReason:j,rollbackDescription:m};return(0,t.jsxs)(g.Modal.Modal,{active:i,"data-testid":(0,v.tid)("deployment","rollback-modal"),onClickOutside:X,sticky:!0,width:"500px",children:["initial"===p&&(0,t.jsx)(Q,{...en}),"selected"===p&&(0,t.jsx)(Z,{...en}),["processing","error","done"].includes(p)&&(0,t.jsx)(ee,{...en})]})}var en=e.i(5771992),el=e.i(5645345),ei=e.i(3981247);e.i(3182268);var er=e.i(7849855);function ea(e){let{team:t}=(0,l.useTeam)(),i=!t||t.billing?.plan==="hobby",{value:r}=(0,a.useInstantRollbackHobbyRestrictionFlag)(),{value:d}=(0,o.useInstantRollbackHobbyRestrictionTeamFlag)(),c=r||d,u=e?.name,{deployment:m,isLoading:h}=(0,s.useProjectProductionDeployment)(u);return(0,n.useMemo)(()=>{let t=(0,el.asListDeployment)(e),n=i&&!t?.isRollbackCandidate;return t?h?"Loading...":"readyState"in t&&"READY"!==t.readyState?"Only Deployments that are Ready can be rolled back.":"readySubstate"in t&&"PROMOTED"!==t.readySubstate?"Only Deployments previously aliased to a Production domain can be rolled back.":t.uid===m?.id?"This Deployment is already in Production.":c?t.isRollbackCandidate||"production"===t.target?n?"Hobby customers can only roll back to the previous deployment.":"":"Only Deployments previously aliased to a Production domain can be rolled back.":t.isRollbackCandidate?"":"Only Deployments previously aliased to a Production domain can be rolled back.":""},[e,i,h,m?.id,c])}function eo(e){let{onClose:l}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},[a,o]=(0,n.useState)(!1),[d,c]=(0,n.useState)(),{teamSlug:u,projectSlug:m}=(0,er.useProjectAndTeamSlug)(),{data:h}=(0,N.useProject)(d?.name,B.INSTANT_ROLLBACK_PROJECT_API_PARAMS),p=m??d?.name,g=e??h,{data:x}=(0,ei.useRollingRelease)({teamIdOrSlug:u,projectSlug:p}),f=x?.rollingRelease?x?.rollingRelease?.canaryDeployment?.id:void 0,{deployment:y,rollbackDescription:j,mutate:b}=(0,s.useProjectProductionDeployment)(g?.name),{can:v}=(0,i.default)({projectIdOrName:g?.name}),k=v(r.Action.Create,r.Resource.DeploymentRollback),T=g?.link?.productionBranch?g.link.productionBranch:void 0,[A,S]=(0,en.useDeploymentsInfinite)({projectId:g?g.id:"",requireProject:!0,limit:10,rollbackCandidate:!0},{}),{deployments:C,initialDataLoaded:R}=S,D=C.filter(e=>!!e.isRollbackCandidate&&e.uid!==f),w=!!(R&&g&&!D.length),I=(0,n.useCallback)(e=>{c((0,el.asListDeployment)(e)),o(!0)},[]),P=(0,n.useCallback)(()=>{o(!1),b().finally(()=>null),l?.()},[b,l]);return{rollbackModal:(0,n.useMemo)(()=>k&&a&&y&&g?(0,t.jsx)(et,{active:a,initialSelectedDeployment:d,onCancel:P,productionBranch:T,productionDeployment:y,projectId:g.id,rollbackCandidates:D,rollbackDescription:j,swr:S}):null,[k,a,d,T,y,D,g,S,P,j]),closeRollbackModal:P,openRollbackModal:I,canRollbackDeployment:k,noRollbackCandidates:w}}},6338279,e=>{"use strict";e.s(["useDeploymentEnvironmentLabel",()=>l]);var t=e.i(3679047),n=e.i(4844919);let l=e=>{let{deployment:l,customEnvironments:i}=e,{project:r,teamSlug:a}=(0,t.useParams)()??{};return function(e){let{deployment:t,teamSlug:l,projectSlug:i,customEnvironments:r}=e,a=`/${l}/${i}/settings/environments/`;if(!t)return{deploymentTargetLabel:"",deploymentTargetConfigurationUrl:a};if(t.customEnvironment?.slug!==void 0&&t.customEnvironment?.slug!==null)return{deploymentTargetLabel:t.customEnvironment.slug,deploymentTargetConfigurationUrl:`${a}${t.customEnvironment.id}`};if(t.customEnvironment){let e=r?.find(e=>e.id===t.customEnvironment?.id);return e?{deploymentTargetLabel:e.slug,deploymentTargetConfigurationUrl:`${a}${e.id}`}:{deploymentTargetLabel:"(Deleted)",deploymentTargetConfigurationUrl:null}}return null===t.target||void 0===t.target?{deploymentTargetLabel:"Preview",deploymentTargetConfigurationUrl:`${a}preview`}:{deploymentTargetLabel:(0,n.default)(t.target),deploymentTargetConfigurationUrl:`${a}${t.target}`}}({deployment:l,teamSlug:a,projectSlug:r,customEnvironments:i})}},7952998,e=>{"use strict";e.s(["DeploymentSource",()=>g]);var t=e.i(751170),n=e.i(9722978),l=e.i(3617058),i=e.i(57106),r=e.i(5479400),a=e.i(4345845),o=e.i(4099374),s=e.i(3627160),d=e.i(5468328),c=e.i(6064230),u=e.i(4899593),m=e.i(2695633),h=e.i(9375869),p=e.i(2940029);function g(e){let g,x,{deployment:f,singleLine:y=!1,lineClassName:j,branchClassName:b,commitClassName:v,secondLineLinkClassName:k}=e,{meta:T}=f,A=(0,h.useDeploymentLink)(f),S=(0,o.useMemo)(()=>(0,m.getGitMeta)(T),[T]),C="source"in f?f.source:void 0,R=`${A}/source`;if(g=y?null:S?(0,t.jsx)(p.Attribute.Item,{Icon:a.GitBranch,className:j,mono:!0,children:(0,t.jsx)(i.Link,{className:(0,n.clsx)("font-mono","hover:underline",b),href:S.branchUrl,title:"Git Branch",children:S.branchName})}):(0,t.jsx)(p.Attribute.Item,{Icon:s.Code,className:j,children:(0,t.jsx)(i.Link,{className:(0,n.clsx)("hover:underline",b),href:R,children:"View code"})}),S){let e="1"===S.gitDirty,a=S.sha.substring(0,7),[o]=S.commitMessage.split("\n");x=(0,t.jsx)(p.Attribute.Item,{Icon:"cli"===C?c.Terminal:r.GitCommit,className:j,mono:!0,children:(0,t.jsxs)(i.Link,{className:(0,l.twMerge)("flex gap-1.5 truncate hover:underline",k),href:e?R:S.commitUrl,title:"Git Commit",children:[(0,t.jsx)("span",{className:(0,n.clsx)("font-mono",v),children:e?(0,t.jsx)(d.Tooltip,{className:"flex-none",desktopOnly:!0,text:(0,t.jsxs)("span",{children:["Based on commit ",(0,t.jsx)("code",{children:a})," with additional modifications"]}),children:a}):a}),(0,t.jsx)("span",{className:"text-label-14 truncate",title:o,children:o.length>100?`${o.substring(0,100)}…`:o})]})})}else x=T.v0?(0,t.jsxs)(p.Attribute.Item,{className:j,children:[(0,t.jsx)(u.V0Mark,{size:16,style:{"--geist-foreground":"var(--ds-gray-900)"}}),(0,t.jsx)(i.Link,{className:"hover:underline",href:T.v0BlockId&&T.v0ChatId?`https://v0.app/chat/${T.v0ChatId}?b=${T.v0BlockId}`:"https://v0.app",title:"v0.app",children:"Deployed with v0"})]}):(0,t.jsx)(p.Attribute.Item,{Icon:c.Terminal,className:j,mono:!0,children:(0,t.jsx)(i.Link,{className:"hover:underline",href:"/docs/cli/deploy",title:"Vercel CLI Docs",children:"vercel deploy"})});return(0,t.jsxs)(t.Fragment,{children:[g,x]})}},3981247,e=>{"use strict";e.s(["useRollingRelease",()=>i,"useSuspenseRollingRelease",()=>l]);var t=e.i(9014736),n=e.i(2547843);function l(e){let{teamIdOrSlug:t,projectSlug:n}=e;return i({teamIdOrSlug:t,projectSlug:n},{suspense:!0,revalidateOnMount:!1})}function i(e,l){let{teamIdOrSlug:i,projectSlug:r}=e,a=!i||!r,o=(0,t.default)(()=>a?null:(0,n.getRollingReleaseEndpoint)(i,r),n.rollingReleaseFetcher,l);return{...o,skipped:a,isLoading:!a&&o.isLoading}}},8270020,e=>{"use strict";e.s(["useIsActive",()=>n]);var t=e.i(4099374);function n(){let{timeout:e=3e4,debounce:n=100}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},[l,i]=(0,t.useState)(!0),r=(0,t.useRef)(void 0);return(0,t.useEffect)(()=>{var t;let l,a=()=>i(!1),[o,s]=(t=()=>{i(!0),clearTimeout(r.current),r.current=setTimeout(a,e)},[function(){for(var e=arguments.length,i=Array(e),r=0;r<e;r++)i[r]=arguments[r];l&&clearTimeout(l),l=setTimeout(()=>t(...i),n)},()=>{l&&clearTimeout(l)}]),d=new AbortController,{signal:c}=d;return r.current=setTimeout(a,e),window.addEventListener("focusin",o,{signal:c}),window.addEventListener("mousemove",o,{signal:c,passive:!0}),window.addEventListener("touchstart",o,{signal:c,passive:!0}),window.addEventListener("keydown",o,{signal:c}),()=>{d.abort(),s(),clearTimeout(r.current)}},[e,n]),l}},5123268,e=>{"use strict";e.s(["DEPLOYMENTS_PROJECT_API_PARAMS",()=>n,"useDeploymentsPageRefreshInterval",()=>l]);var t=e.i(8270020);let n={apiVersion:"v10",latestDeployments:10,activeBranches:!0,fetchParams:{rollbackInfo:!0}};function l(){return(0,t.useIsActive)()?8e3:3e4}},930810,9745887,e=>{"use strict";e.s(["ChooseDeploymentList",()=>A,"REASON_MAX_CHARACTER_LENGTH",()=>C,"RollbackDescriptionCard",()=>T,"RollbackDescriptionTextarea",()=>R,"getDeploymentId",()=>v,"getMostRecentlyPromotedDeployment",()=>S,"isDeleted",()=>k],930810);var t=e.i(751170),n=e.i(1344973),l=e.i(2504781),i=e.i(9334091);e.s(["DeploymentCardSmall",()=>y],9745887);var r=e.i(5499338),a=e.i(9508212),o=e.i(57106),s=e.i(3753138),d=e.i(6226725),c=e.i(4345845),u=e.i(8893913),m=e.i(7218483),h=e.i(9722978),p=e.i(9375869),g=e.i(8529990),x=e.i(3907048);function f(e){let{isForm:n,children:l,className:i}=e;return n?(0,t.jsx)("label",{className:i,children:l}):(0,t.jsx)("div",{className:i,children:l})}function y(e){let{deployment:l,isForm:i,isPromote:y,isPreviousDeployment:j,isProductionDeployment:b,isRolledBackDeployment:v,selectedDeployment:k,setSelectedDeployment:T,ariaLabel:A="Rollback Deployment"}=e,S=(0,m.useAgo)(l.createdAt||0),C="number"==typeof l.aliasAssigned?l.aliasAssigned:0,R=C>0,D=(0,m.useAgo)(C),w=(0,p.useDeploymentLink)(l),I=(0,g.getGitInfoFromDeployment)(l),P=b||j||v;j&&v&&(j=!1);let L="Preview";if("target"in l)switch(l.target){case"staging":L="Staging";break;case"production":L="Production";break;default:L="Preview"}else L="Production";let M="uid"in l?l.uid:l.id,N=null;y?I?.commitRef&&(N=(0,t.jsxs)(a.Stack,{align:"center",direction:"row",gap:.5,children:[(0,t.jsx)(c.GitBranch,{color:"gray-900"}),(0,t.jsx)(n.Text,{as:"span",color:"gray-900",monospace:!0,style:{marginRight:"4px",maxWidth:120,textOverflow:"ellipsis",overflowX:"hidden",minWidth:0},title:I.commitRef,truncate:!0,wrap:!1,children:I.commitRef}),(0,t.jsxs)(n.Text,{as:"span",className:"flex items-center gap-1",color:"gray-900",style:{flexBasis:"50%",flexShrink:0,flexGrow:1,textOverflow:"ellipsis",overflowX:"hidden",minWidth:0,maxWidth:260},truncate:!0,wrap:!1,children:["Staged"," ",S," by"," ",(0,t.jsx)("span",{children:(0,t.jsx)(x.CreatorAvatar,{deployment:l,showProviderIcon:!0,size:24})}),(0,t.jsx)("span",{className:"font-medium",children:!l.meta?.originalDeploymentId&&l.creator?.username?`@${l.creator.username}`:I.commitAuthorLogin})]})]})):N=(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"inline-flex flex-row items-center",children:[(0,t.jsx)(n.Text,{as:"span",color:"gray-900",size:14,style:{marginRight:"4px"},children:L}),I?.commitRef?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(c.GitBranch,{color:"gray-900",size:14}),(0,t.jsx)(n.Text,{as:"span",className:"max-w-[100px] truncate whitespace-nowrap px-1 text-center text-sm leading-5 text-gray-900",monospace:!0,title:I.commitRef,children:I.commitRef}),(0,t.jsx)(n.Text,{as:"span",color:"gray-900",children:"by"}),(0,t.jsxs)("div",{className:"ml-1 inline-flex flex-row items-center gap-1",children:[(0,t.jsx)(x.CreatorAvatar,{deployment:l,size:20}),(0,t.jsx)(n.Text,{as:"span",className:"max-w-[140px] truncate",color:"gray-900",truncate:!0,weight:500,children:!l.meta?.originalDeploymentId&&l.creator?.username?`@${l.creator.username}`:I.commitAuthorLogin})]})]}):null]}),(0,t.jsxs)("div",{children:[(0,t.jsxs)(n.Text,{as:"span",color:"gray-900",size:14,children:["Deployed"," "]}),(0,t.jsx)(n.Text,{as:"span",color:"gray-900",size:14,children:S}),(0,t.jsxs)(n.Text,{as:"span",color:"gray-900",size:14,children:[","," "]}),R?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(n.Text,{as:"span",color:"gray-900",size:14,children:["promoted"," "]}),(0,t.jsx)(n.Text,{as:"span",color:"gray-900",size:14,children:D})]}):(0,t.jsx)(n.Text,{as:"span",color:"gray-900",size:14,children:"never promoted"})]})]});let E=null;return i||(E=y?(0,t.jsx)(s.ArrowCircleUp,{className:"mr-4 hidden self-center sm:block",style:{flexShrink:0}}):b?(0,t.jsx)(d.CrossCircle,{className:"mr-4 hidden self-center sm:block",style:{flexShrink:0}}):(0,t.jsx)(u.RotateCounterClockwise,{className:"mr-4 hidden self-center sm:block",color:"gray-1000",style:{flexShrink:0}})),(0,t.jsxs)(f,{className:(0,h.clsx)("flex w-full items-end justify-start px-4 py-3","rounded border border-solid border-[var(--accents-2)]","rounded-b-none","last:rounded-b","[&+&]:rounded-t-none [&+&]:border-t-0",{"bg-[var(--accents-1)] shadow-none":b,"bg-[var(--geist-background)]":!b}),isForm:i,children:[i?(0,t.jsx)("input",{"aria-label":A,checked:k?.uid===M,className:`
            relative m-0 mr-4 size-4 shrink-0 appearance-none
            self-center rounded-[1000px] border
            border-solid border-[var(--geist-foreground)] after:absolute after:inset-[3px]
            after:rounded-[1000px] after:bg-[var(--geist-foreground)]
            after:content-none checked:after:content-['']
          `,name:"rollbackDeployment",onChange:()=>{"uid"in l&&"type"in l&&T&&T(l)},type:"radio",value:M}):E,(0,t.jsxs)("div",{style:{width:P?"initial":"100%",minWidth:0},children:[(0,t.jsx)(o.Link,{className:"flex w-[calc(100%-1ch)] items-center gap-0.5 break-all text-sm font-bold leading-5",href:w,target:"_blank",children:(0,t.jsx)(n.Text,{as:"span",title:l.url,truncate:1,weight:500,children:l.url})}),I?.commitMessage?(0,t.jsxs)(n.Text,{as:"p",className:"break-words",color:"gray-900",size:14,title:I.commitMessage,truncate:1,children:[I.commitSha.substring(0,7)," ",I.commitMessage]}):null,N]}),b?(0,t.jsx)(r.Badge,{className:"ml-auto hidden self-start text-xs font-medium sm:inline-flex",variant:"inverted",children:"Current"}):null,j?(0,t.jsx)(r.Badge,{className:"ml-auto hidden self-start text-xs font-medium sm:inline-flex",variant:"gray-subtle",children:"Previous"}):null,v?(0,t.jsx)(r.Badge,{className:"ml-auto hidden self-start text-xs font-medium sm:inline-flex",variant:"red-subtle",children:"Rolled back"}):null]})}var j=e.i(8227242),b=e.i(8651268);function v(e){return"id"in e?e.id:"uid"in e?e.uid:void 0}function k(e){return void 0!==e.deleted}function T(e){let{rollbackDescription:l,project:i,preview:r}=e,a=(0,m.useAgo)(l.createdAt);return(0,t.jsxs)("div",{className:"px-4 py-3 rounded bg-background-200 shadow-border",children:[(0,t.jsx)(n.Text,{className:"break-words",color:"gray-900",children:l.description.length>0?(0,t.jsxs)(t.Fragment,{children:["“",(0,t.jsx)(j.LinkParser,{text:l.description}),"”"]}):(0,t.jsx)(n.Text,{children:"No rollback explanation provided"})}),(0,t.jsxs)("div",{className:"flex gap-1 pt-1",children:[r?null:(0,t.jsx)(n.Text,{children:"Rolled back by"}),l.username?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(b.PrincipalAvatar,{size:20,principalId:l.userId,principal:{type:"user",uid:l.userId,username:l.username}}),(0,t.jsxs)(n.Text,{weight:500,children:["@",l.username]}),i?.lastAliasRequest!==void 0&&!r&&(0,t.jsx)(n.Text,{children:a})]}):null]})]})}function A(e){let{deployments:n,previousDeployment:i,rolledBackDeploymentId:r,productionDeployment:a,selectedDeployment:o,setSelectedDeployment:s,swr:d,ariaLabel:c}=e;return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{children:n.map(e=>a.id!==e.uid&&(0,t.jsx)(y,{deployment:e,isForm:!0,isPreviousDeployment:i?.uid===e.uid,isRolledBackDeployment:r===e.uid,selectedDeployment:o,setSelectedDeployment:s,ariaLabel:c},e.uid))}),!d.isReachingEnd&&(0,t.jsx)(l.Button,{loading:d.isLoadingMore,onClick:()=>{d.loadMore()},style:{marginTop:24},type:"secondary",width:"100%",children:"Show More"})]})}function S(e){if(0===e.length)return;let t=e.reduce((e,t)=>e.aliasAssigned&&t.aliasAssigned?e.aliasAssigned>t.aliasAssigned?e:t:t.aliasAssigned?t:e);if(t.aliasAssigned)return t}let C=250;function R(e){let{value:n,onChange:l,id:r}=e;return(0,t.jsx)(t.Fragment,{children:(0,t.jsx)(i.Textarea,{autoFocus:!0,className:"text-base min-h-24",error:n.length>=C?`Reason cannot be longer than ${C} characters.`:void 0,id:r,onChange:e=>l(e.target.value),placeholder:"Production is not behaving as expected...",required:!0,value:n,style:{fontSize:14}})})}},6619197,5645345,e=>{"use strict";e.s(["default",()=>W,"usePromoteDeployment",()=>G,"usePromoteTooltip",()=>z],6619197);var t=e.i(751170),n=e.i(4099374),l=e.i(8248823),i=e.i(3679047),r=e.i(57106),a=e.i(3869281),o=e.i(4030453),s=e.i(2455417),d=e.i(6891161),c=e.i(8522580),u=e.i(5255926),m=e.i(9318197),h=e.i(9508212),p=e.i(1344973),g=e.i(455575),x=e.i(8761240),f=e.i(472117),y=e.i(4004502),j=e.i(8042625),b=e.i(277234),v=e.i(4244280),k=e.i(4443312),T=e.i(5140444),A=e.i(5338940),S=e.i(9830371),C=e.i(4450569),R=e.i(4396019),D=e.i(9375869),w=e.i(8518548);function I(e){if(!e)return;if("id"in e==!1)return e;let{aliasAssigned:t,aliasError:n=null,aliasAssignedAt:l,buildingAt:i,created:r=e.createdAt,createdAt:a,creator:o,name:s,ready:d,readyState:c,readySubstate:u,target:m=null,uid:h=e.id,url:p,isRollbackCandidate:g="production"===e.target}=e;return{aliasAssigned:t,aliasError:n,aliasAssignedAt:l,buildingAt:i,created:r,createdAt:a,creator:{email:"",githubLogin:"",...o},name:s,ready:d,readyState:c,readySubstate:u,target:m,type:"LAMBDAS",uid:h,url:p,isRollbackCandidate:g}}e.s(["asListDeployment",()=>I],5645345);var P=e.i(1840726),L=e.i(930810),M=e.i(7952834),N=e.i(8227242),E=e.i(5123268),O=e.i(1173672),_=e.i(9745887),B=e.i(3008300),$=e.i(3981247),F=e.i(6060673);function z(e){let t=e?.name,{deployment:l,isLoading:i}=(0,R.useProjectProductionDeployment)(t);return(0,n.useMemo)(()=>{let t=I(e);return t?i?"Loading...":t.uid===l?.id?"This Deployment is already in Production.":"readyState"in t&&"READY"!==t.readyState?"Only Deployments that are Ready can be promoted.":"":""},[e,i,l?.id])}function H(e){let{title:n}=e;return(0,t.jsx)(d.Modal.Header,{children:(0,t.jsx)(d.Modal.Title,{center:!0,children:n})})}function U(e){let{deploymentId:n}=e,l=(0,f.useCiChecksAndPoliciesFlag)(),{data:i,isLoading:a}=(0,k.useProjectCheckRuns)({deploymentId:n,enableCiChecksAndPolicies:l});if(!l)return null;if(a)return(0,t.jsx)(u.Skeleton,{});if(i?.runs.every(e=>"succeeded"===e.conclusion))return null;let o=i?.runs.filter(e=>"succeeded"!==e.conclusion)||[];return(0,t.jsxs)(c.Note,{type:"error",fill:!0,className:"mt-6",children:["By clicking Promote, you acknowledge that you are bypassing promotion requirements:",o.length>0&&(0,t.jsx)("ul",{className:"flex flex-col gap-1 ml-4 list-disc",children:o.slice(0,5).map(e=>(0,t.jsx)("li",{children:e.externalUrl?(0,t.jsx)(r.Link,{href:e.externalUrl,external:!0,children:e.name}):(0,t.jsx)("span",{children:e.name})},e.id||e.name||`${e.conclusion}-${e.status}`))})]})}function W(e,l){let{onDeploymentPromoted:i}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},[u,g]=(0,n.useState)(!1),[f,j]=(0,n.useState)(null),{team:b}=(0,A.useTeam)(),v=e??f?.name,{data:k}=(0,F.useProject)(v,N.INSTANT_ROLLBACK_PROJECT_API_PARAMS),S=l??k,D=(0,P.useShowIgnoreBuildStep)({project:S,deployment:f}),[I,M]=(0,n.useState)(B.DEFAULT_USE_IGNORE_BUILD_STEP_PROMOTE),E=(0,n.useCallback)(()=>{g(!1)},[]),{error:O,loading:z,promote:W,setError:K,setLoading:V}=G({deployment:f,useIgnoreBuildStep:I,project:S,onCurrentDeploymentPromoted:(0,n.useCallback)(()=>{E(),i?.()},[E,i])}),{user:Y}=(0,T.useUser)(),{data:J}=(0,$.useRollingRelease)({teamIdOrSlug:b?.slug,projectSlug:v}),q=S?.rollingRelease?.stages!==void 0&&S.rollingRelease.stages.length>0,X=J?.rollingRelease?.state==="ACTIVE",Q=J?.rollingRelease?.canaryDeployment?.id,Z=X&&Q===f?.uid,ee=q&&!X&&f?.target==="production",et=q&&X&&f?.target==="production",en=ee&&S.rollingRelease?.stages!==void 0?S.rollingRelease.stages[0]?.targetPercentage:null,{data:el}=(0,w.useProjectDomains)(v,{limit:11,production:"true",redirects:"false",verified:"true",order:"ASC"}),ei=(0,n.useCallback)(e=>{j(e),g(!0)},[]),er=(0,n.useCallback)(()=>{V(!1),j(null),K(void 0)},[K,V]),{deployment:ea,isLoading:eo,rollbackDescription:es,deploymentIsStale:ed}=(0,R.useProjectProductionDeployment)(S?.name),{andMoreDomains:ec,remainingDomains:eu}=(0,n.useMemo)(()=>{if(!el)return{andMoreDomains:!1,remainingDomains:[]};let e=el.length>2,t=e?el.slice(2).map(e=>e.name):[];return{andMoreDomains:e,remainingDomains:t}},[el]),em=(0,n.useMemo)(()=>{if(!S||!f)return(0,t.jsx)(C.default,{center:!0,style:{marginTop:10},children:(0,t.jsx)(s.LoadingDots,{size:4})});let e=!!(el&&el.length>0);return(0,t.jsxs)(t.Fragment,{children:["production"===f.target?(0,t.jsx)(p.Text,{as:"p",style:{marginBottom:"16px"},weight:400,children:"Deployment to promote:"}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(p.Text,{as:"p",style:{marginBottom:"16px"},children:"A new deployment will be built using your production environment."}),(0,t.jsx)(p.Text,{as:"p",style:{marginBottom:"16px"},weight:400,children:"Deployment to promote to production:"})]}),(0,t.jsx)("div",{children:(0,t.jsx)(_.DeploymentCardSmall,{deployment:f,isPromote:!0,selectedDeployment:null})}),ee?(0,t.jsxs)(p.Text,{as:"p",style:{marginBottom:16,marginTop:24},children:["This will start a new rolling release with initial traffic of"," ",en,"%."]}):null,et?(0,t.jsx)(p.Text,{as:"p",style:{marginBottom:16,marginTop:24},children:"This will queue the deployment for promotion after the current rolling release completes."}):null,ee||et||!e?null:(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(p.Text,{as:"p",style:{marginBottom:16,marginTop:24},weight:400,children:"It will be aliased to the following domains:"}),(0,t.jsx)(h.Stack,{gap:2,style:{paddingLeft:12},children:el?.slice(0,2).map(e=>{let{name:n}=e;return(0,t.jsx)(p.Text,{as:"p",children:(0,t.jsxs)(h.Stack,{align:"center",direction:"row",gap:3,children:[(0,t.jsx)(x.CheckCircleFill,{color:"blue-700",size:20}),(0,t.jsx)("span",{children:n.startsWith("*")?n:(0,t.jsx)(r.Link,{"data-testid":(0,y.tid)("deployments","promote-to-production-overlay","preview-link"),external:!0,href:`https://${n}`,variant:"highlight",children:n})})]})},n)})}),ec?(0,t.jsxs)(p.Text,{as:"p",className:"mt-6 mb-4",children:["...and ",eu.length," more"]}):null]}),!ee&&!e&&(0,t.jsxs)(p.Text,{as:"p",style:{marginBottom:"24px",marginTop:"24px"},children:["Warning: Your Project does not have a Production Domain. We recommend you"," ",(0,t.jsx)(r.Link,{href:`/${b?b.slug:Y?.username}/${encodeURIComponent(S.name)}/settings/domains`,variant:"highlight",children:"add"})," ","one."]}),S.link&&f.gitSource?(0,t.jsx)(U,{deploymentId:f.id}):null,D?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(m.Spacer,{y:1}),(0,t.jsx)(a.Checkbox,{checked:I,fullWidth:!0,onChange:()=>{M(!I)},children:"Use project's Ignore Build Step"})]}):null,Z?(0,t.jsx)(c.Note,{className:" border border-[#fde68a] bg-[#fffbeb] text-[#bd5200] dark:border-[#411d06] dark:bg-[#241005] dark:text-[#fde68a] ",fill:!0,size:"small",style:{marginTop:24},type:"warning",variant:"contrast",children:(0,t.jsx)(h.Stack,{align:"center",direction:"row",gap:4,style:{padding:1},children:(0,t.jsx)(h.Stack,{align:"start",children:(0,t.jsx)(p.Text,{as:"p",color:"inherit",children:"This will complete the rolling release for this deployment."})})})}):null,ed?(0,t.jsx)(c.Note,{className:" border border-[#fde68a] bg-[#fffbeb] text-[#bd5200] dark:border-[#411d06] dark:bg-[#241005] dark:text-[#fde68a] ",fill:!0,size:"small",style:{marginTop:24},type:"warning",variant:"contrast",children:(0,t.jsx)(h.Stack,{align:"center",direction:"row",gap:4,style:{padding:1},children:(0,t.jsx)(h.Stack,{align:"start",children:(0,t.jsx)(p.Text,{as:"p",color:"inherit",children:ee?"Completing the Rolling Release will undo the current Instant Rollback":"This action will undo the current Instant Rollback"})})})}):null,es?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(p.Text,{as:"p",style:{marginBottom:16,marginTop:24},children:"Rollback Details:"}),(0,t.jsx)(L.RollbackDescriptionCard,{rollbackDescription:es,project:S})]}):null]})},[ec,eu,el,S,b,Y,f,I,D,ed,es,en,ee,et,Z]),eh=(0,n.useMemo)(()=>(0,t.jsx)(d.Modal.Action,{"data-testid":(0,y.tid)("deployments","promote-to-production-overlay","confirm-button"),loading:z,onClick:W,children:f&&"target"in f&&"production"===f.target?"Promote":"Promote to Production"}),[W,z,f]);return{modal:(0,n.useMemo)(()=>(0,t.jsxs)(d.Modal.Modal,{active:u,"data-testid":(0,y.tid)("deployments","promote-to-production-overlay"),onAnimationDone:er,onClickOutside:E,sticky:!0,width:"500px",children:[(0,t.jsxs)(d.Modal.Body,{children:[(0,t.jsx)(H,{title:et?"Queue for Promotion":f&&"target"in f&&"production"!==f.target?"Promote to Production":"Promote"}),em,O?(0,t.jsx)(o.Error,{error:O}):null]}),(0,t.jsxs)(d.Modal.Actions,{children:[(0,t.jsx)(d.Modal.Action,{"data-testid":(0,y.tid)("deployments","promote-to-production-overlay","cancel-button"),loading:!1,onClick:E,type:"secondary",children:"Cancel"}),eh]})]}),[u,er,E,em,O,eh,et,f]),close:E,open:ei}}let G=e=>{let{deployment:t,project:r,useIgnoreBuildStep:a,onCurrentDeploymentPromoted:o}=e,s=(0,g.useToasts)(),d=(0,i.useRouter)(),{team:c}=(0,A.useTeam)(),{user:u}=(0,T.useUser)(),{mutate:m}=(0,S.useSWRConfig)(),[h,p]=(0,n.useState)(!1),[x,f]=(0,n.useState)(void 0),y=(0,P.useShowIgnoreBuildStep)({project:r,deployment:t});return{promote:(0,n.useCallback)(async()=>{if(t&&r){p(!0),f(void 0);try{let e,n=c?.id,l="Promoted Deployment successfully.";if("production"===t.target)await (0,b.fetchAPI)(`${(0,v.API_DEPLOYMENT_PROMOTE)(r.id,t.uid||t.id)}${(0,j.encode)({teamId:n})}`,{method:"POST",body:{},throwOnHTTPError:!0}),e=(0,D.pathFromDeployment)(t,{user:u,team:c});else{let i=await (0,b.fetchAPI)(`${(0,v.API_DEPLOYMENTS)("v13")}${(0,j.encode)({teamId:n,skipIgnoreBuildStep:y&&!a?"1":null})}`,{method:"POST",body:JSON.stringify({deploymentId:t.uid||t.id,meta:{action:"promote"},name:r.name,target:"production"}),throwOnHTTPError:!0});e=(0,D.pathFromDeployment)(i,{user:u,team:c});let o=t.uid||t.id;l="production"===t.target?o===i.id?"Deployment is already the current Production Deployment.":"Promoted Deployment to Production successfully.":"Created Production Deployment successfully."}c&&(m((0,M.getProjectKey)(r.name,{...N.INSTANT_ROLLBACK_PROJECT_API_PARAMS,teamId:c.slug})),m((0,M.getProjectKey)(r.name,{...E.DEPLOYMENTS_PROJECT_API_PARAMS,teamId:c.slug})),await m((0,O.getProjectProductionDeploymentKey)({projectIdOrName:r.id,teamId:c.slug}))),s.success({text:l,key:"production-deployment"}),e&&(e===location.pathname?o?.():d.push(e))}catch(e){f((0,l.normalizeError)(e))}finally{p(!1)}}},[t,r,d,y,c,s,a,u,m,o]),loading:h,setLoading:p,error:x,setError:f}}},822157,e=>{"use strict";e.s(["default",()=>s]);var t=e.i(751170),n=e.i(4099374),l=e.i(9177216),i=e.i(3500331),r=e.i(6891161),a=e.i(9318197),o=e.i(1681029);let s=(0,n.memo)(e=>{let{active:s,url:d,onCancel:c}=e,[u,m]=(0,n.useState)(""),h=(0,n.useMemo)(()=>!u||u.includes(".")||!(0,l.isValid)(`${u}.${d}`),[u,d]),p=(0,n.useCallback)(()=>{m(""),c()},[c]),g=(0,n.useCallback)(e=>{e.preventDefault(),window.open((0,o.domainToUrl)(`${u}.${d}`),"_blank","noopener"),p()},[u,d,p]);return d?(0,t.jsx)(r.Modal,{active:s,onClickOutside:p,children:(0,t.jsxs)("form",{onSubmit:g,children:[(0,t.jsxs)(r.Modal.Body,{children:[(0,t.jsx)(r.Modal.Title,{children:"Wildcard Domain"}),(0,t.jsx)(a.Spacer,{}),(0,t.jsx)(r.Modal.Subtitle,{children:"Enter a subdomain to visit below."}),(0,t.jsx)(a.Spacer,{y:.75}),(0,t.jsx)(i.Input,{autoFocus:!0,id:"hostname",label:"Hostname",onChange:e=>m(e.target.value),suffix:`.${d}`,value:u})]}),(0,t.jsxs)(r.Modal.Actions,{children:[(0,t.jsx)(r.Modal.Action,{onClick:c,children:"Cancel"}),(0,t.jsx)(r.Modal.Action,{buttonType:"submit",disabled:h,children:"Visit"})]})]})}):null})},2405448,e=>{"use strict";e.s(["default",()=>n]);var t=e.i(542164);function n(e){return(0,t.default)(e)?e.slice(2):e}},9719784,e=>{"use strict";e.s(["default",()=>c]);var t=e.i(751170),n=e.i(4099374),l=e.i(57106),i=e.i(822157),r=e.i(7018452),a=e.i(2405448),o=e.i(542164),s=e.i(1681029),d=e.i(4478191);let c=(0,n.memo)(function(e){let{url:c,truncate:u,defaultRoute:m,...h}=e,[p,g]=(0,r.default)("#wildcard"),[x,f]=(0,n.useState)(null),[y,j]=(0,n.useState)(!1),b=(0,n.useCallback)(()=>{f((0,a.default)(c)),g(!0)},[f,g,c]);return c?(0,o.default)(c)?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(l.Link,{className:"pt-px leading-[16px] hover:underline",onClick:b,...h,onMouseEnter:()=>j(!0),style:{minWidth:0,maxWidth:u?"100%":void 0},children:u?(0,t.jsx)("span",{className:"geist-ellipsis",children:c}):c}),y||p?(0,t.jsx)(i.default,{active:p,onCancel:()=>{g(!1)},url:x}):null]}):(0,t.jsx)(l.Link,{className:"pt-px leading-[16px] hover:underline",external:!0,href:(0,d.withDefaultRoute)((0,s.domainToUrl)(c),m),...h,style:{minWidth:0,maxWidth:u?"100%":void 0},children:u?(0,t.jsx)("span",{className:"geist-ellipsis",children:c}):c}):null})},663807,e=>{"use strict";e.s(["decode",()=>h,"default",()=>f,"encode",()=>p,"toASCII",()=>x,"toUnicode",()=>g,"ucs2decode",()=>d,"ucs2encode",()=>c]);let t=/^xn--/,n=/[^\0-\x7F]/,l=/[\x2E\u3002\uFF0E\uFF61]/g,i={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},r=Math.floor,a=String.fromCharCode;function o(e){throw RangeError(i[e])}function s(e,t){let n=e.split("@"),i="";return n.length>1&&(i=n[0]+"@",e=n[1]),i+(function(e,t){let n=[],l=e.length;for(;l--;)n[l]=t(e[l]);return n})((e=e.replace(l,".")).split("."),t).join(".")}function d(e){let t=[],n=0,l=e.length;for(;n<l;){let i=e.charCodeAt(n++);if(i>=55296&&i<=56319&&n<l){let l=e.charCodeAt(n++);(64512&l)==56320?t.push(((1023&i)<<10)+(1023&l)+65536):(t.push(i),n--)}else t.push(i)}return t}let c=e=>String.fromCodePoint(...e),u=function(e,t){return e+22+75*(e<26)-((0!=t)<<5)},m=function(e,t,n){let l=0;for(e=n?r(e/700):e>>1,e+=r(e/t);e>455;l+=36)e=r(e/35);return r(l+36*e/(e+38))},h=function(e){let t=[],n=e.length,l=0,i=128,a=72,s=e.lastIndexOf("-");s<0&&(s=0);for(let n=0;n<s;++n)e.charCodeAt(n)>=128&&o("not-basic"),t.push(e.charCodeAt(n));for(let c=s>0?s+1:0;c<n;){let s=l;for(let t=1,i=36;;i+=36){var d;c>=n&&o("invalid-input");let s=(d=e.charCodeAt(c++))>=48&&d<58?26+(d-48):d>=65&&d<91?d-65:d>=97&&d<123?d-97:36;s>=36&&o("invalid-input"),s>r((0x7fffffff-l)/t)&&o("overflow"),l+=s*t;let u=i<=a?1:i>=a+26?26:i-a;if(s<u)break;let m=36-u;t>r(0x7fffffff/m)&&o("overflow"),t*=m}let u=t.length+1;a=m(l-s,u,0==s),r(l/u)>0x7fffffff-i&&o("overflow"),i+=r(l/u),l%=u,t.splice(l++,0,i)}return String.fromCodePoint(...t)},p=function(e){let t=[],n=(e=d(e)).length,l=128,i=0,s=72;for(let n of e)n<128&&t.push(a(n));let c=t.length,h=c;for(c&&t.push("-");h<n;){let n=0x7fffffff;for(let t of e)t>=l&&t<n&&(n=t);let d=h+1;for(let p of(n-l>r((0x7fffffff-i)/d)&&o("overflow"),i+=(n-l)*d,l=n,e))if(p<l&&++i>0x7fffffff&&o("overflow"),p===l){let e=i;for(let n=36;;n+=36){let l=n<=s?1:n>=s+26?26:n-s;if(e<l)break;let i=e-l,o=36-l;t.push(a(u(l+i%o,0))),e=r(i/o)}t.push(a(u(e,0))),s=m(i,d,h===c),i=0,++h}++i,++l}return t.join("")},g=function(e){return s(e,function(e){return t.test(e)?h(e.slice(4).toLowerCase()):e})},x=function(e){return s(e,function(e){return n.test(e)?"xn--"+p(e):e})},f={version:"2.3.1",ucs2:{decode:d,encode:c},decode:h,encode:p,toASCII:x,toUnicode:g}},9177216,(e,t,n)=>{"use strict";var l=e.r(663807),i={};i.rules=e.r(8765996).map(function(e){return{rule:e,suffix:e.replace(/^(\*\.|\!)/,""),punySuffix:-1,wildcard:"*"===e.charAt(0),exception:"!"===e.charAt(0)}}),i.endsWith=function(e,t){return -1!==e.indexOf(t,e.length-t.length)},i.findRule=function(e){var t=l.toASCII(e);return i.rules.reduce(function(e,n){return(-1===n.punySuffix&&(n.punySuffix=l.toASCII(n.suffix)),i.endsWith(t,"."+n.punySuffix)||t===n.punySuffix)?n:e},null)},n.errorCodes={DOMAIN_TOO_SHORT:"Domain name too short.",DOMAIN_TOO_LONG:"Domain name too long. It should be no more than 255 chars.",LABEL_STARTS_WITH_DASH:"Domain name label can not start with a dash.",LABEL_ENDS_WITH_DASH:"Domain name label can not end with a dash.",LABEL_TOO_LONG:"Domain name label should be at most 63 chars long.",LABEL_TOO_SHORT:"Domain name label should be at least 1 character long.",LABEL_INVALID_CHARS:"Domain name label can only contain alphanumeric characters or dashes."},i.validate=function(e){var t,n=l.toASCII(e);if(n.length<1)return"DOMAIN_TOO_SHORT";if(n.length>255)return"DOMAIN_TOO_LONG";for(var i=n.split("."),r=0;r<i.length;++r){if(!(t=i[r]).length)return"LABEL_TOO_SHORT";if(t.length>63)return"LABEL_TOO_LONG";if("-"===t.charAt(0))return"LABEL_STARTS_WITH_DASH";if("-"===t.charAt(t.length-1))return"LABEL_ENDS_WITH_DASH";if(!/^[a-z0-9\-]+$/.test(t))return"LABEL_INVALID_CHARS"}},n.parse=function(e){if("string"!=typeof e)throw TypeError("Domain name must be a string.");var t=e.slice(0).toLowerCase();"."===t.charAt(t.length-1)&&(t=t.slice(0,t.length-1));var r=i.validate(t);if(r)return{input:e,error:{message:n.errorCodes[r],code:r}};var a={input:e,tld:null,sld:null,domain:null,subdomain:null,listed:!1},o=t.split(".");if("local"===o[o.length-1])return a;var s=function(){return/xn--/.test(t)&&(a.domain&&(a.domain=l.toASCII(a.domain)),a.subdomain&&(a.subdomain=l.toASCII(a.subdomain))),a},d=i.findRule(t);if(!d)return o.length<2?a:(a.tld=o.pop(),a.sld=o.pop(),a.domain=[a.sld,a.tld].join("."),o.length&&(a.subdomain=o.pop()),s());a.listed=!0;var c=d.suffix.split("."),u=o.slice(0,o.length-c.length);return d.exception&&u.push(c.shift()),a.tld=c.join("."),u.length&&(d.wildcard&&(c.unshift(u.pop()),a.tld=c.join(".")),u.length&&(a.sld=u.pop(),a.domain=[a.sld,a.tld].join("."),u.length&&(a.subdomain=u.join(".")))),s()},n.get=function(e){return e&&n.parse(e).domain||null},n.isValid=function(e){var t=n.parse(e);return!!(t.domain&&t.listed)}},5229375,e=>{"use strict";e.s(["useAliases",()=>c,"useAliasesInfinite",()=>u,"useAliasesV2",()=>d],5229375);var t=e.i(4099374),n=e.i(9014736),l=e.i(406579),i=e.i(818351),r=e.i(8042625),a=e.i(277234),o=e.i(4244280),s=e.i(5338940);function d(e,t){let{deploymentId:n,teamId:l}=e;return(0,i.useIsomorphicSWR)(n?function(e){let{deploymentId:t,teamId:n}=e;return`${(0,o.API_DEPLOYMENTS)("v2")}/${t}/aliases${(0,r.encode)({teamId:n})}`}({deploymentId:n,teamId:l}):null,t)}function c(e,t){return(0,n.default)(()=>{if(!e)return null;let{team:t,id:n,teamId:l}=e;return`${(0,o.API_DEPLOYMENTS)("v2")}/${n}/aliases${(0,r.encode)({teamId:l??(t?t.id:null)})}`},e=>(0,a.fetchAPI)(e,{throwOnHTTPError:!0}),t)}function u(e,n){let{limit:i=20,domains:r,rollbackDeploymentId:d}=e,{isReady:c,team:u}=(0,s.useTeam)(),h=(0,l.default)((e,t)=>{if(!c)return null;let n=`${o.API_ALIASES}`,l=r?.map(e=>`domain=${encodeURIComponent(e)}`).join("&")||null;if(!e)return`${n}${m({limit:i+1,teamId:u?.id,rollbackDeploymentId:d},l)}`;let a=t?.aliases&&t.aliases.length>i?t.aliases[i-1].createdAt:null;return a?`${n}${m({limit:i+1,teamId:u?.id,until:a},l)}`:null},e=>(0,a.fetchAPI)(e,{throwOnHTTPError:!0}),n),p=(0,t.useMemo)(()=>h.data?[].concat(...h.data.filter(Boolean).map(e=>e.aliases.slice(0,i))):[],[h.data,i]),g=!!h.data&&!h.error,x=!!(h.data&&0===p.length),f=!!(h.data&&h.size>h.data.length),y=!!(h.data&&h.data[h.data.length-1]?.aliases.length<=i);return[h,{aliases:p,initialDataLoaded:g,isEmpty:x,loadMore:()=>h.setSize(e=>e+1),isLoadingMore:f,isReachingEnd:y}]}function m(e,t){let n=(0,r.encode)(e,!1),l=t?`&${t}`:"";return n?`?${n}${l}`:`?${l}`}},7018452,e=>{"use strict";e.s(["default",()=>n]);var t=e.i(4099374);function n(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",[n,l]=(0,t.useState)(!1),i=window.location.hash,r=e.startsWith("#")?e:`#${e}`;return(0,t.useEffect)(()=>{let e=()=>{window.location.hash!==r||n||l(!0)};return window.addEventListener("hashchange",e),()=>{window.removeEventListener("hashchange",e)}},[n,r]),i!==r||n||(l(!0),window.history.replaceState(null,""," ")),i!==r&&n&&(window.location.hash=r),[n,l]}}]);

//# sourceMappingURL=94198fb0b071a096.js.map
//# debugId=1ed87052-2c75-538f-9170-93e5fc18699d
