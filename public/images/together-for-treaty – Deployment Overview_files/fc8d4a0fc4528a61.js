
!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="61d06ed7-5662-55f9-aa1f-e6e1455a48ed")}catch(e){}}();
(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,5750944,2128692,2863467,1135066,e=>{"use strict";e.s(["QueryBuilderDrawer",()=>tm],5750944);var t=e.i(751170),r=e.i(9192216),i=e.i(5086286);e.s(["useNotebookOperations",()=>b],2128692);var l=e.i(4998750),a=e.i(4244280),s=e.i(9668517),n=e.i(5338940),o=e.i(9979783),d=e.i(7151748),u=e.i(3870297),c=e.i(4099374),m=e.i(9830371),p=e.i(6597743),g=e.i(8673480),f=e.i(2749380);function b(e){let{mutate:t}=(0,m.useSWRConfig)(),r=(0,s.useTeamSlug)()??"",{team:i}=(0,n.useTeam)(),b=i?.id,x=i?.billing?.plan??"hobby",y=(0,g.buildSWRKey)(a.API_NOTEBOOK,{id:e?.id,teamSlug:r}),h=(0,g.buildSWRKey)(a.API_NOTEBOOKS,{teamSlug:r}),{trigger:v,isMutating:w}=(0,p.default)(y,async(t,i)=>{let{arg:s}=i,n=s.id??e?.id;if(!n)throw Error("Notebook ID is required to save a notebook");return(0,l.parseNotebook)(await (0,o.typedFetchData)(a.API_NOTEBOOK,"put",{id:n,slug:r},{title:s.title,variables:(0,l.serializeVariables)(s.variables)},{throwOnHTTPError:!0}))},{revalidate:!1}),{trigger:j,isMutating:N}=(0,p.default)(y,async(t,i)=>{let{arg:l}=i,s=l?.id??e?.id;if(!s)throw Error("Notebook ID is required to delete a notebook");return(0,o.typedFetchData)(a.API_NOTEBOOK,"delete",{id:s,slug:r},{throwOnHTTPError:!0})},{revalidate:!1}),{trigger:E,isMutating:k}=(0,p.default)(y,async(t,i)=>{let{arg:s}=i,n=s?.id??e?.id;if(!n)throw Error("Notebook ID is required to share a notebook");return(0,l.parseNotebook)(await (0,o.typedFetchData)(a.API_NOTEBOOK_SHARE,"put",{id:n,slug:r},{},{throwOnHTTPError:!0}))},{revalidate:!1}),{trigger:C,isMutating:O}=(0,p.default)(y,async(t,i)=>{let{arg:s}=i,n=s.notebookId??e?.id;if(!n)throw Error("Notebook ID is required to save a notebook widget");let{id:d,query:u,...c}=s.widget;return(0,l.parseNotebook)(await (0,o.typedFetchData)(a.API_NOTEBOOK_WIDGET,"put",{id:n,slug:r,widgetId:d},{query:(0,f.serializeQuery)(u),...c},{throwOnHTTPError:!0}))},{revalidate:!1}),{trigger:S,isMutating:T}=(0,p.default)(y,async(t,i)=>{let{arg:s}=i,n=s.notebookId??e?.id;if(!n)throw Error("Notebook ID is required to remove a notebook widget");return(0,l.parseNotebook)(await (0,o.typedFetchData)(a.API_NOTEBOOK_WIDGET,"delete",{id:n,slug:r,widgetId:s.id},{throwOnHTTPError:!0}))},{revalidate:!1}),I=(0,c.useCallback)(async e=>(await Promise.all([t((0,g.buildSWRKey)(a.API_NOTEBOOK,{id:e.id,teamSlug:r}),e),t((0,g.buildSWRKey)(a.API_NOTEBOOKS,{teamSlug:r}),(0,g.updateCachedList)(e))]),e),[r,t]);return{saveNotebook:async e=>{let t=await I(await v(e,{optimisticData:(0,g.updateCachedNotebook)(e),rollbackOnError:!0}));return d.analytics.track(u.AnalyticsEvent.OBSERVABILITY_NOTEBOOK_EDITED,{teamId:b,plan:x,operation:"title_edited",source:"notebook-details-page"}),t},deleteNotebook:async r=>{await j(r),d.analytics.track(u.AnalyticsEvent.OBSERVABILITY_NOTEBOOK_DELETED,{teamId:b,plan:x,source:"notebook-details-page"});let i=r?.id??e?.id;return await t(h,(0,g.updateCachedList)({id:i},!1)),null},shareNotebook:async e=>{let t=I(await E(e));return d.analytics.track(u.AnalyticsEvent.OBSERVABILITY_NOTEBOOK_EDITED,{teamId:b,plan:x,operation:"notebook_shared",source:"notebook-details-page"}),t},saveWidget:async(e,t)=>{let r=await I(await C(e,{optimisticData:(0,g.updateCachedNotebook)({},e.widget),rollbackOnError:!0}));return d.analytics.track(u.AnalyticsEvent.OBSERVABILITY_NOTEBOOK_EDITED,{teamId:b,plan:x,operation:"new"===e.widget.id?"widget_added":"widget_edited",source:t??"notebook-details-page"}),r},removeWidget:async e=>{let t=await I(await S(e,{optimisticData:(0,g.updateCachedNotebook)({},null,e.id),rollbackOnError:!0}));return d.analytics.track(u.AnalyticsEvent.OBSERVABILITY_NOTEBOOK_EDITED,{teamId:b,plan:x,operation:"widget_removed",source:"notebook-details-page"}),t},isSaving:w||N||k||O||T}}var x=e.i(7371622),y=e.i(5115727),h=e.i(2126130),v=e.i(5265628),w=e.i(2504781),j=e.i(5468328),N=e.i(455575),E=e.i(3679047);let k="new-notebook";function C(e){let{query:a}=e,{hasObservabilityPlusAccess:s,ready:o}=(0,h.useHasObservabilityPlus)(),d=!o||!s,{notebooks:u}=(0,x.useNotebooks)(),{createNotebook:m,isSaving:p}=(0,i.useCreateNotebook)(),{saveWidget:g,isSaving:f}=b(),[C,D]=(0,c.useState)(!1),{team:A}=(0,n.useTeam)(),M=(0,N.useToasts)(),B=(0,E.useRouter)(),R=(0,y.useDefaultQueryTitle)(a),F=(0,c.useMemo)(()=>u.map(e=>({...e,group:A&&e.contributors.includes(A.id)?"Team":"Personal"})),[u,A]),P=(0,c.useCallback)(e=>{(async()=>{try{if(!A)throw Error("Team not found");D(!1);let t=e.id,r={id:"new",query:a,title:R};t===k?t=(await m({title:e.title,widget:r},"query-builder")).id:await g({notebookId:t,widget:r},"query-builder"),B.push(`/${A.slug}/~/observability/notebooks/${t}`)}catch(e){M.error({preserve:!0,text:(0,t.jsxs)(t.Fragment,{children:["Failed to add query to the notebook.",(0,t.jsx)("br",{}),(0,l.extractError)(e)]})})}})()},[m,g,R,a,M,B,A]),_=(0,t.jsx)(w.Button,{disabled:d,loading:f||p,onClick:()=>D(!0),size:"medium",type:"default",typeName:"button",children:"Add to Notebook"});return d?(0,t.jsx)(j.Tooltip,{text:"Unlock all advanced query features with Observability Plus",children:_}):(0,t.jsxs)(v.Root,{modal:!0,onOpenChange:D,open:C,children:[(0,t.jsx)(v.Anchor,{className:"flex",children:(0,t.jsx)(v.Trigger,{asChild:!0,children:_})}),(0,t.jsx)(v.Portal,{children:(0,t.jsx)(v.Content,{align:"end",onCloseAutoFocus:()=>D(!1),sideOffset:8,children:(0,t.jsx)(r.CommandMenu,{getId:S,getValue:T,label:"notebook",onChange:P,options:F,parseNewValue:O,renderItem:I,reverse:!0})})})]})}function O(e){return{id:k,title:e,group:"Personal"}}function S(e){return e.id}let T=e=>{let{title:t,group:r}=e;return`${t}${r?` ${r}`:""}`};function I(e){return(0,t.jsx)("div",{className:"flex w-full items-center gap-2 px-2 py-1.5",children:(0,t.jsx)("span",{children:e.title})})}var D=e.i(545405),A=e.i(1344973),M=e.i(5806401),B=e.i(6942035),R=e.i(3672946),F=e.i(4725703),P=e.i(5366204),_=e.i(6143247),q=e.i(5348482);e.s(["QueryBuilder",()=>to],1135066);var L=e.i(9264886),z=e.i(1482596),Q=e.i(8815885),K=e.i(3500331),U=e.i(7087273),V=e.i(5255926),H=e.i(8923565),G=e.i(1663964);let $=(0,e.i(9334638).withNewIcon)('<path fill="currentColor" fill-rule="evenodd" d="M1 1v11.75A2.25 2.25 0 0 0 3.25 15H15v-1.5H3.25a.75.75 0 0 1-.75-.75V1H1Zm8.5 2.75V3H8v9h1.5V3.75ZM6 8v4H4.5V8H6Zm7-1.25V6h-1.5v6H13V6.75Z" clip-rule="evenodd"/>');var W=e.i(1918911),Y=e.i(7749365),Z=e.i(9096446),J=e.i(218692),X=e.i(4047087),ee=e.i(3675495),et=e.i(2006677),er=e.i(2713400);e.s(["DateRangeSelect",()=>en],2863467);var ei=e.i(2992903),el=e.i(8119470),ea=e.i(1794286),es=e.i(7432042);function en(e){let{value:r,onChange:i,disabled:a,trackEvents:s,enableVariables:n,variables:o}=e,{start:d,end:u}=(0,f.fromTimeToRange)(r),c=(0,el.subDays)(new Date,90),m=(0,f.getTimeRangePresets)(!0,n?{[l.TIME_VARIABLE]:{start:new Date,end:new Date,text:`Notebook (${(0,f.printTime)(o?.time)})`}}:void 0),p=Object.keys(m).findIndex(e=>e===r);return(0,t.jsx)(ea.Calendar,{allowClear:!1,compact:!0,minValue:c,disabled:a,onChange:(e,t)=>{let r=new Date(e.start),l=new Date(e.end),a=t||(0,es.default)(l.getTime()-r.getTime());s&&(0,ei.track)("Query Builder Changed Date Range Period",{period:a}),t?i(t):i({from:r,to:l})},popoverAlignment:"center",presetIndex:p,presets:m,value:{start:d,end:u},width:"210px"},"date-range-select-query-builder")}var eo=e.i(9689002),ed=e.i(2942788),eu=e.i(3228096),ec=e.i(4333930),em=e.i(4796642),ep=e.i(787358),eg=e.i(8004707),ef=e.i(1898517),eb=e.i(1379708),ex=e.i(6401841),ey=e.i(4141852),eh=e.i(762945),ev=e.i(7807066),ew=e.i(2923544),ej=e.i(1813317);let eN={incomingRequest:eu.Globe,serverlessFunctionInvocation:ec.FunctionSquare,edgeFunctionInvocation:em.FunctionEdge,middlewareInvocation:ep.FunctionMiddleware,edgeMiddlewareInvocation:ep.FunctionMiddleware,outgoingRequest:eg.ArrowGlobe,imageTransformation:ef.Image,imageTransformationFailure:ef.Image,isrOperation:eb.Isr,blockedConnection:ex.Stop,firewallAction:ey.FirewallFlame,botIdCheck:eh.Warning};function eE(e){return eN[e]||ed.Database}let ek=["count","durationMs","functionDurationMs","functionWallTimeMs","functionCpuTimeMs","functionDurationGbhr","ttfbMs","coldStartDurationMs","initDurationMs","fotInBytes","fotOutBytes","fotTotalBytes","isrReadBytes","isrWriteBytes","isrReadUnits","isrWriteUnits","vdcReadUnits","invokedMemoryMb","maxMemoryUsedMb","billedMemoryMb"];function eC(e){return(0,ej.getAggregableMeasures)(e).map(t=>({id:t,label:(0,ew.labelForMeasure)(e,t)})).toSorted((e,t)=>{let r=ek.indexOf(e.id),i=ek.indexOf(t.id);return -1!==r&&-1!==i?r-i:-1!==r?-1:-1!==i?1:e.label.localeCompare(t.label)})}function eO(e){let{disabled:r,selectedEventId:i,selectedMetricId:l,events:a,onSelect:s}=e,[n,o]=(0,c.useState)(!1),[d,u]=(0,c.useState)(""),[m,p]=(0,c.useState)(null),[g,f]=(0,c.useState)(null),[b,x]=(0,c.useState)(!1),[y,h]=(0,c.useState)(!1),[j,N]=(0,c.useState)("events"),[E,k]=(0,c.useState)(null),C=(0,c.useRef)(null),O=(0,c.useRef)(null),S=(0,c.useRef)(null),T=(0,c.useMemo)(()=>a.find(e=>e.id===i),[a,i]),I=(0,c.useMemo)(()=>{if(!d.trim())return{events:a,metrics:[],firstMatchingEventId:null};let e=d.toLowerCase(),t=new Set,r=null;return a.forEach(i=>{i.label.toLowerCase().includes(e)&&(t.add(i.id),r||(r=i.id))}),a.forEach(i=>{(0,ej.getAggregableMeasures)(i.id).map(e=>({id:e,label:(0,ew.labelForMeasure)(i.id,e)})).some(t=>t.label.toLowerCase().includes(e)||t.id.toLowerCase().includes(e))&&(t.add(i.id),r||(r=i.id))}),{events:a.filter(e=>t.has(e.id)),firstMatchingEventId:r}},[a,d]),D=y&&"metrics"===j&&E?E:m||(d.trim()&&I.firstMatchingEventId?I.firstMatchingEventId:i)||I.events[0]?.id,M=(0,c.useMemo)(()=>a.find(e=>e.id===D),[a,D]),B=(0,c.useMemo)(()=>D?eC(D):[],[D]),R=(0,c.useMemo)(()=>{if(!d.trim())return B;let e=d.toLowerCase(),t=B.filter(t=>t.label.toLowerCase().includes(e)||t.id.toLowerCase().includes(e));return 0===t.length&&D?B:t},[B,d,D]),F=(0,c.useMemo)(()=>{let e={};return I.events.forEach(t=>{let r=t.group||"Other";e[r]||(e[r]=[]),e[r].push(t)}),Object.entries(e).sort((e,t)=>{let[r]=e,[i]=t;return"Deprecated"===r&&"Deprecated"!==i?1:"Deprecated"!==r&&"Deprecated"===i?-1:0})},[I.events]),P=(0,c.useMemo)(()=>{let e=F.flatMap(e=>{let[,t]=e;return t});return m&&!e.some(e=>e.id===m),e},[F,m]),q=(0,c.useCallback)((e,t)=>{s(e,t),o(!1),u("")},[s]),L=(0,c.useCallback)(e=>{if(y)k(e),N("metrics");else{let t=eC(e)[0];t&&q(e,t.id)}},[y,q]),z=(0,c.useCallback)(e=>{let t=y&&E?E:D;t&&q(t,e)},[y,E,D,q]),Q=(0,c.useCallback)(e=>{if("ArrowDown"===e.key)if(e.preventDefault(),x(!0),m||g){if(m&&!g){let e=P.findIndex(e=>e.id===m);if(-1===e){let e=P[0];e&&p(e.id)}else{let t=P[e+1];t&&p(t.id)}}else if(g){let e=R.findIndex(e=>e.id===g),t=R[e+1];t&&f(t.id)}}else{let e=P[0];e&&p(e.id)}else if("ArrowUp"===e.key){if(e.preventDefault(),x(!0),m&&!g){let e=P.findIndex(e=>e.id===m);if(-1===e){let e=P[P.length-1];e&&p(e.id)}else e>0&&p(P[e-1].id)}else if(g){let e=R.findIndex(e=>e.id===g);e>0?f(R[e-1].id):f(null)}}else if("ArrowRight"===e.key)e.preventDefault(),x(!0),m&&R.length>0&&f(R[0].id);else if("ArrowLeft"===e.key)e.preventDefault(),x(!0),g&&f(null);else if("Enter"===e.key){if(m&&g)q(m,g);else if(m)if(d.trim()&&R.length>0)q(m,R[0].id);else{let e=a.find(e=>e.id===m);e&&L(e.id)}}else"Escape"===e.key&&o(!1)},[P,R,m,g,q,a,L,d]);(0,c.useEffect)(()=>{n&&(p(null),f(null),i&&O.current&&setTimeout(()=>{let e=O.current?.querySelector(`[data-event-id="${i}"]`);e?.scrollIntoView({block:"nearest",behavior:"auto"})},50))},[n,i]),(0,c.useEffect)(()=>{!m||P.some(e=>e.id===m)||d.trim()&&m===I.firstMatchingEventId||p(null)},[m,P,d,I.firstMatchingEventId]),(0,c.useEffect)(()=>{d.trim()&&I.firstMatchingEventId&&!b?(p(I.firstMatchingEventId),a.some(e=>e.id===I.firstMatchingEventId&&e.label.toLowerCase().includes(d.toLowerCase()))||R.length):d.trim()||i||p(null)},[d,I.firstMatchingEventId,R.length,i,a,b]),(0,c.useEffect)(()=>{if(b&&m&&O.current){let e=O.current.querySelector(`[data-event-id="${m}"]`);e&&e.scrollIntoView({block:"center",behavior:"smooth"})}},[m,b]),(0,c.useEffect)(()=>{let e=()=>{h(window.innerWidth<640)};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),(0,c.useEffect)(()=>{n||(N("events"),k(null))},[n]);let K=(0,c.useMemo)(()=>(function(e,t){if(!t||!e)return null;let r=(0,ej.getAggregableMeasures)(e).find(e=>e===t);return r?{id:r,label:(0,ew.labelForMeasure)(e,r)}:null})(i,l),[i,l]),V=T&&K?(0,t.jsxs)("div",{className:"flex items-center",children:[(0,t.jsxs)("span",{children:[T.label," "]}),(0,t.jsx)("span",{className:"text-gray-900 inline-block ml-1",children:K.label})]}):"Select Metric";return(0,t.jsxs)(v.Root,{modal:!0,onOpenChange:o,open:n,children:[(0,t.jsx)(v.Anchor,{className:"flex",children:(0,t.jsx)(v.Trigger,{asChild:!0,children:(0,t.jsx)(w.Button,{"aria-label":"Select event and metric",className:(0,_.cn)("!px-2 !py-4",r&&"!bg-white"),disabled:r,prefix:T?c.default.createElement(eE(T.id),{color:"gray-900"}):(0,t.jsx)(ed.Database,{color:"gray-900"}),size:"small",suffix:(0,t.jsx)(W.ChevronUpDown,{color:"gray-800"}),type:"secondary",typeName:"button",children:V})})}),(0,t.jsx)(v.Portal,{children:(0,t.jsx)(v.Content,{align:"start",className:"tailwind-preflight",sideOffset:8,children:(0,t.jsx)("div",{className:(0,_.cn)("flex rounded-lg border-gray-alpha-400 bg-background-100 shadow-menu overflow-hidden font-sans",y?"w-[320px]":"w-[520px]"),children:(0,t.jsxs)("div",{className:"flex flex-1 flex-col",children:[y&&"metrics"===j&&(0,t.jsx)("div",{className:"flex items-center border-b px-2 py-3",children:(0,t.jsxs)("button",{onClick:()=>N("events"),className:"flex items-center gap-1 bg-transparent text-sm text-gray-800 hover:text-gray-900",type:"button",children:[(0,t.jsx)(ev.ChevronRight,{className:"size-3 rotate-180"}),"Back to Events"]})}),!(y&&"metrics"===j)&&(0,t.jsxs)("div",{className:"flex items-center justify-between border-b px-4 py-3",children:[(0,t.jsx)("input",{className:"w-full border-none bg-transparent text-sm outline-none",onChange:e=>u(e.target.value),placeholder:"Find metric...",ref:C,value:d,onKeyDown:Q}),(0,t.jsx)(eo.Kbd,{small:!0,style:{paddingRight:"0.5rem"},children:"Esc"})]}),(0,t.jsx)("div",{className:(0,_.cn)("flex h-[340px]",y&&"flex-col"),children:d.trim()&&0===I.events.length?(0,t.jsx)("div",{className:"flex flex-1 items-center justify-center",children:(0,t.jsxs)("div",{className:"text-center text-sm text-gray-800",children:[(0,t.jsx)("div",{className:"mb-2",children:"No events or metrics found"}),(0,t.jsx)("div",{className:"text-xs text-gray-600",children:"Try adjusting your search terms"})]})}):(0,t.jsxs)(t.Fragment,{children:[(!y||"events"===j)&&(0,t.jsx)("div",{className:(0,_.cn)(y?"flex-1":"w-[260px] border-r"),children:(0,t.jsx)(U.Scroller,{className:"h-[340px]",overflow:"y",children:(0,t.jsx)("div",{className:"px-2 py-2",ref:O,children:F.map(e=>{let[r,l]=e;return(0,t.jsxs)("div",{className:"mb-2",children:[(0,t.jsx)(A.Text,{className:"mb-1 px-2 text-xs text-gray-800",children:r}),l.map(e=>{let r=eE(e.id),l=function(e){let{eventId:t,selectedEventId:r,activeEventId:i,activeMetricId:l,displayEventId:a}=e,s=t===r,n=t===a;return{isSelected:s,isActive:t===i,isDisplayed:n,showSelectedBg:s&&!i,isIndirectlyActive:n&&l}}({eventId:e.id,selectedEventId:i,activeEventId:m,activeMetricId:g,displayEventId:D});return(0,t.jsxs)("button",{"data-event-id":e.id,className:(0,_.cn)("flex w-full items-center gap-2 rounded px-2 py-1.5 text-sm font-sans cursor-pointer","bg-white focus:bg-gray-100 focus:outline-none",!b&&"hover:bg-gray-100",(l.showSelectedBg||l.isIndirectlyActive)&&"bg-gray-100",l.isActive&&!g&&"bg-gray-100"),onMouseEnter:()=>{b||p(e.id)},onMouseMove:()=>x(!1),onFocus:()=>p(e.id),onClick:()=>L(e.id),type:"button",children:[(0,t.jsx)(r,{className:"size-4",color:"gray-900"}),(0,t.jsx)("span",{className:"flex-1 text-left",children:e.label}),(0,t.jsx)(ev.ChevronRight,{className:(0,_.cn)("size-3 text-gray-800 ",l.isDisplayed?"opacity-100":"opacity-0")})]},e.id)})]},r)})})})}),(!y||"metrics"===j)&&(0,t.jsx)("div",{className:(0,_.cn)("flex-1"),children:(0,t.jsx)(U.Scroller,{className:"h-[340px]",overflow:"y",children:(0,t.jsxs)("div",{className:"px-2 py-2",ref:S,children:[M&&(0,t.jsxs)(A.Text,{className:"mb-1 px-2 text-xs text-gray-800",children:["Metrics for ",M.label]}),R.length>0?R.map((e,r)=>{let a=function(e){let{metricId:t,metricIndex:r,selectedMetricId:i,activeEventId:l,activeMetricId:a,displayEventId:s,selectedEventId:n,isMobile:o,mobileStep:d}=e,u=t===i&&s===n;return{isSelected:u,isActive:(!o||"metrics"!==d)&&t===a,isFirstAndActive:(!o||"metrics"!==d)&&0===r&&l&&!a&&!u,showSelectedBg:u&&!a}}({metricId:e.id,metricIndex:r,selectedMetricId:l,activeEventId:m,activeMetricId:g,displayEventId:D,selectedEventId:i,isMobile:y,mobileStep:j});return(0,t.jsx)("button",{className:(0,_.cn)("flex w-full items-center rounded px-2 py-1.5 text-sm font-sans cursor-pointer","bg-white focus:bg-gray-100 focus:outline-none",!b&&"hover:bg-gray-100",(a.isFirstAndActive||a.showSelectedBg)&&"bg-gray-100",a.isActive&&"bg-gray-100"),onMouseEnter:()=>{!b&&(y&&"metrics"===j||f(e.id))},onMouseLeave:()=>{!b&&(y&&"metrics"===j||f(null))},onMouseMove:()=>x(!1),onClick:()=>z(e.id),type:"button",children:(0,t.jsx)("span",{className:"flex-1 text-left",children:e.label})},e.id)}):(0,t.jsx)("div",{className:"px-2 py-4 text-center text-sm text-gray-800",children:d?"No metrics match your search":"No metrics available"})]})})})]})})]})})})})]})}var eS=e.i(2712781),eT=e.i(2924363),eI=e.i(7867910),eD=e.i(1438473);function eA(e){let{onGeneratedQuery:r,query:i,disabled:l}=e,s=(0,N.useToasts)(),{team:o}=(0,n.useTeam)(),m=(0,c.useRef)(null),[p,g]=(0,c.useState)(""),{isGenerating:f,generate:b,error:x}=(e=>{let{onSuccess:t,query:r}=e,[i,l]=(0,c.useState)(!1),[s,o]=(0,c.useState)(null),{team:m}=(0,n.useTeam)(),p=(0,N.useToasts)();return{isGenerating:i,generate:(0,c.useCallback)(async e=>{if(!e.trim())return;l(!0);let i=new URLSearchParams({previousQuery:JSON.stringify(r),prompt:e}).toString();try{let e=await fetch(`${a.API_OBSERVABILITY_QUERY_GENERATION}?${i}`),r=await e.json(),l=r.rollups.value,s=(0,ej.getGroupableDimensions)(r.event),n=r.groupBy?.filter(e=>s.includes(e))??[];o(null),t({metric:`${r.event}.${l.measure}`,by:n,filter:r.filter??"",aggregation:l.aggregation,time:r.range??{from:new Date(r.startTime),to:new Date(r.endTime)}})}catch(t){let e="Error generating query";p.error(e),o(e)}finally{l(!1),d.analytics.track(u.AnalyticsEvent.QUERY_BUILDER_GENERATED_QUERY,{prompt:e,plan:m?.billing?.plan??"hobby"})}},[t,r,m,p]),error:s}})({query:i,onSuccess:e=>{r(e),m.current={query:JSON.stringify(e),prompt:p},g("")}}),y=async()=>{p.trim()&&await b(p)};return(0,t.jsx)(eM,{variant:"inline",disabled:l,query:p,error:x,setQuery:g,isGenerating:f,onNegativeFeedback:()=>{d.analytics.track(u.AnalyticsEvent.QUERY_BUILDER_FEEDBACK,{feedback:"badly-generated-query",plan:o?.billing?.plan??"hobby",prompt:m.current?.prompt??"",generatedQuery:m.current?.query??""}),s.success("Thank you for the feedback!")},onSubmit:()=>void y()})}function eM(e){let{query:r,error:i,setQuery:l,onSubmit:a,enableHotkey:s=!0,isGenerating:n,disabled:o,variant:d="full",onNegativeFeedback:u}=e,m=(0,c.useRef)(null),[p,g]=(0,c.useState)(!1),f=p&&!n&&!i,b="query-builder-input";return(0,eI.useHotkey)(()=>{m.current&&s&&m.current.focus()},"/"),(0,t.jsxs)("form",{onSubmit:e=>{e.preventDefault(),a(r),g(!0)},children:[(0,t.jsx)("label",{className:"sr-only",htmlFor:b,children:"Prompt"}),(0,t.jsx)(K.Input,{className:"h-12 rounded-lg",id:b,innerWrapperClassName:(0,_.cn)("bg-background-100 shadow h-12 font-sans text-[14px] relative z-10 border-gray-200 focus:border-gray-600 rounded-lg overflow-hidden mx-auto","inline"===d&&"h-10 shadow-border rounded-md",{"bg-gray-100":n}),name:b,disabled:n||o,onChange:e=>{l(e.target.value),g(!1)},placeholder:"Show me requests by host...",prefix:(0,t.jsx)(eS.Sparkles,{size:"inline"===d?14:20}),prefixStyling:!1,ref:m,suffix:(0,t.jsxs)("div",{className:(0,_.cn)("flex h-full gap-2","inline"===d?"!pr-1":"!pr-2.5"),children:[s?(0,t.jsx)(eo.Kbd,{className:(0,_.cn)("mr-1","inline"===d&&"mr-1.5",f&&"mr-0.5",0!==r.trim().length&&"hidden"),small:!0,children:"/"}):null,f?(0,t.jsx)(w.Button,{"aria-label":"Not what I expected",className:"!px-0",size:"small",type:"secondary",onClickCapture:e=>{e.preventDefault()},onClick:()=>{g(!1),u()},children:(0,t.jsxs)("div",{className:"flex items-center gap-0.5 px-0.5 md:px-0",children:[(0,t.jsx)("span",{className:"hidden px-1.5 md:block",children:"Not what I expected"}),(0,t.jsx)(eT.ThumbDown,{})]})}):null,(0,t.jsx)(w.Button,{"aria-label":"Build It",className:(0,_.cn)("!px-0","inline"===d&&"disabled:hidden"),disabled:0===r.trim().length||n,size:"small",typeName:"submit",children:(0,t.jsxs)("div",{className:"flex items-center gap-0.5 px-0.5 md:px-0",children:[(0,t.jsx)("span",{className:"hidden px-1.5 md:block",children:"Generate Query"}),(0,t.jsx)(eD.ArrowRight,{})]})})]}),suffixContainer:!1,suffixStyling:!1,typeName:"text",value:r})]})}var eB=e.i(962099),eR=e.i(6029070),eF=e.i(5627633),eP=e.i(268049);function e_(e){return{granularity:e,id:(0,eP.milliseconds)(e).toString(),label:(0,eF.formatDuration)(e),type:"string"}}var eq=e.i(6190059),eL=e.i(1283928),ez=e.i(1717203),eQ=e.i(4597921),eK=e.i(9486194),eU=e.i(8690335),eV=e.i(4337458),eH=e.i(9667097),eG=e.i(1233856),e$=e.i(4919835),eW=e.i(9429462),eY=e.i(7722264),eZ=e.i(2107254),eJ=e.i(747275);let eX=e=>{let{observabilityConfiguration:t}=(0,h.useHasObservabilityPlus)(),r=(0,s.useTeamSlug)(),{data:i,updateSearch:l,search:a}=(0,eZ.default)({limit:10,latestDeployments:null},{},r??void 0);return{decorate:(0,c.useCallback)(async e=>[...e,...i?.projects.map(e=>{let{id:t,name:r}=e;return{id:t,value:t,label:r}})??[]].map(e=>t?.observabilityPlus.excludedProjects?.some(t=>t.id===e.id)?{...e,disabled:!0,tooltip:"Excluded from Observability Plus"}:e),[t,i]),triggerMutation:async e=>{a!==e.text&&l(e.text)},dimensionId:"projectId"}},e0=e=>{let{trigger:t}=(0,eW.useDeploymentBadgeResolverMutation)(e);return{decorate:(0,c.useCallback)(async e=>{try{let r=await t();return(0,e$.applyBadgesToDeploymentIds)(e,r)}catch{return e}},[t]),triggerMutation:()=>t().catch(()=>{}),dimensionId:"deploymentId"}},e1=e=>{let{event:t,measure:r}=(0,eU.splitEventAndMeasure)(e),i=(0,eV.useSonarQueryScope)(),{hasObservabilityPlusAccess:l}=(0,h.useHasObservabilityPlus)();return{decorate:async(e,a)=>{let{dimension:s,text:n}=a;return i?[...e,...await e2({event:t,measure:r,column:s.id,reason:l?"observability_query_builder_plus":"observability_query_builder_free",text:n,...i})]:[]},dimensionId:null}};async function e2(e){let{event:t,measure:r,column:i,ownerId:l,reason:a,text:s}=e,n={minutes:5},o=(0,eG.startOfDuration)(new Date(Date.now()-36e5),n),d=(0,eG.endOfDuration)(new Date,n),u=eU.labelColumnByColumn.get(i),c=eK.staticDimensionValues.find(e=>e.dimensions.includes(i))?.values,m="number"===eL.AllDimensions[i].type;if(c)return c.map(e=>({id:e.id.toString(),value:e.id,..."label"in e?{label:e.label}:{}})).sort((e,t)=>String(e.id).localeCompare(String(t.id)));let p=s?`contains(${u||i},'${s}')`:void 0;return(await (0,eH.getSonarData)({event:t,scope:{type:"owner",ownerId:l},reason:a,startTime:o,endTime:d,rollups:{value:{measure:r,aggregation:"sum"}},filter:p,granularity:n,groupBy:u?[i,u]:[i],limit:10,tailRollup:"truncate",summaryOnly:!0})).summary.map(e=>{let t=m?Number.parseFloat(e[i]):e[i];return{id:t.toString(),label:u?e[u]:void 0,value:t}})}var e5=e.i(1111237),e4=e.i(9722978),e7=e.i(6198010);let e8="!ring-1 ring-gray-400 outline-offset-2 outline-[var(--ds-focus-color)] outline-2 overflow-visible focus:outline";function e3(e){let{className:r,dimensions:i,values:l,onChange:a,isLoading:s,disabled:n,id:o}=e,[d,u]=(0,c.useReducer)(e6,{values:l,dimensions:i},e9);(0,c.useEffect)(()=>{u({type:"updateProps",dimensions:i,values:l})},[i,l]);let m=d.values.length>0;return(0,t.jsxs)("fieldset",{id:o,className:(0,e4.clsx)("tailwind-preflight flex flex-row items-center gap-2",r),children:[d.values.map((e,r)=>(0,t.jsxs)(c.Fragment,{children:[(0,t.jsx)(Q.SingleFilterPopoverBox,{className:(0,e4.clsx)("!p-1",e8,!n&&"!rounded-l"),disabled:n,label:"dimension",onChange:e=>u({type:"change",value:e,index:r,onChange:a}),onOpenChange:e=>u({type:"toggle",open:e,index:r}),open:d.open[r],options:d.remaining,rounded:n,value:e}),n?null:(0,t.jsx)(w.Button,{"aria-label":`Remove ${e.label}`,className:(0,e4.clsx)("-ml-2 !px-0.5 !text-gray-900 hover:!text-gray-1000",e8),onClick:()=>u({type:"remove",index:r,onChange:a}),size:"small",style:{borderTopLeftRadius:0,borderBottomLeftRadius:0},svgOnly:!0,type:"secondary",typeName:"button",children:(0,t.jsx)(Z.CrossSmall,{size:"small"})})]},e.id)),!n&&(0,t.jsx)(Q.SingleFilterPopoverBox,{className:"border !p-1",isLoading:s,label:"dimension",onChange:e=>u({type:"add",value:e,onChange:a}),onOpenChange:e=>u({type:"toggle",open:e}),open:d.openAdd,options:d.remaining,rounded:!0,children:(0,t.jsx)(w.Button,{"aria-label":"Add dimension",className:"!text-gray-900 data-[state='open']:!bg-gray-100 hover:!text-gray-1000",size:"small",type:"tertiary",...m?{shape:"square",svgOnly:!0,children:(0,t.jsx)(e7.Plus,{})}:{prefix:(0,t.jsx)(e7.Plus,{}),children:"Group by"}})})]})}function e9(e){let{values:t,dimensions:r}=e;return{open:Array.from(t,()=>!1),openAdd:!1,values:t,remaining:te(r,t),allDimensions:r}}function e6(e,t){switch(t.type){case"toggle":if(void 0===t.index)return{...e,openAdd:t.open};return t.index<0||t.index>=e.values.length?{...e}:{...e,open:[...e.open.slice(0,t.index),t.open,...e.open.slice(t.index+1)]};case"updateProps":{let{dimensions:r}=t,i=t.values.filter(e=>{let{id:t}=e;return r.some(e=>e.id===t)});return{...e,remaining:te(r,i),values:i,allDimensions:r}}case"add":return{...e,...tt(e.allDimensions,[...e.values,t.value],t.onChange)};case"change":{let{index:r,value:i,onChange:l}=t;if(r<0||r>=e.values.length)return e;return{...e,...tt(e.allDimensions,[...e.values.slice(0,r),i,...e.values.slice(r+1)],l)}}case"remove":{let{index:r,onChange:i}=t;return{...e,...tt(e.allDimensions,[...e.values.slice(0,r),...e.values.slice(r+1)],i)}}default:return e}}function te(e,t){return e.filter(e=>{let{id:r}=e;return!t.some(e=>e.id===r)})}function tt(e,t,r){return setTimeout(()=>r?.(t),0),{open:Array.from(t,()=>!1),openAdd:!1,values:t,remaining:te(e,t)}}var tr=e.i(8522580),ti=e.i(6982071);e.i(6837494);var tl=e.i(4896489);function ta(){let{team:e}=(0,n.useTeam)(),r=(0,tl.useOpenEnableModal)(),[,i]=(0,q.useQueryBuilderQueryState)(),l=e?.billing?.plan==="hobby"?"Upgrade to Pro":"Get Observability Plus";return(0,t.jsx)("div",{className:"-mt-1 pb-3",children:(0,t.jsx)(tr.Note,{action:(0,t.jsx)(w.Button,{size:"small",onClick:()=>{d.analytics.track(u.AnalyticsEvent.OBSERVE_FEATURE_SEPARATION,{plan:e?.billing?.plan??"hobby",page:"query-builder",type:"modal_opened"}),r({from:"observability",via:"query-builder"}),i({builder:!1})},children:l}),variant:"contrast",fill:!0,icon:(0,t.jsx)(ti.LockClosedSmall,{}),type:"secondary",className:"!rounded-md !pr-1.5",size:"small",children:(0,t.jsxs)("p",{children:["Read-only mode."," ",(0,t.jsx)("span",{className:"font-medium",children:"Unlock custom queries"})," by upgrading to"," ",e?.billing?.plan==="hobby"?"Pro and Observability Plus":"Observability Plus","."]})})})}function ts(e){let{children:r,className:i,htmlFor:l,...a}=e;return(0,t.jsx)("label",{className:(0,_.cn)("text-sm font-medium text-gray-800",i),htmlFor:l,...a,children:r})}function tn(e){let{shouldShowAIQuery:r,isObservabilityPlusReady:i,hasObservabilityPlusAccess:l,setQuery:a,sonarQuery:s}=e;return r?!i||l?(0,t.jsx)("div",{className:"mb-3",children:(0,t.jsx)(eA,{onGeneratedQuery:a,query:s})}):(0,t.jsx)(ta,{}):l?null:(0,t.jsx)(ta,{})}function to(e){let{query:r,setQuery:i,Actions:a,Title:s,variables:o,enableVariables:d}=e,u=(0,eQ.useServerFlag)("observability-query-granularity",!1),[m,p]=(0,c.useState)(!1),[g,b]=(0,c.useState)(!1),[x,y]=(0,c.useState)(!1),[v,j]=(0,c.useState)(!1),{hasObservabilityPlusAccess:E,ready:k}=(0,h.useHasObservabilityPlus)(),C=(0,eQ.useServerFlag)("show-o11y-ai-query",!0),{isReady:O,accessibleDimensions:S,by:T}=(0,eR.useAccessibleDimensions)(r),{accessibleEvents:I,isReady:D}=(()=>{let{can:e}=(0,ez.default)(),{team:t}=(0,n.useTeam)(),r=(0,eQ.useServerFlag)("bot-id-ui",!1);return t?{isReady:!0,accessibleEvents:eK.queryBuilderEvents.filter(i=>("botIdCheck"!==i||!!r)&&(0,ej.canAccessEvent)({event:i,team:t,can:e})).map(e=>({id:e,label:"label"in eL.AllEvents[e]?eL.AllEvents[e].label:e,type:"string",group:(e=>{switch(e){case"serverlessFunctionInvocation":case"middlewareInvocation":case"outgoingRequest":return"Compute";case"incomingRequest":case"imageTransformation":case"isrOperation":return"Edge Network";case"blockedConnection":case"firewallAction":case"botIdCheck":return"Security";case"edgeFunctionInvocation":return"Deprecated";default:return"Other"}})(e)})).toSorted((e,t)=>"Deprecated"===e.group&&"Deprecated"!==t.group?1:"Deprecated"!==e.group&&"Deprecated"===t.group?-1:0)}:{isReady:!1,accessibleEvents:[]}})(),{event:A,measure:M}=(0,eU.splitEventAndMeasure)(r),{accessibleMetrics:B,isReady:R}=(0,eq.useAccessibleMetrics)(),{accessibleAggregations:F,aggregation:P}=(0,eB.useAccessibleAggregations)(r),q=(e=>{let t=(0,N.useToasts)(),{decorate:r,triggerMutation:i}=function(e,t){let r=t.map(t=>t(e)),i=(0,c.useRef)(r);i.current=r;let l=e=>i.current.filter(t=>null===t.dimensionId||t.dimensionId===e.dimension.id);return{decorate:async(e,t)=>{let r=e;for(let e of l(t))r=await e.decorate(r,t);return r},triggerMutation:e=>Promise.all(l(e).map(t=>t.triggerMutation?.(e)))}}(e,[e1,eX,e0]);return async e=>{let{dimension:l,text:a}=e;try{i({dimension:l,text:a});let e=await r([],{dimension:l,text:a});return(0,eJ.default)(e,"id")}catch(e){return t.error(`Error fetching dimension values. ${(0,eY.isError)(e)?e.message:""}`),[]}}})(r),{accessibleGranularities:K,granularity:H}=(e=>{let t=(0,c.useMemo)(()=>{let{start:t,end:r}=(0,f.fromTimeToRange)(e.time);return Math.round(r.getTime()-t.getTime())},[e.time]),r=(0,c.useMemo)(()=>(0,f.getGranularityFromDuration)(t),[t]),i=(0,c.useMemo)(()=>{let e=[],i=(0,eP.milliseconds)(r);for(let r of f.preferredGranularities){let l=(0,eP.milliseconds)(r);l>=i&&l<=t&&e.push(e_(r))}return e},[r,t]),l=(0,c.useMemo)(()=>i.find(t=>{let{id:r}=t;return r===(0,eP.milliseconds)(e.granularity??{}).toString()})??e_(r),[r,i,e.granularity]);return{accessibleGranularities:i,granularity:l}})(r),{event:$}=(0,eU.splitEventAndMeasure)(r),Z=(0,c.useCallback)((e,t)=>{let r=(0,ej.getGroupableDimensions)(e);return t.filter(e=>r.includes(e))},[]);(0,c.useEffect)(()=>{if(r.by.length>0){let e=Z($,r.by);e.length!==r.by.length&&i({by:e})}},[r.by,i,$,Z]),(0,c.useMemo)(()=>B.find(e=>e.id===r.metric),[B,r.metric]);let J=(0,c.useMemo)(()=>({dimensions:S,operators:er.operators,resolveValues:q,defaultSingleOperator:er.defaultSingleOperator,defaultMultiOperator:er.defaultMultiOperator,defaultArrayOperator:er.defaultArrayOperator}),[S,q]),X=(0,c.useMemo)(()=>(0,eU.toSonarQuery)(r),[r]),ee=(0,c.useMemo)(()=>(0,eU.parseFilters)(r.filter),[r.filter]),et=0===ee.length&&r.filter,ei=(0,c.useMemo)(()=>(0,l.replaceVariables)(r,o),[r,o]),el=(0,c.useCallback)(e=>i({filter:(0,eU.serializeFilters)(e)}),[i]),ea=(0,c.useCallback)(e=>{let t=r.view;0===e.length&&t?.type==="table"?t={type:"big-number"}:e.length>0&&t?.type==="big-number"&&(t={type:"table"}),i({by:e.map(e=>{let{id:t}=e;return t}),view:t})},[i,r.view]),es=!R||!E,eo=(0,c.useRef)(null),ed=(0,c.useCallback)(()=>{eo.current&&y(eo.current.scrollTop>40)},[]),eu=(0,c.useCallback)(()=>{eo.current&&eo.current.scrollTo({top:0,behavior:"smooth"})},[]);return(0,t.jsxs)("div",{ref:eo,className:"relative flex h-full flex-col overflow-y-auto overflow-x-hidden",onScroll:ed,children:[(0,t.jsxs)("div",{className:"sticky left-0 top-0 z-10 mb-px flex items-center justify-between gap-3 bg-background-100 p-4 pb-2",style:{background:"linear-gradient(to bottom, var(--ds-background-100) 0%, var(--ds-background-100) 80%, transparent 100%)"},children:[(0,t.jsx)("div",{className:"flex flex-1 items-center justify-start gap-2",children:s}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(w.Button,{"aria-label":"Scroll to top",onClick:eu,type:"tertiary",svgOnly:!0,"aria-hidden":!x,shape:"square",className:(0,_.cn)("transition-all duration-200",x?"opacity-100 translate-y-0":"opacity-0 translate-y-2 pointer-events-none"),tabIndex:x?0:-1,children:(0,t.jsx)(G.ArrowUp,{size:16})}),a]})]}),(0,t.jsxs)("div",{className:"sticky left-0 z-[4] px-4 py-0",children:[(0,t.jsx)(tn,{shouldShowAIQuery:C,isObservabilityPlusReady:k,hasObservabilityPlusAccess:E,setQuery:i,sonarQuery:X}),(0,t.jsxs)("div",{className:"-mx-4 flex flex-col-reverse items-start gap-2 px-4 pb-0 md:flex-row md:gap-3",children:[(0,t.jsxs)(U.Scroller,{className:"-ml-1 -mb-2",childrenContainerClassName:"p-px gap-2 flex pb-2 pl-1",overflow:"x",width:"100%",children:[(0,t.jsxs)("div",{className:"flex min-w-[300px] shrink-0 flex-row gap-2",children:[(0,t.jsxs)("div",{className:"flex flex-col gap-1.5",children:[(0,t.jsx)(ts,{htmlFor:"event-metric",children:"Metric"}),(0,t.jsx)(eO,{disabled:es,selectedEventId:A,selectedMetricId:M,events:I,onSelect:(e,t)=>{i({metric:`${e}.${t}`,aggregation:"sum"})}})]}),(0,t.jsxs)("div",{className:"flex flex-col gap-1.5",children:[(0,t.jsx)(ts,{htmlFor:"aggregation",className:"opacity-0",children:"Aggregate"}),(0,t.jsx)(Q.SingleFilterPopoverBox,{id:"aggregation",className:"!px-2 !py-4",disabled:es,label:"aggregation",onChange:e=>{i({aggregation:e.id}),b(!1)},onOpenChange:b,open:g,options:F,rounded:!0,suffix:(0,t.jsx)(W.ChevronUpDown,{color:"gray-800"}),value:P})]})]}),(0,t.jsxs)("div",{className:"flex flex-col gap-1.5",children:[(0,t.jsx)(ts,{htmlFor:"by",className:(0,_.cn)("transition-all duration-75",T.length>0?"opacity-100 translate-y-0":"opacity-0 translate-y-1"),children:"Group By"}),(0,t.jsx)(e3,{id:"by",dimensions:S,disabled:es,isLoading:!O,onChange:ea,values:T})]})]}),(0,t.jsx)("div",{className:"flex items-center justify-end gap-x-1 md:pt-[22px]",children:(0,t.jsx)(en,{disabled:es,value:r.time,onChange:e=>i({time:e}),trackEvents:!0,variables:o,enableVariables:d})})]}),et?(0,t.jsx)(td,{setQuery:i,query:r}):null,(0,t.jsxs)("div",{className:"flex flex-row items-end gap-5",children:[es&&0===ee.length||et?null:(0,t.jsxs)("div",{className:"flex-1 flex flex-col gap-1.5 px-px mt-2",children:[(0,t.jsx)(ts,{htmlFor:"filter",children:"Filter"}),O?(0,t.jsx)(z.FilterBar,{config:J,disabled:es,filters:ee,onChange:el}):(0,t.jsx)(V.Skeleton,{height:32,width:100})]}),(0,t.jsxs)("span",{className:"flex flex-row gap-2",children:[u?(0,t.jsx)(Q.SingleFilterPopoverBox,{id:"granularity",disabled:es,label:"granularity",onChange:e=>{let{granularity:t}=e;i({granularity:t}),j(!1)},onOpenChange:j,open:v,options:K,prefix:(0,t.jsx)(Y.Clock,{color:"gray-900"}),rounded:!0,suffix:(0,t.jsx)(W.ChevronUpDown,{color:"gray-800"}),value:H}):null,(0,t.jsx)(tc,{query:r,onChange:e=>i({view:e})})]})]})]}),(0,t.jsx)("div",{className:"mt-4 h-px shrink-0 border-t border-gray-400 bg-gray-400"}),(0,t.jsx)(L.SonarContextProvider,{children:(0,t.jsx)(e5.ResultsChart,{query:ei,sticky:!0,setQuery:i,showTable:r.by.length>0,readOnly:es,scrollerRef:eo})})]})}function td(e){let{setQuery:r,query:i}=e;return(0,t.jsxs)("div",{className:"flex w-full flex-row items-center gap-2 py-2",children:[(0,t.jsx)(j.Tooltip,{text:"Invalid or unsupported filter saved",children:(0,t.jsx)(et.Question,{size:16})}),(0,t.jsxs)("div",{className:"flex w-full flex-row items-center",children:[(0,t.jsx)(j.Tooltip,{className:"w-full",text:i.filter,children:(0,t.jsx)("div",{className:"w-full",children:(0,t.jsx)(K.Input,{"aria-label":"Invalid or unsupported filter saved",className:"w-full overflow-visible outline-2 outline-offset-2 outline-[var(--ds-focus-color)] !ring-1 ring-gray-400 focus:outline",disabled:!0,style:{borderTopRightRadius:0,borderBottomRightRadius:0},value:i.filter})})}),(0,t.jsx)(w.Button,{"aria-label":"Clear filter",className:"overflow-visible !border-l-0 outline-2 outline-offset-2 outline-[var(--ds-focus-color)] !ring-1 ring-gray-400 focus:outline",onClick:()=>r({filter:""}),size:"medium",style:{borderTopLeftRadius:0,borderBottomLeftRadius:0},svgOnly:!0,type:"secondary",children:(0,t.jsx)(Z.CrossSmall,{size:20})})]})]})}let tu=[{type:"line",icon:(0,t.jsx)(J.LineChart,{})},{type:"area",icon:(0,t.jsx)($,{})},{type:"table",icon:(0,t.jsx)(X.MenuAlt,{}),isDisabled:e=>(e?.by.length??0)===0?"Add a Group By clause to view results in a Table.":null},{type:"big-number",icon:(0,t.jsx)(ee.Percentage,{}),isDisabled:e=>(e?.by.length??0)>=1?"Remove your Group By clause to view results as a number.":null}];function tc(e){let{query:r,onChange:i}=e,l=tu.filter(e=>{let{isDisabled:t}=e;return!t?.(r)});return(0,t.jsx)(H.Switch,{name:"view",size:"small",children:l.map(e=>{let{type:l,icon:a}=e;return(0,t.jsx)(H.Switch.Control,{checked:(r?.view?.type??"line")===l,icon:a,value:l,onChange:()=>i({type:l})},l)})})}function tm(){let[e,r]=(0,q.useQueryBuilderQueryState)(),{hasObservabilityPlusAccess:i,ready:l}=(0,h.useHasObservabilityPlus)(),a=e.fullScreen??!1;return(0,t.jsx)(M.Sheet,{onOpenChange:e=>r({builder:e}),open:e.builder,children:(0,t.jsx)(M.SheetContent,{className:(0,_.cn)("m-3 h-[calc(100%-1.5rem)] w-[calc(100%-1.5rem)] overflow-visible rounded-[1rem] bg-white p-0 lg:w-3/4 sm:max-w-[auto]",a&&"!w-[calc(100%-1.5rem)]"),onEscapeKeyDown:e=>{e.target instanceof HTMLInputElement&&e.preventDefault()},side:"right",children:(0,t.jsxs)("div",{className:"flex h-full flex-col overflow-hidden rounded-[1rem]",children:[(0,t.jsx)(to,{Actions:(0,t.jsx)(tg,{fullScreen:a,setFullScreen:e=>r({fullScreen:e})}),query:e,setQuery:r,Title:(0,t.jsx)(tp,{})}),l&&i?(0,t.jsx)("section",{className:"flex justify-end border-t bg-background-200 p-3",children:(0,t.jsx)(C,{query:e})}):null]})})})}function tp(){let e=(0,N.useToasts)();return(0,t.jsxs)(M.SheetHeader,{children:[(0,t.jsx)(M.SheetTitle,{className:"hidden"}),(0,t.jsxs)("div",{className:"sticky top-0 z-10 flex items-center gap-2 bg-background-100 pl-2",children:[(0,t.jsx)(A.Text,{className:"text-nowrap",variant:"heading-20",children:"Run Query"}),(0,t.jsx)(w.Button,{"aria-label":"Copy to clipboard",className:"!px-1.5",onClick:()=>{(0,D.copyToClipboard)(window.location.href),e.message("URL copied to clipboard!")},size:"small",svgOnly:!0,shape:"square",type:"tertiary",children:(0,t.jsx)(P.Link,{color:"gray-800"})})]})]})}function tg(e){let{fullScreen:r,setFullScreen:i}=e;return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(w.Button,{"aria-label":r?"Minimize":"Expand",onClick:()=>i(!r),svgOnly:!0,className:"hidden lg:block",shape:"square",type:"tertiary",children:r?(0,t.jsx)(j.Tooltip,{text:"Minimize",position:"bottom",children:(0,t.jsx)(F.FullscreenClose,{})}):(0,t.jsx)(j.Tooltip,{text:"Expand",position:"bottom",children:(0,t.jsx)(R.Fullscreen,{})})}),(0,t.jsx)(M.SheetClose,{asChild:!0,children:(0,t.jsx)(w.Button,{"aria-label":"Close",shape:"square",size:"medium",svgOnly:!0,type:"tertiary",children:(0,t.jsx)(B.Cross,{})})})]})}}]);

//# sourceMappingURL=655e4e4786c98fa7.js.map
//# debugId=61d06ed7-5662-55f9-aa1f-e6e1455a48ed
