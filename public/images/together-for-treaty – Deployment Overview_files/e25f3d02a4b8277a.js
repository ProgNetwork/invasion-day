
!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="49e6a4b5-657b-5b5d-b403-799df041f750")}catch(e){}}();
(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,9507427,e=>{"use strict";e.s(["allowedFirewallActions",()=>p,"defaultFilter",()=>t,"defaultShowSystemRules",()=>o,"firewallPlanLimits",()=>n,"isLimitedSystemRule",()=>u,"owaspToCrsConfig",()=>m,"planLimitText",()=>s,"ruleToMappings",()=>r,"stableSort",()=>d,"systemFilter",()=>a]);let t=[{label:"User Agent",value:"clientUserAgent"},{label:"Country",value:"clientIpCountry"},{label:"IP Address",value:"clientIp"},{label:"Request Path",value:"requestPath"},{label:"Vercel Region",value:"edgeNetworkRegion"},{label:"Route",value:"sourcePath"},{label:"JA4 Digest",value:"clientJa4Digest"},{label:"Host",value:"requestHostname"}],a=[{label:"IP Address",value:"clientIp"},{label:"Country",value:"clientIpCountry"},{label:"JA4 Digest",value:"clientJa4Digest"},{label:"Host",value:"requestHostname"}],l={sys_dos_mitigation:{label:"DDoS Mitigation",groupBy:"System",rank:11},ip_blocking:{label:"IP Blocking",groupBy:"System",rank:12}},i={owasp_anomaly_detection:{label:"OWASP Anomaly Detection",groupBy:"System",rank:3,keys:["gen","java","ma","sd"]},owasp_xss_detection:{label:"OWASP XSS Detection",groupBy:"System",rank:4,keys:["xss"]},owasp_sqli_detection:{label:"OWASP SQL Injection Detection",groupBy:"System",rank:5,keys:["sqli"]},owasp_rfi_detection:{label:"OWASP RFI Detection",groupBy:"System",rank:6,keys:["rfi"]},owasp_lfi_detection:{label:"OWASP LFI Detection",groupBy:"System",rank:7,keys:["lfi"]},owasp_rce_detection:{label:"OWASP RCE Detection",groupBy:"System",rank:8,keys:["rce"]},owasp_php_detection:{label:"OWASP PHP Injection Detection",groupBy:"System",rank:9,keys:["php"]},owasp_session_fixation_detection:{label:"OWASP Session Fixation Detection",groupBy:"System",rank:10,keys:["sf"]}},r={default_web_traffic:{label:"Allowed Requests",groupBy:"System",rank:1},challenge_mode:{label:"Challenge Mode",groupBy:"System",rank:2},...i,...l},n={hobby:{customRules:3,ipBlocks:10,ipBypass:0,rateLimit:1},pro:{customRules:40,ipBlocks:100,ipBypass:25,rateLimit:40},enterprise:{customRules:1e3,ipBlocks:1e3,ipBypass:100,rateLimit:1e3}},s={pro:{customRules:{title:"Need more custom rules?",description:"Upgrade to Enterprise Plan"},ipBlocks:{title:"Need to block more IPs?",description:"Upgrade to Enterprise Plan"},ipBypass:{title:"Need to allow more IPs?",description:"Upgrade to Enterprise Plan"},rateLimit:{title:"Need more rate limit rules?",description:"Upgrade to Enterprise Plan"}},hobby:{customRules:{title:"Need more custom rules?",description:`Upgrade to pro to add up to ${n.pro.customRules} custom rules`},ipBlocks:{title:"Need to block more IPs?",description:`Upgrade to pro to block up to ${n.pro.ipBlocks} IPs`},ipBypass:{title:"Need to setup an IP bypass?",description:`Upgrade to pro to allow up to ${n.pro.ipBypass} IPs`},rateLimit:{title:"Need more rate limit rules?",description:`Upgrade to pro to add up to ${n.pro.rateLimit} rate limit rules`}}},o=[{label:r.default_web_traffic.label,value:"default_web_traffic",action:"allow"},{label:r.challenge_mode.label,value:"challenge_mode",action:"challenge"},...Object.entries(l).map(e=>{let[t,a]=e;return{label:a.label,value:t,action:"deny"}})],c=Object.entries(r).reduce((e,t)=>{let[a,l]=t;return Object.assign(e,{[a]:l.rank})},{});function d(e,t){let[a]=e.split("$"),[l]=t.split("$"),i=c[a],r=c[l];return i&&r?i-r:i?-i:r||e.localeCompare(t)}function u(e){return e in l}function m(e){return Object.entries(i).reduce((t,a)=>{let[l,i]=a,r=e.filter(e=>i.keys.includes(e.id)&&e.active);if(r.length>0){let e=Array.from(r.reduce((e,t)=>(e.add(t.action),e),new Set));t.push({label:i.label,value:l,action:e.join(" / ")})}return t},[])}function p(e,t){let a=[{value:"log",label:"Log",subtext:"Log traffic and do nothing more"},{value:"deny",label:t?"Deny (403)":"Deny",subtext:"Block traffic from accessing your site"},{value:"challenge",label:"Challenge",subtext:"Verify traffic at a security checkpoint before allowing access to your site"}];return t||a.push({value:"bypass",label:"Bypass",subtext:"Bypass existing rules and allow traffic access to your site"}),e&&a.push({value:"rate_limit",label:t?"Too Many Requests (429)":"Rate Limit",subtext:"Enforce frequency limitations on traffic"}),t||a.push({value:"redirect",label:"Redirect",subtext:"Redirect traffic to a different page"}),a}},8353464,e=>{"use strict";e.s(["countRateLimitRules",()=>x,"denormalizeFirewallAction",()=>h,"formatFirewallActionForDisplay",()=>g,"formatShortPrecision",()=>n,"formatTableHeader",()=>s,"getOffsetTop",()=>u,"getPlanUsage",()=>o,"getSonarSeriesData",()=>r,"globalBypassStatus",()=>m,"isCustomRuleId",()=>y,"isOthersAggregate",()=>f,"isPlanLimitReached",()=>c,"isValidEdgeRateLimitKey",()=>d,"normalizeFirewallAction",()=>p,"wafRuleId",()=>v]);var t=e.i(4708200),a=e.i(3863657),l=e.i(6493958),i=e.i(9507427);function r(e,l,i,r){let n=new Map,s=e=>{let i=[];for(let a of l){let l=e[a];if(null==l||("wafAction"===a?l=p(l||"allow"):"wafRuleId"===a&&(l||="default_web_traffic"),!l&&r.groupBy===a))return t.hideDataKey;i.push(l)}return i.join(a.SEPARATOR)},o=!0,c=new Set;for(let a of e){let e=s(a);e!==t.hideDataKey&&(o=!1),n.has(e)||e===t.hideDataKey||n.set(e,[]);let l=a.timestamp;c.add(l.toISOString()),n.get(e)?.push({...a,date:l,key:e})}if(l.every(e=>["wafRuleId","wafAction"].includes(e))){let e=Array.from(c.values()).map(e=>new Date(e));for(let t of i){let l=[t.value,t.action].join(a.SEPARATOR);n.has(l)||"all_rules"===t.value||n.set(l,e.map(e=>({date:e,timestamp:e,key:l,value:0})))}}return o?new Map:n}function n(e){return(0,l.countFormatter)(e,"short-precision").replace(/\s/g,"")}function s(e,t){let a=e.find(e=>e.value===t);return a?a.label:t}function o(e){let{teamPlan:t,config:a,bypassRules:l,type:r}=e;if(!t)return;let n=i.firewallPlanLimits[t][r],s="hobby"===t?"pro":"pro"===t?"enterprise":void 0,o=s?i.firewallPlanLimits[s][r]:void 0;if("ipBypass"===r)return{limit:n,used:l?.length||0,limitReached:(l?.length||0)>=n,nextPlanLimit:o};if(null==a)return{limit:n,used:0,limitReached:!1,nextPlanLimit:o};if("ipBlocks"===r)return{limit:n,used:a.currentConfig.ips.length,limitReached:a.currentConfig.ips.length>=n,nextPlanLimit:o};if("rateLimit"===r){let e=x(a);return{limit:n,used:e,limitReached:e>=n,nextPlanLimit:o}}return{limit:n,used:a.rules.length,limitReached:a.rules.length>=n,nextPlanLimit:o}}function c(e){let{teamPlan:t,config:a,bypassRules:l,type:r}=e;if(!t)return!0;let n=i.firewallPlanLimits[t][r];return"ipBypass"===r?"hobby"===t||!!l&&l.length>=n:null!==a&&(void 0===a||("ipBlocks"===r?a.currentConfig.ips.length>=n:"rateLimit"===r?x(a)>=n:a.rules.length>=n))}function d(e){switch(e){case"ip":case"ja4":return!0;default:return e.startsWith("header:")}}function u(e){let t=e,a=0;for(;t;)a+=t.offsetTop,t=t.offsetParent;return a}function m(e){let t=e?.security?.firewallBypassIps;if(!t)return{enabled:!1};let a={enabled:!1};for(let e of t){let t=e.split("#");if("0.0.0.0/0"===t[0]||"::/0"===t[0]&&t.length>=2){let e=Number.parseInt(t[1],10);!Number.isNaN(e)&&e>Date.now()/1e3&&(a.ttl=e,a.enabled=!0)}}return a}function p(e){return"rate-limit"===e?"rate_limit":e}function h(e){return"rate_limit"===e?"rate-limit":e}function g(e){return void 0===e?"":p(e).replace("_"," ")}function x(e){return e?e.rules.filter(e=>"value"in e&&e.value.action?.mitigate?.action==="rate_limit"&&!!e.value.action.mitigate.rateLimit&&!!e.value.active).length:0}function f(e){return RegExp(`(Others(${a.SEPARATOR})?)+`).test(e)}function y(e){return"string"==typeof e&&(e.startsWith("rule_")||"deployment_defined_rules"===e)}function v(e){return"default_web_traffic"===e?"":"managed_bot_filter"===e?"managed_bot_protection":e}},8626589,e=>{"use strict";e.s(["Hash",()=>t]);let t=(0,e.i(9334638).withNewIcon)('<path fill-rule="evenodd" clip-rule="evenodd" d="M7.24058 1.8685L7.35907 1.12792L5.87791 0.89093L5.75942 1.63151L5.22046 5H2.5H1.75V6.5H2.5H4.98046L4.42046 10H2.5H1.75V11.5H2.5H4.18046L3.75942 14.1315L3.64093 14.8721L5.12209 15.1091L5.24058 14.3685L5.69954 11.5H9.18046L8.75942 14.1315L8.64093 14.8721L10.1221 15.1091L10.2406 14.3685L10.6995 11.5H13.5H14.25V10H13.5H10.9395L11.4995 6.5H13.5H14.25V5H13.5H11.7395L12.2406 1.8685L12.3591 1.12792L10.8779 0.89093L10.7594 1.63151L10.2205 5H6.73954L7.24058 1.8685ZM9.98046 6.5H6.49954L5.93954 10H9.42046L9.98046 6.5Z" fill="currentColor"/>')},9937599,e=>{"use strict";e.s(["Location",()=>t]);let t=(0,e.i(9334638).withNewIcon)('<path fill-rule="evenodd" clip-rule="evenodd" d="M11.5253 10.2634L8 13.8578L4.47471 10.2634C2.50843 8.25857 2.50843 4.99627 4.47471 2.99144C6.42507 1.00285 9.57493 1.00285 11.5253 2.99144C13.4916 4.99627 13.4916 8.25857 11.5253 10.2634ZM12.5962 11.3137L9.05051 14.9289L8 16L6.94949 14.9289L3.40381 11.3137C0.865397 8.72554 0.865399 4.52929 3.40381 1.94113C5.94222 -0.647042 10.0578 -0.647042 12.5962 1.94113C15.1346 4.52929 15.1346 8.72554 12.5962 11.3137ZM9 6.5C9 7.05228 8.55228 7.5 8 7.5C7.44772 7.5 7 7.05228 7 6.5C7 5.94772 7.44772 5.5 8 5.5C8.55228 5.5 9 5.94772 9 6.5ZM8 9C9.38071 9 10.5 7.88071 10.5 6.5C10.5 5.11929 9.38071 4 8 4C6.61929 4 5.5 5.11929 5.5 6.5C5.5 7.88071 6.61929 9 8 9Z" fill="currentColor"/>')},1091572,e=>{"use strict";e.s(["digitSchema",()=>c,"hostnameSchema",()=>r,"ipAndCidrsSchema",()=>s,"optionalString",()=>l,"pathSchema",()=>o,"regexSchema",()=>n,"stringSchema",()=>i]),e.i(3512434);var t=e.i(9835407),a=e.i(423255);let l=t.z.string().nullable(),i=t.z.string().min(1,"Requires a value"),r=t.z.string().min(1,"Requires a value").refine(e=>/^(?!-)[A-Za-z0-9-]{1,63}(?<!-)(?:\.(?!-)[A-Za-z0-9-]{1,63}(?<!-))*$/.test(e),{message:"Invalid host name provided"}),n=t.z.string().min(1,"Requires a value").refine(e=>{try{return new RegExp(e),!0}catch(e){return!1}},{message:"Invalid regular expression provided"}),s=t.z.string().min(1,"Requires a value").superRefine((e,l)=>{if(!a.default.isIP(e)){if(a.default.isIPRange(e)){let[a,i]=e.split("/"),r=Number.parseInt(i,10);return a.includes(".")?r<0?void l.addIssue({code:t.z.ZodIssueCode.custom,message:"IPv4 CIDR cannot have a net mask less than /0"}):{isValid:!0,errorMsg:""}:void(r>32&&l.addIssue({code:t.z.ZodIssueCode.custom,message:"IPv6 CIDR cannot have a net mask greater than /32"}))}l.addIssue({code:t.z.ZodIssueCode.custom,message:"Invalid IP address or CIDR"})}}),o=t.z.string().min(1,"Requires a value").refine(e=>e.startsWith("/"),'Path must start with a "/"').refine(e=>{try{return new URL(e,"https://example.com"),!0}catch{return!1}},"Path must be a valid URL path"),c=t.z.string().min(1,"Requires a value").refine(e=>/^\d+$/.test(e))},7773878,e=>{"use strict";e.s(["keyExistsOperator",()=>g,"stringMatchOperators",()=>h,"stringOperators",()=>p,"withIdOperator",()=>a]);var t=e.i(1091572);let a={value:"eq",label:"with rate limit ID"},l={value:"sub",label:"Contains",schema:t.stringSchema},i={value:"!sub",label:"Does not contain",schema:t.stringSchema},r={value:"pre",label:"Starts with",schema:t.stringSchema},n={value:"!pre",label:"Does not start with",schema:t.stringSchema},s={value:"suf",label:"Ends with",schema:t.stringSchema},o={value:"!suf",label:"Does not end with",schema:t.stringSchema},c={value:"re",label:"Matches expression",schema:t.regexSchema},d={value:"!re",label:"Does not match expression",schema:t.regexSchema},u={value:"ex",label:"Exists",schema:t.optionalString},m={value:"!ex",label:"Does not exist",schema:t.optionalString},p=[{value:"eq",label:"Equals"},{value:"!eq",label:"Does not equal"},{value:"inc",label:"Is any of"},{value:"!inc",label:"Is not any of"}],h=[l,i,r,n,s,o,c,d],g=[u,m]},2627313,e=>{"use strict";e.s(["FilterItemStateProvider",()=>r,"useItemStateContext",()=>i]);var t=e.i(751170),a=e.i(4099374);let l=(0,a.createContext)(null);function i(){let e=(0,a.useContext)(l);if(null===e)throw Error("Filter context should be wrapped in Provider");return e}function r(e){let{children:i,state:r,index:n,moduleConfig:s,groupId:o}=e,c=(0,a.useMemo)(()=>({state:r,moduleConfig:s,index:n,groupId:o}),[r,s,n,o]);return(0,t.jsx)(l.Provider,{value:c,children:i})}l.displayName="ItemStateContextProvider"},467779,1900286,e=>{"use strict";e.s(["FilterProvider",()=>s,"useFilterContext",()=>n],467779);var t=e.i(751170),a=e.i(4099374),l=e.i(8901011),i=e.i(9544652);let r=(0,a.createContext)(null);function n(){let e=(0,a.useContext)(r);if(null===e)throw Error("Filter context should be wrapped in Provider");return(0,l.useStore)(e)}function s(e){let{children:a,disabled:l,store:n}=e;return(0,t.jsx)(r.Provider,{value:n,children:(0,t.jsx)(i.DisabledContext.Provider,{value:!!l,children:a})})}r.displayName="FilterContextProvider",s.displayName="FilterProvider",e.s(["getDefaultState",()=>m,"getFieldModule",()=>u,"isExistsOperator",()=>d,"isMultiOperator",()=>c,"isZodError",()=>p,"mapZodErrorToValue",()=>h,"parseErrorSchema",()=>g],1900286);var o=e.i(364533);function c(e){return["inc","!inc","ninc"].includes(e)}function d(e){return["ex","!ex","nex"].includes(e)}function u(e,t){return e.moduleMap.get(t)}function m(e){let t=Array.from(Object.keys(e)),a=new Map(Object.entries(e)),l=t[0],i=a.get(l);return i?{defaultState:[{id:(0,o.v4)(),filters:[{filterId:l,value:i.allowMultiSelect||c(i.allowedOperators[0].value)?[]:"",operator:i.allowedOperators[0].value,fieldId:(0,o.v4)(),...i.allowKey?{key:""}:{}}]}],moduleKeys:t,moduleMap:a}:{moduleKeys:t,moduleMap:a}}let p=e=>Array.isArray(e?.errors);function h(e,t){let a=[];for(;e.length;){let{path:l,message:i}=e[0];if(Array.isArray(t)){let e=t[Number(l[0])];a.push({value:e,error:i})}else a.push({value:t,error:i});e.shift()}return a}let g=e=>{let t={};for(;e.length;){let a=e[0],{code:l,message:i,path:r}=a,n=r.join(".");if(!t[n])if("unionErrors"in a){let e=a.unionErrors[0].errors[0];t[n]={message:e.message,type:e.code}}else t[n]={message:i,type:l};"unionErrors"in a&&a.unionErrors.forEach(t=>t.errors.forEach(t=>e.push(t))),e.shift()}return t}},3957279,e=>{"use strict";e.s(["FilterSelectComponent",()=>h]);var t=e.i(751170),a=e.i(9689002),l=e.i(1344973),i=e.i(3869281),r=e.i(5499338),n=e.i(5265628),s=e.i(3929288),o=e.i(9550268),c=e.i(5883567),d=e.i(4099374),u=e.i(9722978);let m={values:[],valueSet:new Set,initialSet:new Set,options:[]};function p(e,t){switch(t.type){case"INITIALIZE":return{...e,...t.payload};case"TOGGLE_VALUE":{let{item:a,allowMulti:l}=t.payload,i=new Set(e.valueSet);if(i.has(a.value))return i.delete(a.value),{...e,values:e.values.filter(e=>e.value!==a.value),valueSet:i,initialSet:l?e.initialSet:new Set([])};return i.add(a.value),{...e,values:l?[...e.values,a]:[a],valueSet:l?i:new Set([a.value]),initialSet:l?e.initialSet:new Set}}case"ADD_NEW":{let a=new Set(e.valueSet),l=new Set(e.initialSet),i=Array.isArray(t.payload.item)?t.payload.item.map(e=>({value:e,label:`"${e}"`})):[{value:t.payload.item,label:`"${t.payload.item}"`}];return i.forEach(e=>{l.add(e.value),a.add(e.value)}),{...e,values:t.payload.allowMulti?[...e.values,...i]:i,valueSet:t.payload.allowMulti?a:new Set(i.map(e=>e.value)),initialSet:t.payload.allowMulti?l:new Set(i.map(e=>e.value))}}case"CLOSE_SELECT":{let t=new Set(e.values.map(e=>e.value));return{...e,initialSet:t}}default:return e}}function h(e){let{errors:c,initialValue:h,allowAdd:x,allowMulti:f=!1,filterName:y,disabled:v,onChange:b,getOptions:w,labels:j,placeholder:C,updateOnChange:S}=e,[_,I]=(0,d.useReducer)(p,m),[N,A]=(0,d.useState)(!1),[k,L]=(0,d.useState)(""),T=(0,d.useRef)(null);(0,d.useEffect)(()=>{(async()=>{let e=Array.isArray(h)?h:[h],t=new Set(e.map(e=>`${e}`)),a=new Set(t),l=[],i=[];if(void 0===w)l=e.map(e=>({value:`${e}`,label:`"${e}"`}));else{if(i=await w(),x)for(let t of e.filter(Boolean))i.some(e=>e.value===`${t}`)||i.push({value:`${t}`,label:j?.[t]||`"${t}"`});l=i.filter(e=>t.has(e.value))}I({type:"INITIALIZE",payload:{values:l,valueSet:t,initialSet:a,options:i}})})()},[h,x,f,y,w,c,j]);let E=(0,d.useMemo)(()=>c?new Set(c.map(e=>e.value)):new Set,[c]),O=(0,d.useMemo)(()=>_.values.filter(e=>_.valueSet.has(e.value)),[_.values,_.valueSet]),R=_.values.filter(e=>_.initialSet.has(e.value)),P=(0,d.useCallback)(e=>{I({type:"TOGGLE_VALUE",payload:e})},[]),D=(0,d.useMemo)(()=>Array.from(new Set([..._.options,..._.values])),[_.options,_.values]),z=(0,d.useCallback)(e=>{b?.(e)},[b]);(0,d.useEffect)(()=>{S&&z([..._.valueSet])},[_.valueSet,z,S]);let M=D.filter(e=>_.initialSet.has(e.value)),B=_.options.filter(e=>!_.initialSet.has(e.value));return(0,t.jsxs)(n.Root,{onOpenChange:e=>{e||(I({type:"CLOSE_SELECT"}),L(""),b?.([..._.valueSet])),A(e)},open:N,children:[(0,t.jsx)(n.Anchor,{className:"flex w-full items-center",children:(0,t.jsx)(n.Trigger,{className:(0,u.clsx)("my-0 size-full min-h-[32px] items-center rounded border-gray-alpha-400 bg-background-100 px-3 py-0 outline outline-1 outline-gray-alpha-400 data-[state=open]:bg-gray-100 data-[state=open]:shadow-focus-border focus-visible:shadow-focus-ring disabled:border-gray-400 disabled:bg-gray-100 disabled:text-gray-700",{"data-[state=open]:shadow-focus-border data-[state=open]:border-gray-alpha-400 shadow-[0_0_0_1px_var(--ds-red-900),0_0_0_4px_var(--ds-red-300)]":c}),disabled:v,children:(0,t.jsxs)("div",{className:"flex h-full items-center gap-x-2",children:[(0,t.jsx)("span",{children:(0,t.jsx)(o.ListUnordered,{size:16})}),(0,t.jsx)("div",{className:"grid",children:(0,t.jsxs)(l.Text,{"aria-disabled":v,className:"text-inherit",size:14,truncate:!0,children:[f&&O.length>0?(0,t.jsx)("span",{className:"text-sm text-gray-900",children:`${O.length} ${1===O.length?y:function(e){for(let[t,a]of[[/ss$/,"sses"],[/s$/,"s"],[/s$/,"es"],[/(?![aeiou])y$/,"ies"]])if(t.test(e))return e.replace(t,a);return`${e}s`}(y)}: `}):null,O.length>0?O.map((e,a)=>E.has(e.value)?(0,t.jsxs)("span",{className:"text-red-900",children:[e.label.replaceAll('"',""),`${a<O.length-1?", ":""}`]},e.value):`${e.label.replaceAll('"',"")}${a<O.length-1?", ":""}`):(0,t.jsx)("span",{className:"text-gray-700",children:`Add option${f?"s":""}`})]})})]})})}),(0,t.jsx)(n.Portal,{children:(0,t.jsx)(n.Content,{className:"tailwind-preflight",side:"bottom",sideOffset:8,children:(0,t.jsxs)(s.Command,{className:"w-[var(--radix-popover-trigger-width)] justify-between rounded-lg border-gray-alpha-400 bg-background-100 shadow-menu",children:[(0,t.jsxs)("div",{className:(0,u.clsx)("-mb-px flex w-full items-center justify-between px-4 py-3",(R.length>0||k||_.options.length>0)&&"border-b"),children:[(0,t.jsx)(s.Command.Input,{className:"w-full border-none bg-transparent text-sm outline-none",onPaste:e=>{if(!x)return;e.preventDefault();let t=e.clipboardData.getData("text").split("\n").map(e=>e.trim());f?I({type:"ADD_NEW",payload:{item:t,allowMulti:f}}):I({type:"ADD_NEW",payload:{item:t[0],allowMulti:f}})},onValueChange:L,placeholder:C&&C.length>0?C:"Search...",ref:T,value:k}),(0,t.jsx)(a.Kbd,{small:!0,children:"Esc"})]}),(0,t.jsxs)(s.Command.List,{className:"flex max-h-[288px] flex-col gap-y-5 overflow-y-auto border-gray-alpha-400",children:[R.length>0?(0,t.jsx)(s.Command.Group,{className:"p-2",children:M.map(e=>(0,t.jsx)(s.Command.Item,{className:"w-full rounded *:aria-selected:bg-gray-100 data-[selected=true]:bg-gray-100 hover:bg-gray-100 focus-visible:bg-gray-100 active:bg-gray-100",onSelect:()=>P({item:e,allowMulti:f}),value:`${e.label}-${e.value}`,children:(0,t.jsxs)("div",{className:"flex w-full gap-2 rounded p-2",children:[(0,t.jsx)(i.Checkbox,{checked:_.valueSet.has(e.value),className:"pointer-events-none gap-1 text-sm",onChange:()=>{},tabIndex:-1,children:e.label}),E.has(e.value)?(0,t.jsx)(r.Badge,{size:"sm",variant:"red-subtle",children:"Invalid Option"}):null]})},e.value))}):null,B.length>0?(0,t.jsx)(s.Command.Group,{className:(0,u.clsx)("p-2",B.length&&"border-t"),children:B.map(e=>(0,t.jsx)(s.Command.Item,{className:"w-full rounded *:aria-selected:bg-gray-100 data-[selected=true]:bg-gray-100 hover:bg-gray-100 focus:bg-gray-100 active:bg-gray-100",onSelect:()=>P({item:e,allowMulti:f}),value:`${e.label}-${e.value}`,children:(0,t.jsx)("div",{className:"w-full rounded p-2",children:(0,t.jsx)(i.Checkbox,{checked:_.valueSet.has(e.value),className:"pointer-events-none gap-1 text-sm",onChange:()=>{},tabIndex:-1,children:e.label})})},`${e.value}-${e.label}`))}):[],(0,t.jsx)(s.Command.Group,{children:x?(0,t.jsx)(g,{onAddNew:e=>{I({type:"ADD_NEW",payload:{item:e,allowMulti:f}}),T.current?.focus(),L("")},search:k}):null}),k.length?(0,t.jsx)(s.Command.Empty,{className:"px-4 py-3 text-sm text-gray-900",children:`No results match "${k}"`}):null]})]})})})]})}function g(e){let{search:a,onAddNew:i}=e;return 0===a.length?null:(0,t.jsx)("div",{className:"p-2",children:(0,t.jsx)(s.Command.Item,{"aria-label":`add ${a}`,className:"w-full rounded *:aria-selected:bg-gray-100 data-[selected=true]:bg-gray-100 hover:bg-gray-100 focus:bg-gray-100 active:bg-gray-100",onSelect:()=>i(a),children:(0,t.jsxs)("div",{className:"flex items-center  gap-x-2 rounded p-2 text-gray-900",children:[(0,t.jsx)(c.PlusCircle,{size:14}),(0,t.jsx)(l.Text,{className:"text-gray-900",size:14,children:`Add "${a}"`})]})})})}},1059588,e=>{"use strict";e.s(["isApiControlledRateLimit",()=>s,"useRuleBuilderState",()=>d]);var t=e.i(4099374);e.i(3512434);var a=e.i(9835407),l=e.i(6461317),i=e.i(1900286),r=e.i(1091572);let n={algo:"fixed_window",window:"60",limit:"100",keys:["ip"]};function s(e){return e.rateLimit.keys.includes("header:x-vercel-rate-limit-key")}function o(e,t){switch(t.type){case"INITIALIZE":case"INITIALIZE_TEAM_PLAN":return{...e,...t.payload};case"UPDATE_FILTER":{if(t.payload.some(e=>"rate_limit_api_id"===e.filterId))return{...e,rateLimit:{...e.rateLimit,keys:["header:x-vercel-rate-limit-key"]},type:"rate_limit",action:"rate_limit"};let a=e.rateLimit.keys.filter(e=>"header:x-vercel-rate-limit-key"!==e);if(0===a.length&&a.push("ip"),!e.wasActionSet)return{...e,type:"default",action:"log",rateLimit:{...e.rateLimit,keys:a}};return{...e,rateLimit:{...e.rateLimit,keys:a}}}case"UPDATE_ACTION":if("rate_limit"!==e.type&&"rate_limit"===t.payload.action)return{...e,action:t.payload.action,type:"rate_limit",showRateLimitModal:!1,wasActionSet:!0};return{...e,action:t.payload.action,wasActionSet:!0};case"UPDATE_NAME":return{...e,name:t.payload.name};case"UPDATE_DESCRIPTION":return{...e,description:t.payload.description};case"UPDATE_RATE_LIMIT":return{...e,rateLimit:t.payload.rateLimit};case"REMOVE_RATE_LIMIT":return{...e,type:"default",action:"rate_limit"!==e.action?e.action:"log"};case"UPDATE_REDIRECT":return{...e,redirectTo:t.payload.redirectTo};case"UPDATE_ACTION_DURACTION":return{...e,actionDuration:t.payload.actionDuration};case"VALIDATE":try{let t=u.parse(e);return{...e,...t,errors:{},isSubmitted:!0}}catch(a){if((0,i.isZodError)(a)){let r=(0,i.parseErrorSchema)(a.errors),n=t.payload?.fieldName;if(n){let t=(0,l.default)(r,n);return{...e,errors:{...e.errors||{},[n]:t}}}return{...e,errors:r,isSubmitted:!0}}}return e;default:return e}}let c={type:"default",action:"log",actionDuration:null,showRateLimitModal:!0,showUpgradeModal:!1,name:"",description:"",rateLimit:n,isSubmitted:!1,wasActionSet:!1};function d(e){let{selectedRule:a,teamPlan:l,showRateLimitModal:i,showUpgradeModal:r}=e,[s,d]=(0,t.useReducer)(o,{...c,showRateLimitModal:i,showUpgradeModal:r});(0,t.useEffect)(()=>{if(l&&!a)return void d({type:"INITIALIZE_TEAM_PLAN",payload:{teamPlan:l,showRateLimitModal:i}});if(!a)return;let e=a.action?.mitigate?.rateLimit,t=a.action?.mitigate?.action==="rate_limit"?a.action.mitigate.rateLimit?.action||"log":a.action?.mitigate?.action||"log";d({type:"INITIALIZE",payload:{teamPlan:l,showRateLimitModal:i,showUpgradeModal:r,type:a.action?.mitigate?.action==="rate_limit"?"rate_limit":"default",action:t,name:a.name,description:a.description||"",redirectTo:a.action?.mitigate?.redirect?.location,rateLimit:e?{algo:e.algo,limit:`${e.limit}`,window:`${e.window}`,keys:e.keys}:n,isSubmitted:!1,actionDuration:a.action?.mitigate?.actionDuration||null,wasActionSet:!0}})},[a,d,l,i,r]);let m=(0,t.useCallback)(()=>{try{return d({type:"VALIDATE"}),u.parse(s)}catch(e){return null}},[s]);return[s,d,m]}let u=a.z.object({teamPlan:a.z.enum(["pro","enterprise","hobby"]).optional(),type:a.z.enum(["rate_limit","default"]),action:a.z.enum(["challenge","deny","log","bypass","rate_limit","redirect"]),name:a.z.string().min(1,"Name is required"),description:a.z.string().optional(),rateLimit:a.z.object({algo:a.z.enum(["fixed_window","token_bucket"]),window:a.z.coerce.number().min(10),limit:a.z.coerce.number().min(1).max(1e7),keys:a.z.array(a.z.string().superRefine((e,t)=>{!["ip","ja4"].includes(e)&&(e.startsWith("header:")||t.addIssue({code:a.z.ZodIssueCode.custom,message:"Key must start with header:"}))}))}).passthrough().optional(),redirectTo:a.z.union([a.z.string().url(),r.pathSchema]).optional()}).passthrough().superRefine((e,t)=>{if("rate_limit"===e.type){let l="enterprise"===e.teamPlan?3600:600;e.rateLimit?e.rateLimit.window>l&&t.addIssue({code:a.z.ZodIssueCode.too_big,inclusive:!0,maximum:l,message:`Window must not exceed ${l} seconds`,path:["rateLimit","window"],type:"number"}):t.addIssue({code:a.z.ZodIssueCode.custom,message:"Rate limit is required",path:["rateLimit"]})}"redirect"!==e.action||e.redirectTo||t.addIssue({code:a.z.ZodIssueCode.custom,message:"Redirect to is required",path:["redirectTo"]})})},2388086,6758330,e=>{"use strict";e.s(["BaseComponent",()=>V,"FilterBuilder",()=>H],2388086);var t=e.i(751170),a=e.i(9592842),l=e.i(9722978),i=e.i(9508212),r=e.i(1344973),n=e.i(5499338),s=e.i(2504781),o=e.i(3500331),c=e.i(8674454),d=e.i(4991687),u=e.i(8459493),m=e.i(5326905),p=e.i(5257834),h=e.i(6694387),g=e.i(5468328),x=e.i(455575),f=e.i(5232300),y=e.i(2713868),v=e.i(6881349),b=e.i(923772),w=e.i(109803),j=e.i(7749365),C=e.i(6318858),S=e.i(2560270),_=e.i(4099374),I=e.i(588428),N=e.i(9544652),A=e.i(2627313),k=e.i(467779),L=e.i(1900286),T=e.i(3957279);e.i(6483798);var E=e.i(8287059),O=e.i(8353464),R=e.i(9507427),P=e.i(1059588);e.s(["RateLimitModal",()=>z],6758330);var D=e.i(6891161);function z(e){let{isLoading:a,open:l,onClose:i,onConfirm:r}=e;return(0,t.jsxs)(D.Modal.Modal,{active:l,onClickOutside:i,children:[(0,t.jsxs)(D.Modal.Body,{className:"tailwind-preflight",children:[(0,t.jsx)(D.Modal.Header,{children:(0,t.jsx)(D.Modal.Title,{children:"Rate Limit Pricing"})}),(0,t.jsx)(D.Modal.P,{children:"Rate limiting is enforced at the network edge, adding less than 1ms of latency to requests. Only allowed requests are charged. Blocked requests based on your rule are free."}),(0,t.jsxs)("div",{className:"flex flex-col text-gray-900 divide-y",children:[(0,t.jsxs)("div",{className:"flex flex-row items-center justify-between py-2",children:[(0,t.jsx)("p",{children:"Allowed Request"}),(0,t.jsx)("p",{children:"$0.50 per 1M"})]}),(0,t.jsxs)("div",{className:"flex flex-row items-center justify-between py-2",children:[(0,t.jsx)("p",{children:"Blocked Requests"}),(0,t.jsx)("p",{children:"Free"})]})]})]}),(0,t.jsxs)(D.Modal.Actions,{children:[(0,t.jsx)(D.Modal.Action,{onClick:i,type:"secondary",children:"Cancel"}),(0,t.jsx)(D.Modal.Action,{loading:a,onClick:r,children:"Continue"})]})]})}var M=e.i(9386557);function B(e){let{className:a,disabled:i,error:r,id:n,onChange:s,value:o,...c}=e,[d,u]=(0,_.useState)(o?.toString()??""),m=(0,_.useRef)(null),p=(0,_.useRef)(null),h=(0,_.useCallback)(()=>{let{current:e}=p,{current:t}=m,a=getComputedStyle(document.documentElement).getPropertyValue("--geist-form-small-height");e&&t&&(e.style.height=a||"40px",e.style.height=`${e.scrollHeight}px`,t.style.height=e.style.height)},[m,p]);(function(e,t){let a=(0,_.useRef)(null);(0,_.useEffect)(()=>{let l=e.current;if(l&&"undefined"!=typeof ResizeObserver)return a.current=new ResizeObserver(t),a.current.observe(l),()=>{a.current?.disconnect()}},[t,e])})(p,h),(0,_.useEffect)(h,[d]);let x=(0,_.useMemo)(()=>{let e=d.startsWith(" "),t=d.endsWith(" ");return e&&t?"This value starts and ends with whitespace.":e?"This value starts with whitespace.":t?"This value ends with whitespace.":null},[d]),f=(0,_.useMemo)(()=>d.split(/( )/).filter(Boolean),[d]),y=(0,_.useMemo)(()=>i?"cursor-not-allowed text-gray-700 bg-gray-100 shadow-[0_0_0_1px_var(--ds-gray-400),_0_0_0_1px_var(--ds-background-200)]":r?"shadow-[0_0_0_1px_var(--ds-red-900),0_0_0_4px_var(--ds-red-300)] hover:shadow-[0_0_0_1px_var(--ds-red-900),0_0_0_4px_var(--ds-red-500)] focus-within:!shadow-[0_0_0_1px_var(--ds-red-900),0_0_0_4px_var(--ds-red-300)]":"shadow-[0_0_0_1px_var(--border-color,var(--ds-gray-alpha-400))] hover:shadow-[0_0_0_1px_var(--ds-gray-alpha-500)] focus-within:!shadow-[0_0_0_1px_var(--ds-gray-alpha-600),0px_0px_0px_4px_#00000029]",[r,i]);return(0,t.jsxs)("div",{className:(0,l.clsx)(`
      w-full grid grid-cols-1 grid-rows-1 items-center rounded px-2 transition-shadow
      *:text-sm *:font-mono relative *:p-0 *:py-2 *:rounded *:leading-none *:tracking-normal *:col-span-full *:row-span-full
      `,{[y]:!0,[a??""]:!!a}),id:n,children:[(0,t.jsx)("textarea",{ref:p,className:"text-transparent caret-foreground resize-none overflow-hidden outline-none z-10 bg-transparent",value:d,onChange:e=>{u(e.target.value),s?.(e)},disabled:i,...c,spellCheck:"false",autoComplete:"off"}),(0,t.jsx)("p",{ref:m,className:"text-foreground pointer-events-none wrap-break-word whitespace-pre-wrap",children:f.map((e,a)=>" "!==e?(0,t.jsx)("span",{children:e}):(0,t.jsx)("span",{className:(0,l.clsx)("relative after:content-['âŽµ'] after:absolute after:-left-[1px] after:top-1.5 after:text-[0.8rem]  text-gray-900",{"text-geist-warning bg-amber-100":0===a||a===f.length-1}),children:" "}))}),(0,t.jsx)("div",{className:(0,l.clsx)("absolute right-0 bottom-0 translate-y-1.5 translate-x-0.5 z-10 transition-opacity duration-75",x?"pointer-events-auto opacity-1":"opacity-0 pointer-events-none"),children:(0,t.jsx)(g.Tooltip,{position:"top",text:x,children:(0,t.jsx)(M.WarningFill,{color:"amber-600"})})})]})}function $(){let e=(0,k.useFilterContext)(),{state:a,moduleConfig:l}=(0,A.useItemStateContext)(),r=(0,N.useDisabled)(),n=l.allowedOperators.find(e=>e.value===a.operator)?.label;return(0,t.jsx)(i.Stack,{className:"w-full lg:max-w-[175px]",children:l.allowedOperators.length>1?(0,t.jsxs)(d.MenuContainer,{position:"bottom-start",children:[(0,t.jsx)(h.MenuButton,{align:"flex-grow","aria-label":`Operator ${n||""}`,disabled:r,size:"small",suffix:(0,t.jsx)(S.ChevronDown,{}),type:"secondary",width:"100%",children:(0,t.jsx)(i.Stack,{align:"center",className:"w-full",direction:"row",flex:1,children:(0,t.jsx)("span",{children:n??""})})}),(0,t.jsx)(c.Menu,{className:"w-full overflow-y-auto lg:min-w-[200px]",portalClassName:"tailwind-preflight",useNewListHeightBehavior:{maxHeight:240,numberOfChildren:l.allowedOperators.length},children:l.allowedOperators.map(l=>(0,t.jsx)(u.MenuItem,{onClick:()=>{e.updateCondition(a.fieldId,{type:"operator",value:l.value})},value:l.value,children:(0,t.jsxs)(i.Stack,{align:"center",direction:"row",flex:1,gap:3,justify:"space-between",children:[(0,t.jsx)(i.Stack,{align:"center",direction:"row",flex:1,children:(0,t.jsx)("span",{children:l.label})}),l.value===a.operator?(0,t.jsx)(C.Check,{}):null]})},l.value))})]}):(0,t.jsx)(h.MenuButton,{align:"flex-grow","aria-label":`Operator ${n||""}`,disabled:!0,size:"small",type:"secondary",width:"100%",children:(0,t.jsx)(i.Stack,{align:"center",className:"w-full",direction:"row",flex:1,children:(0,t.jsx)("span",{children:n??""})})})})}function U(){let e=(0,k.useFilterContext)(),{state:a,moduleConfig:l}=(0,A.useItemStateContext)(),i=(0,N.useDisabled)(),r=!!l.resolveValues,n=(0,L.isMultiOperator)(a.operator),s=(0,L.isExistsOperator)(a.operator),o=l.placeholder?.value||"";"re"===a.operator&&(o="Type a regular expression..");let c=e.allErrors[`${a.fieldId}-value`];if(r||n)return(0,t.jsx)(T.FilterSelectComponent,{allowAdd:l.allowCustomValue||n&&!r||!1,allowMulti:n,disabled:i,errors:c,filterName:l.title,getOptions:l.resolveValues,initialValue:a.value,onChange:t=>{n?e.updateCondition(a.fieldId,{type:"value",value:t}):e.updateCondition(a.fieldId,{type:"value",value:t[0]})},placeholder:o});let d=Array.isArray(a.value)?`${a.value.length>0?a.value[0]:""}`:`${a.value}`;return(0,t.jsx)(B,{className:"w-full",disabled:!!s||i,error:c?"errors":null,id:a.fieldId,name:`${a.filterId}-${a.fieldId}`,onChange:t=>e.updateCondition(a.fieldId,{type:"value",value:t.target.value}),placeholder:s?"Any value":o,value:s?"":d})}function H(e){let{initialState:a,onChange:i,teamPlan:r}=e,n=(0,N.useDisabled)(),s=(0,k.useFilterContext)(),o=s.state;return(0,t.jsxs)("div",{className:"mt-2 min-h-[320px] w-full rounded border border-gray-alpha-400 bg-background-200 p-10",children:[o.map((e,a,i)=>(0,t.jsxs)(_.Fragment,{children:[e.filters.map((a,i,r)=>(0,t.jsx)("div",{className:(0,l.clsx)("flex flex-col gap-2 lg:flex-row lg:items-center",{"mb-2":i!==r.length-1}),children:(0,t.jsx)(W,{groupId:e.id,index:i,state:a})},a.fieldId)),a!==i.length-1?(0,t.jsxs)("div",{className:"relative flex w-full items-center justify-center",children:[(0,t.jsx)("div",{className:"h-[80px] w-px bg-gray-400"}),(0,t.jsx)(y.SplitButton,{buttonProps:{disabled:!0,size:"small",type:"secondary"},className:"absolute",menuButtonLabel:"Add a condition or condition group",menuItems:(0,t.jsx)(y.SplitButtonMenuItem,{description:"Add a condition",menuItemProps:{disabled:n,onClick:()=>s.addCondition(a)},title:"AND"}),menuProps:{width:230},children:"OR"})]}):null]},`group-${e.id}`)),(0,t.jsx)(et,{isButton:!0}),"rate_limit"===a.type?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(J,{initialState:a,onChange:i,teamPlan:r}),(0,t.jsx)(et,{})]}):null,(0,t.jsx)(Z,{initialState:a,onChange:i,teamPlan:r})]})}function F(){let e=(0,k.useFilterContext)(),{state:a,moduleConfig:l}=(0,A.useItemStateContext)(),i=l.placeholder?.key||"",r=e.allErrors[`${a.fieldId}-key`],n=(0,N.useDisabled)();return(0,t.jsx)(t.Fragment,{children:l.allowKey?(0,t.jsx)("div",{className:"w-full lg:max-w-[175px]",children:(0,t.jsx)(o.Input,{className:"w-full",disabled:n,error:r?"error":void 0,id:a.fieldId,name:`${a.filterId}-${a.fieldId}-key`,onChange:t=>e.updateCondition(a.fieldId,{type:"key",value:t.target.value}),placeholder:i,showErrorMessage:!1,size:"small",value:a.key,width:"100%"})}):null})}function q(){let e=(0,k.useFilterContext)(),{state:l,moduleConfig:r}=(0,A.useItemStateContext)(),n=(0,N.useDisabled)(),s=(0,_.useMemo)(()=>e.moduleKeys.map(t=>{let a=(0,L.getFieldModule)(e,t);return{label:a.title,value:t,icon:a.icon,deprecated:a.deprecated}}),[e]);return(0,t.jsxs)(i.Stack,{className:"w-full tailwind-preflight",children:[(0,t.jsx)(a.default,{id:"4f438cb26d60b0d9",children:".firewall-components-module-configuration-components-module-select-component [class*=combobox-module]>button{min-height:var(--geist-form-small-height,32px)!important;max-height:var(--geist-form-small-height,32px)!important;height:var(--geist-form-small-height,32px)!important}"}),(0,t.jsxs)(v.Combobox,{"aria-label":`rule type ${r.title}`,disabled:n,noRawSelectedValue:!0,onChange:t=>{t&&e.updateCondition(l.fieldId,{type:"filter",value:t})},placeholder:"Select attribute...",prefixIcon:r.icon,size:"small",value:l.filterId,width:"100%",className:"firewall-components-module-configuration-components-module-select-component",children:[(0,t.jsx)(v.Combobox.Input,{}),(0,t.jsx)(v.Combobox.List,{children:s.filter(e=>!e.deprecated?.(l.filterId)).map(e=>{let{value:a,label:l,icon:r}=e;return(0,t.jsx)(v.Combobox.Option,{label:l,value:a,children:(0,t.jsxs)(i.Stack,{align:"center",direction:"row",gap:2,children:[r?(0,t.jsx)("span",{className:"jsx-4f438cb26d60b0d9",children:r}):null,(0,t.jsx)("span",{className:"jsx-4f438cb26d60b0d9",children:l})]})},a)})})]})]})}function V(){let e=(0,k.useFilterContext)(),{state:a,index:l,groupId:i}=(0,A.useItemStateContext)(),n=(0,N.useDisabled)(),o=e.state.find(e=>e.id===i),c=e.state.length>1||(o?.filters??[]).length>1,d={"aria-label":"remove rule",children:(0,t.jsx)(b.Trash,{size:16}),disabled:n,onClick:()=>{o?.filters.length===1?e.deleteConditionGroup(i):e.deleteCondition(a.fieldId)},shape:"square",size:"small",svgOnly:!0,type:"error"};return(0,t.jsxs)("div",{className:"min-h-[80px] w-full rounded-md border bg-white p-6 flex flex-col lg:flex-row gap-3 items-start",children:[(0,t.jsxs)("div",{className:"flex gap-3 items-center w-full lg:max-w-[200px]",children:[(0,t.jsx)(r.Text,{className:"text-left capitalize",children:0===l?"if":"and"}),(0,t.jsx)(q,{}),c?(0,t.jsx)(s.Button,{...d,className:"lg:hidden min-w-[30px] max-h-[30px]"}):null]}),(0,t.jsx)(F,{}),(0,t.jsx)($,{}),(0,t.jsx)(U,{}),c?(0,t.jsx)(s.Button,{...d,className:"hidden lg:block min-w-[30px] max-h-[30px]"}):null]})}function W(e){let{index:a,state:l,groupId:i}=e,r=(0,k.useFilterContext)(),n=(0,L.getFieldModule)(r,l.filterId);return n?(0,t.jsx)(A.FilterItemStateProvider,{groupId:i,index:a,moduleConfig:n,state:l,children:(0,t.jsx)(n.Component,{})}):null}function Z(e){let{initialState:a,onChange:n,teamPlan:s}=e,m=(0,N.useDisabled)(),p=(0,I.useFirewallRateLimitTeamFlag)(),g=(0,E.useOpenUpgradeModal)(),[f,y]=(0,_.useState)(!1),v=(0,x.useToasts)(),[b,w]=(0,_.useState)(!1),j=(0,_.useMemo)(()=>(0,R.allowedFirewallActions)(!0,"rate_limit"===a.type),[a.type]),A=j.find(e=>e.value===a.action)?.label;return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(i.Stack,{align:{sm:"start",md:"start",lg:"center"},className:"h-fit grow rounded-md border bg-white p-6 lg:h-[80px]",direction:{sm:"column",md:"column",lg:"row"},gap:3,children:[(0,t.jsxs)("div",{className:"flex w-full flex-1 flex-row items-center gap-x-3",children:[(0,t.jsx)(r.Text,{className:"capitalize",children:"then"}),(0,t.jsx)("div",{className:"w-full",children:(0,t.jsxs)(d.MenuContainer,{position:"bottom-start",children:[(0,t.jsx)(h.MenuButton,{align:"flex-grow","aria-label":`Action to take based on created rules ${A||""}`,disabled:m,size:"small",suffix:(0,t.jsx)(S.ChevronDown,{}),type:"secondary",width:"100%",children:(0,t.jsx)(i.Stack,{align:"center",className:"w-full",direction:"row",flex:1,children:(0,t.jsx)("span",{children:A||""})})}),(0,t.jsx)(c.Menu,{className:"w-full min-w-[300px] lg:min-w-[400px]",portalClassName:"tailwind-preflight",children:j.map(e=>{let{value:r,label:o,subtext:c,badge:d}=e;return(0,t.jsxs)(u.MenuItem,{height:70,innerMenuItemClassName:(0,l.clsx)("min-h-[60px]"),onClick:()=>{"hobby"===s&&"rate_limit"===r&&a.showUpgradeModal?g({source:"firewall-rate-limit",forceExpandedReceipt:!0,onConversionSuccess:()=>{n({type:"UPDATE_ACTION",payload:{action:r}})}}):"rate_limit"!==a.type&&"rate_limit"===r&&a.showRateLimitModal&&!p.value?y(!0):n({type:"UPDATE_ACTION",payload:{action:r}})},value:r,children:[(0,t.jsx)(i.Stack,{align:"center",direction:"row",flex:1,gap:3,justify:"space-between",children:(0,t.jsx)("div",{className:"flex flex-col",children:(0,t.jsxs)("div",{className:"flex flex-col gap-y-1",children:[(0,t.jsxs)("div",{className:"flex items-center gap-x-2",children:[(0,t.jsx)("p",{className:"font-medium text-gray-1000",children:o}),d||null]}),(0,t.jsx)("p",{className:"text-[13px] font-normal text-gray-900",children:c})]})})}),r===a.action?(0,t.jsx)(C.Check,{}):null]},r)})})]})})]}),"hobby"!==s&&["deny","challenge","rate_limit"].includes(a.action)?(0,t.jsx)(K,{initialState:a,onChange:n}):null,"redirect"===a.action?(0,t.jsxs)("div",{className:"flex h-[80px] w-full flex-1 flex-row items-center gap-x-3",children:[(0,t.jsx)(r.Text,{className:"w-full max-w-[36px] lg:max-w-[12px]",children:"to"}),(0,t.jsx)(o.Input,{"aria-label":"redirect location",className:"w-full lg:min-w-[565px]",disabled:m,error:a.errors?.redirectTo?"error":void 0,onBlur:()=>n({type:"VALIDATE",payload:{fieldName:"redirectTo"}}),onChange:e=>n({type:"UPDATE_REDIRECT",payload:{redirectTo:e.target.value}}),placeholder:"https://",showErrorMessage:!1,size:"small",value:a.redirectTo||"",width:"100%"})]}):null]}),(0,t.jsx)(z,{isLoading:b,onClose:()=>y(!1),onConfirm:()=>{w(!0);try{n({type:"UPDATE_ACTION",payload:{action:"rate_limit"}})}catch(e){v.error(e.message)}finally{w(!1),y(!1)}},open:f})]})}function K(e){let{initialState:a,onChange:r}=e,n=(0,N.useDisabled)()||(0,P.isApiControlledRateLimit)(a),s=(0,_.useMemo)(()=>[{value:"1m",label:"1 minute"},{value:"5m",label:"5 minutes"},{value:"15m",label:"15 minutes"},{value:"30m",label:"30 minutes"},{value:"1h",label:"1 hour"}],[]),o=s.find(e=>e.value===a.actionDuration)?.label,p=null===a.actionDuration;return(0,t.jsxs)("div",{className:"flex w-full items-center gap-x-3 lg:w-fit",children:[p?null:(0,t.jsx)("p",{className:"w-full max-w-[36px] lg:max-w-4",children:"for"}),(0,t.jsx)("div",{className:"w-full lg:min-w-[190px] lg:max-w-[190px]",children:(0,t.jsxs)(d.MenuContainer,{position:"bottom-start",children:[(0,t.jsx)(G,{children:(0,t.jsx)(h.MenuButton,{align:"flex-grow","aria-label":"Timeframe for action",disabled:n,size:"small",suffix:p?null:(0,t.jsx)(S.ChevronDown,{}),type:"secondary",width:"100%",children:(0,t.jsx)(i.Stack,{align:"center",className:"w-full",direction:"row",flex:1,gap:2,justify:p?"center":void 0,children:p?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(j.Clock,{size:16}),(0,t.jsx)("span",{children:"Add Persistent Action"})]}):(0,t.jsx)("span",{className:"text-left",children:o})})})}),(0,t.jsxs)(c.Menu,{className:"w-full min-w-[180px] lg:min-w-[180px]",portalClassName:"tailwind-preflight",children:[s.map(e=>{let{value:n,label:s}=e;return(0,t.jsx)(u.MenuItem,{height:40,innerMenuItemClassName:(0,l.clsx)("min-h-[40px]"),onClick:()=>{r({type:"UPDATE_ACTION_DURACTION",payload:{actionDuration:n}})},value:n,children:(0,t.jsxs)(i.Stack,{align:"center",direction:"row",flex:1,gap:3,justify:"space-between",children:[(0,t.jsx)(i.Stack,{align:"center",children:s}),n===a.actionDuration?(0,t.jsx)(C.Check,{}):null]})},n)}),p?null:(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(m.MenuDivider,{}),(0,t.jsx)(u.MenuItem,{height:40,innerMenuItemClassName:(0,l.clsx)("mt-1 min-h-[40px] text-red-800"),onClick:()=>{r({type:"UPDATE_ACTION_DURACTION",payload:{actionDuration:null}})},value:"",children:"Remove Timeframe"})]})]})]})})]})}function G(e){let{children:a}=e,{state:{open:l}}=(0,f.useMenu)();return(0,t.jsx)(g.Tooltip,{className:"w-full",delay:!1,desktopOnly:!0,forceHide:l,position:"top",text:(0,t.jsxs)("p",{className:"flex h-full flex-col justify-start text-left",children:[(0,t.jsx)("span",{className:"text-left text-gray-900",children:"Optional"}),"Prevent further activity from a client device generating requests that match this rule for a specified time"]}),tooltipStyle:{padding:"0 8px"},children:a})}function J(e){let{initialState:a,onChange:l,teamPlan:n}=e,[c,d]=(0,_.useState)(a.rateLimit.algo),[u,m]=(0,_.useState)(`${a.rateLimit.window}`),[p,h]=(0,_.useState)(`${a.rateLimit.limit}`),[x,f]=(0,_.useState)([...a.rateLimit.keys]),y=(0,N.useDisabled)();(0,_.useEffect)(()=>{l({type:"UPDATE_RATE_LIMIT",payload:{rateLimit:{algo:c,window:u,limit:p,keys:x}}})},[c,x,p,l,u]);let[v,w]=(0,_.useMemo)(()=>"enterprise"===n?[10,3600]:[10,600],[n]);return(0,t.jsx)("div",{className:"flex w-full",children:(0,t.jsxs)(i.Stack,{align:"center",className:"w-full grow rounded-md border bg-white p-6 lg:h-[80px]",direction:{sm:"column",md:"column",lg:"row"},gap:3,children:[(0,t.jsx)("div",{className:"w-full lg:max-w-fit",children:(0,t.jsx)(r.Text,{className:"text-nowrap text-left",children:"Rate Limit"})}),(0,t.jsx)(i.Stack,{align:"flex-start",className:"w-full lg:max-w-[175px]",direction:"column",gap:1,children:(0,t.jsx)(Q,{initialAlgorithm:c,onChangeAlgorithm:d,teamPlan:n})}),(0,t.jsx)(i.Stack,{align:"flex-start",className:"w-full lg:max-w-[132px]",direction:"column",gap:1,children:(0,t.jsx)(g.Tooltip,{className:"w-full",delay:!1,desktopOnly:!0,position:"top",text:`Time window for rate limit in seconds (min: ${v}, max: ${w})`,children:(0,t.jsx)(o.Input,{"aria-label":`time window for rate limit in seconds (min: ${v}, max: ${w})`,className:"w-full",disabled:y,error:a.errors?.["rateLimit.window"]?"error":void 0,id:"rate-limit-window",name:"Window",onBlur:()=>l({type:"VALIDATE",payload:{fieldName:"rateLimit.window"}}),onChange:e=>{m(e.target.value)},showErrorMessage:!1,size:"small",suffix:"seconds",value:u.toString(),width:"100%"})})}),(0,t.jsx)(i.Stack,{align:"flex-start",className:"w-full lg:max-w-[132px]",direction:"column",gap:1,children:(0,t.jsx)(g.Tooltip,{className:"w-full",delay:!1,desktopOnly:!0,position:"top",text:`Request Limit
(min: 1, max: 10,000,000)`,children:(0,t.jsx)(o.Input,{"aria-label":"request rate limit",className:"w-full",disabled:y,error:a.errors?.["rateLimit.limit"]?"error":void 0,id:"rate-limit-limit",name:"Limit",onBlur:()=>l({type:"VALIDATE",payload:{fieldName:"rateLimit.limit"}}),onChange:e=>{h(e.target.value)},showErrorMessage:!1,size:"small",suffix:"requests",value:p.toString(),width:"100%"})})}),(0,t.jsx)(i.Stack,{align:"flex-start",className:"w-full",direction:"column",gap:1,children:(0,t.jsx)(g.Tooltip,{className:"w-full",delay:!1,desktopOnly:!0,position:"top",text:"Rate Limit By",children:(0,t.jsx)(ee,{apiControlled:(0,P.isApiControlledRateLimit)(a),initialKeys:a.rateLimit.keys,onChangeKeys:e=>{f(e)},readOnly:(0,P.isApiControlledRateLimit)(a)})})}),(0,t.jsx)(i.Stack,{children:(0,t.jsx)(s.Button,{"aria-label":"remove rule",className:"hidden min-w-[32px] lg:block",disabled:y||(0,P.isApiControlledRateLimit)(a),onClick:()=>l({type:"REMOVE_RATE_LIMIT"}),shape:"square",size:"small",svgOnly:!0,type:"error",children:(0,t.jsx)(b.Trash,{size:16})})})]})})}function Q(e){let{initialAlgorithm:a,onChangeAlgorithm:r,teamPlan:s}=e,[o,x]=(0,_.useState)(a||"fixed_window"),f=(0,N.useDisabled)();(0,_.useEffect)(()=>{r(o)},[r,o]);let y=(0,_.useMemo)(()=>[{value:"fixed_window",label:"Fixed Window",disabled:!1,badge:null,subtext:"Use when strict limits are necessary and bursts at the time boundaries are okay"},{value:"token_bucket",label:"Token Bucket",disabled:"enterprise"!==s,badge:"enterprise"!==s?(0,t.jsx)(n.Badge,{size:"sm",variant:"purple-subtle",children:"Enterprise Only"}):null,subtext:"Use when occasional bursts need to be accommodated without exceeding average rate limits"}],[s]),v=y.find(e=>e.value===o)?.label;return(0,t.jsxs)(d.MenuContainer,{position:"bottom-start",children:[(0,t.jsx)(g.Tooltip,{className:"w-full",delay:!1,desktopOnly:!0,position:"top",text:"Algorithm",children:(0,t.jsx)(h.MenuButton,{align:"flex-grow","aria-label":`Rate limit algorithm ${v||""}`,disabled:f,size:"small",suffix:(0,t.jsx)(S.ChevronDown,{}),type:"secondary",width:"100%",children:(0,t.jsx)(i.Stack,{align:"center",className:"w-full",direction:"row",flex:1,children:(0,t.jsx)("span",{children:v||""})})})}),(0,t.jsxs)(c.Menu,{className:"w-full lg:min-w-[400px]",portalClassName:"tailwind-preflight",children:[y.map(e=>{let{value:a,label:r,subtext:n,disabled:s,badge:c}=e;return(0,t.jsx)(u.MenuItem,{disabled:s,innerMenuItemClassName:(0,l.clsx)("min-h-[78px] aria-disabled:bg-gray-100 aria-disabled:opacity-60"),onClick:()=>{x(a)},value:a,children:(0,t.jsxs)(i.Stack,{align:"center",direction:"row",flex:1,gap:3,justify:"space-between",children:[(0,t.jsxs)(i.Stack,{direction:"column",flex:1,gap:1,children:[(0,t.jsxs)("div",{className:"flex items-center gap-x-1",children:[(0,t.jsx)("p",{className:"font-medium text-gray-1000",children:r}),c||null]}),(0,t.jsx)("p",{className:"text-[13px] font-normal text-gray-900",children:n})]}),o===a?(0,t.jsx)(C.Check,{}):null]})},a)}),(0,t.jsx)(m.MenuDivider,{}),(0,t.jsx)(p.MenuLink,{href:"/docs/security/vercel-waf",innerMenuItemClassName:"min-h-[40px]",children:(0,t.jsxs)(i.Stack,{align:"center",direction:"row",flex:1,justify:"space-between",children:[(0,t.jsx)("p",{className:"font-medium text-gray-1000",children:"Learn more about rate limits"}),(0,t.jsx)("span",{children:(0,t.jsx)(w.External,{size:16})})]})})]})]})}let X={"header:x-vercel-rate-limit-key":"API controlled"},Y=[{value:"ip",label:"IP Address"},{value:"ja4",label:"JA4 Digest"},{value:"header:user-agent",label:"User Agent"}];function ee(e){let{apiControlled:a,initialKeys:l,onChangeKeys:i,readOnly:r}=e,[n,s]=(0,_.useState)(l||["ip"]),[o,c]=(0,_.useState)(a);(0,_.useEffect)(()=>{a!==o&&(s(l||["ip"]),c(a))},[a,o,l]);let d=(0,N.useDisabled)()||r;return(0,_.useEffect)(()=>{i(n)},[i,n]),(0,t.jsx)(T.FilterSelectComponent,{allowAdd:!0,allowMulti:!0,disabled:d,filterName:"Keys",getOptions:()=>Y,initialValue:n,labels:X,onChange:e=>{let t=e.map(e=>e.trim().toLowerCase()).filter(O.isValidEdgeRateLimitKey);t.length||t.push("ip"),s(t)},placeholder:"Ex. header:authorization"})}function et(e){let{isButton:a}=e,i=(0,N.useDisabled)(),r=(0,k.useFilterContext)();return(0,t.jsxs)("div",{className:"relative flex w-full items-center justify-center",children:[(0,t.jsx)("div",{className:(0,l.clsx)("w-px bg-gray-400",a?"h-[80px]":"h-[40px]")}),a?(0,t.jsx)(y.SplitButton,{buttonProps:{disabled:i,onClick:()=>r.addCondition(r.state.length-1),size:"small",type:"secondary"},className:"absolute",menuButtonLabel:"Add a condition or condition group",menuItems:(0,t.jsx)(y.SplitButtonMenuItem,{description:"Add a condition group",menuItemProps:{disabled:i,onClick:r.addConditionGroup},title:"OR"}),menuProps:{width:230},children:"AND"}):null]})}},9741133,e=>{"use strict";e.s(["baseModules",()=>O]);var t=e.i(751170),a=e.i(9937599),l=e.i(8626589),i=e.i(8486711),r=e.i(764581),n=e.i(2375916);e.i(3512434);var s=e.i(9835407),o=e.i(1637579),c=e.i(1361980),d=e.i(1091572),u=e.i(7773878),m=e.i(2388086);let p=[...u.stringOperators,...u.stringMatchOperators],h={title:"Country",icon:(0,t.jsx)(a.Location,{}),Component:m.BaseComponent,schema:s.z.union([d.stringSchema,s.z.array(d.stringSchema).min(1,"Country cannot be empty")]),resolveValues:()=>c.default.getCountries().map(e=>({label:e.name,value:e.iso2.toUpperCase()})),allowedOperators:u.stringOperators,placeholder:{value:"Type a country name.."}},g={title:"Hostname",icon:(0,t.jsx)(r.WindowGlobe,{}),Component:m.BaseComponent,schema:s.z.union([d.hostnameSchema,s.z.array(d.hostnameSchema).min(1,"Hostname cannot be empty")]),allowedOperators:p,placeholder:{value:"Type a hostname.."}},x={title:"Request Header",icon:(0,t.jsx)(l.Hash,{}),Component:m.BaseComponent,schema:s.z.union([d.stringSchema,s.z.array(d.stringSchema).min(1,"Request header cannot be empty")]),allowedOperators:[...p,...u.keyExistsOperator],allowKey:!0,placeholder:{value:"Type a value..",key:"X-Request-Header"}},f={title:"IP Address",icon:(0,t.jsx)(r.WindowGlobe,{}),Component:m.BaseComponent,schema:s.z.union([d.ipAndCidrsSchema,s.z.array(d.ipAndCidrsSchema).min(1,"IP address cannot be empty")]),allowedOperators:u.stringOperators,placeholder:{value:"e.g. 10.0.0.1, 10.0.0.1/32"}},y={title:"Method",icon:(0,t.jsx)(l.Hash,{}),Component:m.BaseComponent,schema:s.z.union([d.stringSchema,s.z.array(d.stringSchema).min(1,"Method cannot be empty")]),resolveValues:()=>[{label:"GET",value:"GET"},{label:"HEAD",value:"HEAD"},{label:"POST",value:"POST"},{label:"DELETE",value:"DELETE"},{label:"PATCH",value:"PATCH"},{label:"PUT",value:"PUT"},{label:"CONNECT",value:"CONNECT"},{label:"OPTIONS",value:"OPTIONS"},{label:"TRACE",value:"TRACE"},{label:"DEBUG",value:"DEBUG"},{label:"QUERY",value:"QUERY"}],allowedOperators:u.stringOperators},v={title:"Environment",icon:(0,t.jsx)(r.WindowGlobe,{}),Component:m.BaseComponent,schema:s.z.union([d.stringSchema,s.z.array(d.stringSchema).min(1,"Vercel environment cannot be empty")]),resolveValues:()=>[{label:"Preview",value:"preview"},{label:"Production",value:"production"}],allowedOperators:u.stringOperators},b={title:"Request Path",icon:(0,t.jsx)(i.Route,{}),Component:m.BaseComponent,schema:s.z.union([d.pathSchema,s.z.array(d.pathSchema).min(1,"Path cannot be empty")]),allowedOperators:p,placeholder:{value:"e.g. /api, /signup/new"}},w={title:"Route",icon:(0,t.jsx)(i.Route,{}),Component:m.BaseComponent,schema:s.z.union([d.pathSchema,s.z.array(d.pathSchema).min(1,"Path cannot be empty")]),allowedOperators:p,placeholder:{value:"e.g. /blog/[slug]"}},j={title:"Raw Path",icon:(0,t.jsx)(i.Route,{}),Component:m.BaseComponent,schema:s.z.union([d.pathSchema,s.z.array(d.pathSchema).min(1,"Path cannot be empty")]),allowedOperators:p,placeholder:{value:"e.g. /api/, /signup/new/"}},C={title:"User Agent",icon:(0,t.jsx)(l.Hash,{}),Component:m.BaseComponent,schema:s.z.union([d.stringSchema,s.z.array(d.stringSchema).min(1,"User Agent cannot be empty")]),allowedOperators:p,placeholder:{value:"e.g. curl"}},S={title:"Query",icon:(0,t.jsx)(l.Hash,{}),Component:m.BaseComponent,schema:s.z.union([d.stringSchema,s.z.array(d.stringSchema).min(1,"Query cannot be empty")]),allowedOperators:[...p,...u.keyExistsOperator],allowKey:!0,placeholder:{key:"e.g. id, postId",value:"Type a value.."}},_={title:"Cookie",icon:(0,t.jsx)(l.Hash,{}),Component:m.BaseComponent,schema:s.z.union([d.stringSchema,s.z.array(d.stringSchema).min(1,"Cookie cannot be empty")]),allowedOperators:[...p,...u.keyExistsOperator],allowKey:!0,placeholder:{key:"Cookie-Name",value:"Type a value.."}},I={title:"Continent",icon:(0,t.jsx)(a.Location,{}),Component:m.BaseComponent,schema:s.z.union([d.stringSchema,s.z.array(d.stringSchema).min(1,"Continent cannot be empty")]),resolveValues:()=>[{label:"Africa",value:"AF"},{label:"Antarctica",value:"AN"},{label:"Asia",value:"AS"},{label:"Europe",value:"EU"},{label:"North America",value:"NA"},{label:"Oceania",value:"OC"},{label:"South America",value:"SA"}],allowedOperators:u.stringOperators},N={title:"City",icon:(0,t.jsx)(a.Location,{}),Component:m.BaseComponent,schema:s.z.union([d.stringSchema,s.z.array(d.stringSchema).min(1,"City cannot be empty")]),allowedOperators:p,placeholder:{value:"Type a city name.."}},A={title:"State",icon:(0,t.jsx)(a.Location,{}),Component:m.BaseComponent,schema:s.z.union([d.stringSchema,s.z.array(d.stringSchema).min(1,"State cannot be empty")]),allowedOperators:p,placeholder:{value:"Type a state abbreviation.."}},k={title:"AS Number",icon:(0,t.jsx)(a.Location,{}),Component:m.BaseComponent,schema:s.z.union([d.digitSchema,s.z.array(d.digitSchema).min(1,"AS Number cannot be empty")]),allowedOperators:p,placeholder:{value:"Digits only, ex. 12345"}},L={title:"Vercel Region",icon:(0,t.jsx)(a.Location,{}),Component:m.BaseComponent,schema:s.z.union([d.stringSchema,s.z.array(d.stringSchema).min(1,"Vercel Region cannot be empty")]),resolveValues:()=>Object.values(o.regions).map(e=>({label:`${e.key} - ${e.name}`,value:e.key})),allowedOperators:u.stringOperators},T={title:"Protocol",icon:(0,t.jsx)(r.WindowGlobe,{}),Component:m.BaseComponent,schema:s.z.union([d.stringSchema,s.z.array(d.stringSchema).min(1,"Protocol cannot be empty")]),resolveValues:()=>[{label:"HTTP/1.1",value:"HTTP/1.1"},{label:"HTTP/2.0",value:"HTTP/2.0"}],allowedOperators:u.stringOperators},E={title:"JA3 Digest",icon:(0,t.jsx)(n.Shield,{}),Component:m.BaseComponent,schema:s.z.union([d.stringSchema,s.z.array(d.stringSchema).min(1,"JA3 cannot be empty")]),allowedOperators:p,placeholder:{value:"Type a value.."},allowedPlans:["enterprise"]},O={path:b,route:w,raw_path:j,method:y,user_agent:C,header:x,query:S,cookie:_,host:g,environment:v,ip_address:f,protocol:T,region:L,geo_continent:I,geo_country:h,geo_country_region:A,geo_city:N,geo_as_number:k,ja4_digest:{title:"JA4 Digest",icon:(0,t.jsx)(n.Shield,{}),Component:m.BaseComponent,schema:s.z.union([d.stringSchema,s.z.array(d.stringSchema).min(1,"JA4 cannot be empty")]),allowedOperators:p,placeholder:{value:"Type a value.."}},ja3_digest:E,rate_limit_api_id:{title:"@vercel/firewall",icon:(0,t.jsx)(n.Shield,{}),Component:m.BaseComponent,schema:s.z.union([d.stringSchema,s.z.array(d.stringSchema).min(1,"Rate-limit ID cannot be empty")]),allowedOperators:[u.withIdOperator],placeholder:{value:"Rate limit ID"}},target_path:{...w,deprecated:e=>"target_path"!==e}}}]);

//# sourceMappingURL=cc84a7a902cda770.js.map
//# debugId=49e6a4b5-657b-5b5d-b403-799df041f750
